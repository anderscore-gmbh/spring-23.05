<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Lektion 1 - Einführung</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js-3.9.2/css/reveal.css" rel="stylesheet"><link href="reveal.js-3.9.2/plugin/title-footer/title-footer.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js-3.9.2/css/theme/anderscore.css" id="theme"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.9.2/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js-3.9.2/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script><script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script></head><body><div class="reveal"><div class="slides"><div class="paragraph"><p>Unresolved directive in complete.adoc - include::greeting.adoc[]</p></div>
<section id="_lektion_1_einführung" data-state="no-title-footer"><h2>Lektion 1 - Einführung</h2><div class="paragraph center"><p>Was ist Spring?</p></div></section>
<section id="_was_ist_spring"><h2>Was ist Spring?</h2><div class="paragraph heading"><p>Spring &#8230;&#8203;</p></div>
<div class="ulist"><ul><li><p>ist ein Framework (mehr als eine Bibliothek, kein Application Server)</p></li><li><p>benötigt nur JDK und einige Bibliotheken (jars)</p></li><li><p>kann fast überall integriert werden</p></li><li><p>kann fast alles integrieren</p></li></ul></div></section>
<section id="_spring_ökosystem"><h2>Spring-Ökosystem</h2><div class="paragraph center"><p><span class="image"><img src="images/spring-ecosystem.jpg" alt="spring ecosystem"></span></p></div></section>
<section id="_das_versprechen_von_enterprise_java_ee"><h2>Das Versprechen von Enterprise Java (EE)</h2><div class="paragraph"><p>Entwicklung kann sich auf die <strong>Geschäftslogik</strong> fokussieren.<br>
Die Infrastruktur kümmert sich um <strong>querschnittliche</strong> Themen, wie</p></div>
<div class="ulist"><ul><li><p>Transaktionsmanagement</p></li><li><p>Security</p></li><li><p>Ausfallsicherheit</p></li><li><p>Skalierung</p></li><li><p>Persistenz</p></li><li><p>Validierung</p></li><li><p>Fremdsystemeinbindung</p></li></ul></div></section>
<section id="_warum_ee_mit_spring"><h2>Warum EE mit Spring?</h2><div class="ulist"><ul><li><p>Einfachheit (Verwendung von POJOs)</p></li><li><p>Testbarkeit</p></li><li><p>Verbreitungsgrad</p></li><li><p>Einfache Integration</p></li><li><p>Viele fertige Bausteine</p></li><li><p>Lego-Prinzip</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Lego-Prinzip heißt:</p></div>
<div class="ulist"><ul><li><p>Es gibt für alles definierte Schnittstellen</p></li><li><p>Technologien sind als Bausteine mit diesen Schnittstellen verpackt</p></li><li><p>Als Entwickler stöpselt man nur noch diese Bausteine zusammen</p></li></ul></div></aside></section>
<section id="_wie_hat_alles_begonnen" class="columns"><h2>Wie hat alles begonnen?</h2><div class="openblock"><div class="content"><div class="paragraph"><p>Prinzipien:</p></div>
<div class="ulist"><ul><li><p>Dependency Injection (DI)</p></li><li><p>Aspektorientierte Programmierung (AOP)</p></li><li><p>Template-Method Pattern</p></li></ul></div></div></div>
<div class="paragraph"><p><span class="image" style="float: right"><img src="images/book_rod_johnson.jpg" alt="book rod johnson"></span></p></div></section>
<section id="_spring_releases"><h2>Spring Releases</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:14.2857%"><col style="width:57.1429%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Datum</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">ab JDK</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Neuigkeit</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">2002</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Buch von Rod Johnson erschienen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">06/2003</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">0.9</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erste Freigabe</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">03/2004</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">1.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Offizielle 1.0 Freigabe</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">10/2006</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">XML-Namespaces, Autowiring</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">11/2007</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">2.5</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">SE6 + EE 5, Annotationen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">12/2009</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">3.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">EL, Java-Config, REST</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">12/2013</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">4.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Lambda-Ausdrücke</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">09/2017</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">5.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Reactive Streams, WebFlux, Kotlin</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">05/2019</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">5.1</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Java 11, Detailverbesserungen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">11/2022</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">6.0</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Java 17, Spring Boot 3, Jakarta EE 9</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">05/2023</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">6.0.9</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Fixes, Improvements</p></td></tr></table>
<div class="paragraph"><p><a href="https://github.com/spring-projects/spring-framework/wiki/What&#8217;s-New-in-Spring-Framework-6.x">
&#8594; What&#8217;s New in Spring Framework 6.x</a></p></div></section>
<section id="_spring_versionierung"><h2>Spring Versionierung</h2><div class="paragraph"><p><strong>xx.yy.zz</strong></p></div>
<div class="ulist"><ul><li><p>xx: Technologie-Version (Abhängigkeit zu JDK-Version)</p></li><li><p>yy: Feature-Release (mit API-Erweiterungen)</p></li><li><p>zz: Bugfix-Release (ohne API-Änderungen)</p></li></ul></div></section>
<section id="_hintergrund"><h2>Hintergrund</h2><div class="ulist"><ul><li><p>Initiatoren: Rod Johnson, Jürgen Höller</p></li><li><p>Apache 2.0 Lizenz</p></li><li><p>Herausgeber: Pivotal Software Inc.</p></li><li><p>Projekt Lead: Jürgen Höller</p></li><li><p>Projektseite: <a href="https://spring.io/projects/spring-framework" class="bare">https://spring.io/projects/spring-framework</a></p></li><li><p>Sourcen: <a href="https://github.com/spring-projects/spring-framework" class="bare">https://github.com/spring-projects/spring-framework</a></p></li></ul></div></section>
<section id="_module"><h2>Module</h2><div class="paragraph center"><p><span class="image"><img src="images/spring-overview.png" alt="spring overview" height="800"></span></p></div></section>
<section id="_alternativen"><h2>Alternativen</h2><div class="ulist"><ul><li><p>Jakarta EE (ehemals Java EE oder JEE), insb. CDI</p></li><li><p>Google Guice</p></li></ul></div></section>
<section><section id="_dependency_injection"><h2>Dependency Injection</h2><div class="paragraph heading"><p>Herausforderung</p></div><div class="imageblock" style="text-align: center"><img src="images/di-context.svg" alt="di context" width="1200" height="600"></div></section><section id="_konsistente_konfiguration"><h2>Konsistente Konfiguration</h2><div class="imageblock" style="text-align: center"><img src="images/ioc.svg" alt="ioc" width="1200" height="600"></div></section><section id="_service_locator"><h2>Service Locator</h2><div class="imageblock" style="text-align: center"><img src="images/service-locator.svg" alt="service locator" width="1200" height="300"></div>
<div class="paragraph"><p>Typisch:</p></div>
<div class="ulist"><ul><li><p>Durch Umgebung / Container bereitgestellt.</p></li><li><p>Application Server: Standardisierte API mit Service-Locator</p><div class="ulist"><ul><li><p>Beispiel: JEE Container stellt Datenbank-Verbindung zur Verfügung</p></li></ul></div></li></ul></div></section><section id="_factory"><h2>Factory</h2><div class="imageblock" style="text-align: center"><img src="images/service-factory.svg" alt="service factory" width="1200" height="500"></div>
<div class="paragraph"><p>Typisch</p></div>
<div class="ulist"><ul><li><p>Standalone / Keine Abhängigkeit von der Umgebung</p></li><li><p>Klasse der Application-Factory ist Startparameter</p></li></ul></div></section><section id="_dependency_injection_di"><h2>Dependency Injection (DI)</h2><div class="imageblock" style="text-align: center"><img src="images/di.svg" alt="di" width="600" height="200"></div></section></section>
<section><section id="_hypothetisches_anwendungsbeispiel"><h2>Hypothetisches Anwendungsbeispiel</h2><div class="paragraph"><p>Wiederverwendbare Bibliothek zum Speichern von
benutzerspezifischen Voreinstellungen:</p></div><div class="title">PreferencesService.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">PreferencesService</span> {
    <span class="type">void</span> savePreference(<span class="predefined-type">String</span> key, <span class="predefined-type">String</span> value);
    <span class="predefined-type">String</span> loadPreference(<span class="predefined-type">String</span> key);
}</code></pre></section><section id="_präzisierung_der_anforderungen"><h2>Präzisierung der Anforderungen</h2><div class="ulist"><ul><li><p>Anwendungen müssen eine Referenz auf den PreferencesService bekommen</p></li><li><p>PreferencesService benötigt ID des aktuellen Users</p></li><li><p>Persistenzschicht muss zum Anwendungskontext passen</p></li></ul></div></section><section id="_entwurf"><h2>Entwurf</h2><div class="imageblock" style="text-align: center"><img src="images/draft.svg" alt="draft" width="1600" height="350"></div>
<div class="olist arabic"><div class="title">Problemstellungen:</div><ol class="arabic"><li><p>Wie kommt die Anwendung an den PreferencesService?</p></li><li><p>Wie kommt der PreferencesService an UserProvider und PreferencesRepository?</p></li></ol></div></section><section id="_lösung_1_service_locator"><h2>Lösung 1: Service Locator</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">ServiceRegistry</span> registry = ServiceRegistryFactory
        .newInstance().getServiceRegistry();

<span class="annotation">@Override</span>
<span class="directive">public</span> <span class="predefined-type">String</span> loadPreference(<span class="predefined-type">String</span> key) {
    <span class="predefined-type">String</span> userId = registry
            .getUserProvider()
            .getUserId();
    <span class="keyword">return</span> registry
            .getPreferencesRepository()
            .loadPreference(userId, key);
}</code></pre></section><section id="_lösung_2_dependency_injection"><h2>Lösung 2: Dependency Injection</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> FxUserProvider userProvider;
<span class="directive">private</span> JdbcPreferencesRepository preferencesRepository;
<span class="directive">private</span> PreferencesServiceImpl preferencesService;

<span class="directive">private</span> <span class="type">void</span> plumb() {
    userProvider = <span class="keyword">new</span> FxUserProvider();
    preferencesRepository = <span class="keyword">new</span> JdbcPreferencesRepository();
    preferencesService = <span class="keyword">new</span> PreferencesServiceImpl();
    preferencesService.setUserProvider(userProvider);
    preferencesService.setPreferencesRepository(preferencesRepository);
}</code></pre></section></section>
<section id="_spring_einführung"><h2>Spring Einführung</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson02-setup.html">&#8594; Weiter zum Einstieg in die Entwicklung mit Spring</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_2_einstieg_in_die_entwicklung_mit_spring" data-state="no-title-footer"><h2>Lektion 2 - Einstieg in die Entwicklung mit Spring</h2></section>
<section><section id="_erste_schritte"><h2>Erste Schritte</h2><div class="paragraph heading"><p>Ablauf:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Auschecken</p></li><li><p>Bauen</p></li><li><p>Ausführen</p></li></ol></div></section><section id="_benötigte_befehlszeilenwerkzeuge"><h2>Benötigte Befehlszeilenwerkzeuge</h2><div class="ulist"><ul><li><p>GIT (Versionverwaltung) zum Auschecken</p></li><li><p>Maven zum Bauen</p></li></ul></div></section><section id="_bauen_mit_maven"><h2>Bauen mit Maven</h2><div class="title">mvn clean package</div><pre class="CodeRay listingblock"><code>trainer@pc:~$ cd spring-2023.05
trainer@pc:~/spring-2020.07$ cd lesson02-setup
trainer@pc:~/spring-2020.07/lesson02-setup$ mvn clean package
[INFO] Scanning for projects...
...
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.156 s
[INFO] Finished at: 2021-07-22T09:55:50+01:00
[INFO] Final Memory: 18M/213M
[INFO] ------------------------------------------------------------------------</code></pre></section><section id="_ausführen_mit_maven"><h2>Ausführen mit Maven</h2><div class="title">mvn exec:java</div><pre class="CodeRay listingblock"><code>trainer@pc:~/spring-2023.05/lesson02-setup$ mvn exec:java
[INFO] Scanning for projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building lesson02-setup 1.0-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- exec-maven-plugin:1.5.0:java (default-cli) @ lesson02-setup ---
Message: Hello World!
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1.407 s
[INFO] Finished at: 2021-07-22T09:57:42+01:00
[INFO] Final Memory: 8M/243M
[INFO] ------------------------------------------------------------------------</code></pre></section></section>
<section id="_aufgabe_1_projekt_auschecken_bauen_und_ausführen"><h2>Aufgabe 1: Projekt auschecken, bauen und ausführen&#8230;&#8203;</h2><div class="olist arabic"><ol class="arabic"><li><p>Holen Sie sich den Beispielcode zu diesem Training mit einem</p><div class="literalblock"><div class="content"><pre>git clone https://github.com/anderscore-gmbh/spring-2023.05</pre></div></div></li><li><p>Wechseln Sie in das Verzeichnis <code>lesson02-setup</code> und
bauen Sie das Projekt mit <code>mvn clean package</code>.</p></li><li><p>Führen Sie das Projekt mit <code>mvn exec:java</code> aus.</p></li></ol></div></section>
<section id="_verwendung_einer_ide"><h2>Verwendung einer IDE</h2><div class="paragraph heading"><p>Ablauf</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Projekt mit IDE öffnen</p></li><li><p>Mit Sourcen vertraut machen</p></li><li><p>Anwendung ausführen</p></li></ol></div></section>
<section id="_aufgabe_2_projekt_in_ide_importieren_und_ausführen"><h2>Aufgabe 2: Projekt in IDE importieren und ausführen</h2><div class="paragraph"><p>Importieren Sie das Projekt in eine Entwicklungsumgebung Ihrer Wahl und führen Sie damit
die Anwendung aus.</p></div>
<div class="paragraph"><p>Empfohlene IDE für diesen Workshop: <strong><a href="https://spring.io/tools">&#8594; Spring Tools 4 for Eclipse</a></strong></p></div>
<div class="paragraph"><p>Alternativen:</p></div>
<div class="ulist"><ul><li><p><a href="https://spring.io/tools/sts/all">&#8594; Spring Tool Suite™ 3</a></p></li><li><p><a href="https://www.jetbrains.com/idea/download/">&#8594; IntelliJ IDEA</a></p></li><li><p><a href="https://netbeans.org/downloads/">&#8594; NetBeans IDE</a></p></li><li><p><a href="https://www.eclipse.org/downloads/eclipse-packages/">&#8594; Eclipse IDE for Java EE Developers</a></p></li></ul></div></section>
<section><section id="_erste_spring_applikation"><h2>Erste Spring Applikation</h2><div class="title">HelloWorldApp.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
    GenericApplicationContext ctx = <span class="keyword">new</span> GenericApplicationContext();
    ctx.registerBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">greetingService</span><span class="delimiter">&quot;</span></span>, GreetingService.class,
            () -&gt; <span class="keyword">new</span> GreetingService());
    ctx.refresh();

    GreetingService service = ctx
            .getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">greetingService</span><span class="delimiter">&quot;</span></span>, GreetingService.class);
    <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Message: </span><span class="delimiter">&quot;</span></span> + service.getGreeting());
}</code></pre><div class="paragraph"><p>Was geschieht hier?</p></div><div class="ulist"><ul><li><p>Was ist ein <code>ApplicationContext</code>?</p></li><li><p>Welche Möglichkeiten gibt es sonst noch, einen <code>ApplicationContext</code> anzulegen?</p></li><li><p>Was bewirkt die Methode <code>refresh</code>?</p></li><li><p>Welche Alternativen gibt es, an den <code>GreetingService</code> aus dem <code>ApplicationContext</code> heranzukommen?</p></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans">
&#8594; Reference: The IoC Container</a></p></div></section><section id="_was_ist_ein_applicationcontext"><h2>Was ist ein ApplicationContext?</h2><div class="ulist"><ul><li><p>Der <code>ApplicationContext</code> ist ein Container für Service-Objekte, den sogenannten <strong>Beans</strong>.</p></li><li><p>Er speichert diese Objekte bzw. deren <strong>Factories</strong>
in einer Registry unter einem <strong>eindeutigen Namen</strong>, vergleichbar mit einer HashMap.</p></li><li><p>Beim Erzeugen von Objekten
nutzt er diese Registry um <strong>Abhängigkeiten aufzulösen</strong>.</p></li></ul></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Nutzen den Debugger um sich den <code>ApplicationContext</code> zur Laufzeit anzusehen.</td></tr></table></div></section><section id="_möglichkeiten_einen_applicationcontext_zu_erzeugen"><h2>Möglichkeiten einen ApplicationContext zu erzeugen</h2><div class="paragraph"><p>Es gibt diverse Klassen, die das ApplicationContext-Interface implementieren, die wichtigsten sind:</p></div>
<div class="ulist"><ul><li><p><code>ClassPathXmlApplicationContext</code> für XML-Config</p></li><li><p><code>AnnotationConfigApplicationContext</code> für Java-Config</p></li><li><p><code>StaticApplicationContext</code> für Tests</p></li></ul></div>
<div class="paragraph"><p>Am flexibelsten ist der <code>GenericApplicationContext</code>, der über verschiedene <code>AbstractBeanDefinitionReader</code>
unterschiedliche Formate für die Context-Definition unterstützt.</p></div></section><section id="_applicationcontext_für_webapps"><h2>ApplicationContext für Webapps</h2><div class="paragraph"><p>Für Webapplikationen gibt es spezielle ApplicationContext Klassen:</p></div>
<div class="ulist"><ul><li><p><code>XmlWebApplicationContext</code> für XML-Config bei Webapps</p></li><li><p><code>AnnotationConfigWebApplicationContext</code> für Java-Config bei Webapps</p></li><li><p><code>GenericWebApplicationContext</code> ist das Gegenstück zu <code>GenericApplicationContext</code> für Webapps</p></li></ul></div></section><section id="_was_bewirkt_die_methode_refresh"><h2>Was bewirkt die Methode <code>refresh</code>?</h2><div class="ulist"><ul><li><p>Die Methode <em>befüllt</em> den <code>ApplicationContext</code>.</p></li><li><p>Die Methode sollte nur aufgerufen werden, wenn sie nicht bereits
durch den Konstruktor der jeweiligen <code>ApplicationContext</code> Klasse aufgerufen wird.</p></li></ul></div></section><section id="_welche_alternativen_gibt_es_an_den_trainingservice_aus_dem_applicationcontext_heranzukommen"><h2>Welche Alternativen gibt es, an den <code>TrainingService</code> aus dem <code>ApplicationContext</code> heranzukommen?</h2><div class="ulist"><ul><li class="fragment"><p>Verwendung einer der <code>getBean</code> Methoden der <code>ApplicationContext</code> Schnittstelle</p></li><li class="fragment"><p>Definition einer weiteren Bean mit einer Abhängigkeit zum <code>GreetingService</code></p></li></ul></div></section></section>
<section><section id="_exkurs_logging"><h2>Exkurs: Logging</h2><div class="paragraph heading"><p>Problem</p></div><div class="ulist"><ul><li><p>Die eingesetzen Bibliotheken verwenden verschiedene Logging-APIs</p></li><li><p>Einheitliche Logging Konfiguration an einer Stelle</p></li><li><p>Eine Logdatei für alle Logausgaben</p></li></ul></div><div class="paragraph heading"><p>Lösung</p></div><div class="ulist"><ul><li><p>Ein Loggingframework besteht aus einer API und einer Engine</p></li><li><p>Eine Bridge ermöglicht den Einsatz einer Engine für fremde APIs</p></li><li><p>In der Regel genügt es, die richtigen Abhängigkeiten anzugeben</p></li></ul></div></section><section id="_exkurs_logging_über_fremde_logging_apis_am_beispiel_slf4j"><h2>Exkurs: Logging über fremde Logging-APIs am Beispiel SLF4J</h2><div class="paragraph"><p><span class="image"><img src="images/lesson02/slf4j-bridges.png" alt="slf4j bridges" height="640"></span></p></div>
<div class="paragraph"><p><a href="https://www.slf4j.org/legacy.html">&#8594; SLF4J: Bridging legacy APIs</a></p></div></section><section id="_exkurs_logging_frameworks"><h2>Exkurs: Logging Frameworks</h2><div class="ulist"><ul><li><p><a href="https://docs.oracle.com/javase/10/docs/api/java/util/logging/package-summary.html">Java Util Logging (JUL)</a> (JRE Bestandteil)</p></li><li><p><a href="https://logging.apache.org/log4j/2.x/">Apache Log4j 2™</a> <em>(Logging Engine für diesen Workshop)</em></p></li><li><p><a href="https://www.slf4j.org/">Simple Logging Facade for Java (SLF4J)</a> <em>(Logging API für diesen Workshop)</em></p></li><li><p><a href="https://commons.apache.org/proper/commons-logging/">Apache Commons Logging ™ (JCL)</a> (von Spring-Framework verwendet)</p></li><li><p><a href="https://logback.qos.ch/">Logback</a> (Default bei Spring-Boot)</p></li></ul></div></section><section id="_exkurs_logging_seit_spring_5"><h2>Exkurs: Logging seit Spring 5</h2><div class="ulist"><ul><li><p>Spring bringt seit Version 5 im Modul <code>spring-jcl</code> eine eigene
Logging-Bridge mit, die als Alternative zu <code>jcl-over-slf4j</code>
verwendet werden kann.</p></li><li><p>Diese unterstützt direkt <strong>Log4J 2</strong> und <strong>JUL</strong> ohne zusätzliche
Bridges.</p></li><li><p>Um <strong>JCL</strong> zu verwenden, muss man die Abhängigkeit zu <code>spring-jcl</code> exkludieren.</p></li></ul></div></section><section id="_exkurs_log4j_2_abhängigkeiten_spring_4"><h2>Exkurs: Log4J-2-Abhängigkeiten (Spring 4)</h2><div class="title">Logging Abhängigkeiten (Gradle-Format):</div><pre class="CodeRay listingblock"><code class="groovy language-groovy"><span class="comment">// BOM legt Versionen fest</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-bom:2.11.2</span><span class="delimiter">'</span></span>
<span class="comment">// API für Log4J-2</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-api</span><span class="delimiter">'</span></span>
<span class="comment">// Logger-Engine</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-core</span><span class="delimiter">'</span></span>
<span class="comment">// API für SLF4J</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-slf4j-impl</span><span class="delimiter">'</span></span>
<span class="comment">// Commons Logging Bridge</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-jcl</span><span class="delimiter">'</span></span>
<span class="comment">// Commons Logging API</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">commons-logging:commons-logging</span><span class="delimiter">'</span></span>
<span class="comment">// Adapater für JUL, benötigt -Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-jul</span><span class="delimiter">'</span></span></code></pre>
<div class="paragraph"><p><a href="https://logging.apache.org/log4j/2.0/runtime-dependencies.html">&#8594; Apache Log4j 2™: Runtime Dependencies</a></p></div></section><section id="_exkurs_log4j_2_abhängigkeiten_spring_5"><h2>Exkurs: Log4J-2-Abhängigkeiten (Spring 5)</h2><div class="paragraph"><p>Die Abhängigkeiten sind auf das notwendig Minimum reduziert:</p></div>
<div class="title">Logging Abhängigkeiten (Gradle-Format):</div><pre class="CodeRay listingblock"><code class="groovy language-groovy"><span class="comment">// API für SLF4J</span>
compile <span class="string"><span class="delimiter">'</span><span class="content">org.apache.logging.log4j:log4j-slf4j-impl:2.11.2</span><span class="delimiter">'</span></span></code></pre>
<div class="paragraph"><p>Über die Abhängigkeiten von <code>log4j-slf4j-impl</code> werden die Log4J2-Engine und die SLF4J-API eingebunden.</p></div></section><section id="_logger_verwenden_slf4j_api"><h2>Logger verwenden (SLF4J API)</h2><div class="title">Logger deklarien:</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(MyClass.class);</code></pre>
<div class="title">Einfache Logausgabe:</div><pre class="CodeRay listingblock"><code class="java language-java">log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Ingendwas passiert</span><span class="delimiter">&quot;</span></span>);</code></pre>
<div class="title">Logausgabe mit Parametern:</div><pre class="CodeRay listingblock"><code class="java language-java">log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">Schreibe {} bytes in Datei {}</span><span class="delimiter">&quot;</span></span>, size, file);</code></pre>
<div class="title">Loggen einer Exception:</div><pre class="CodeRay listingblock"><code class="java language-java">log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Schief gegangen</span><span class="delimiter">&quot;</span></span>, ex);</code></pre></section><section id="_logger_konfiguration"><h2>Logger Konfiguration</h2><div class="title">log4j2.xml</div><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;Configuration</span> <span class="attribute-name">status</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">WARN</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">shutdownHook</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">disable</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;Appenders&gt;</span>
        <span class="tag">&lt;Console</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Console</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">target</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">SYSTEM_OUT</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;PatternLayout</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/Console&gt;</span>
        <span class="tag">&lt;File</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">File</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">filename</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">target/app.log</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;PatternLayout</span> <span class="attribute-name">pattern</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/File&gt;</span>
    <span class="tag">&lt;/Appenders&gt;</span>
    <span class="tag">&lt;Loggers&gt;</span>
        <span class="tag">&lt;Root</span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">info</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;AppenderRef</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Console</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;AppenderRef</span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">File</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/Root&gt;</span>
        <span class="tag">&lt;Logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">setup</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">debug</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span> <span class="comment">&lt;!-- Definiert Logger für Package 'setup' --&gt;</span>
    <span class="tag">&lt;/Loggers&gt;</span>
<span class="tag">&lt;/Configuration&gt;</span></code></pre></section></section>
<section id="_aufgabe_3_logging"><h2>Aufgabe 3: Logging</h2><div class="olist arabic"><ol class="arabic"><li><p>Stellen Sie das Root-Level der Logging-Konfiguration auf <code>DEBUG</code>.<br>
Was besagen die Logausgaben von Spring, die Sie damit erhalten?</p></li><li><p>Bauen Sie eine Logausgabe in die main-Methode Ihrer Applikation ein.</p></li></ol></div></section>
<section><section id="_lebenszyklus_einer_bean"><h2>Lebenszyklus einer Bean</h2><div class="paragraph heading"><p>Möglichkeiten, den Lebenszyklus einer Bean zu beeinflussen</p></div><div class="ulist"><ul><li><p>Interfaces <code>InitializingBean</code>, <code>DisposableBean</code> und <code>Lifecycle</code></p></li><li><p>JSR-250 Annotationen <code>@PostConstruct</code> und <code>@PreDestroy</code></p></li><li><p>Explizite Angabe der <em>init-method</em> oder <em>destroy-method</em> per Konfiguration</p></li><li><p>Default Init/Destroy-Methoden (nur XML-Config)</p></li><li><p>public close/shutdown (nur JavaConfig), abschaltbar über <code>@Bean(destroyMethod="")</code></p></li></ul></div></section><section id="_shutdown_hook"><h2>Shutdown-Hook</h2><div class="paragraph"><p>Der ShutdownHook ist notwendig, damit der ApplicationContext
sauber heruntergefahren wird.</p></div>
<div class="literalblock"><div class="content"><pre>ctx.registerShutdownHook();</pre></div></div>
<div class="admonitionblock warning teacherBox"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">In der <strong>Log4J 2</strong> Konfiguration muss mit <code>shutdownHook="disable"</code>
verhindert werden, dass Log4J vor Spring beendet wird.</td></tr></table></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content"><code>mvn exec:java</code> startet keine eigene VM, deshalb wird der Shutdown-Hook
nie augerufen.</td></tr></table></div></section><section id="_initdestroy_über_lifecycle_interfaces"><h2>Init/Destroy über Lifecycle-Interfaces</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">MyService</span> <span class="directive">implements</span> InitializingBean, DisposableBean {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(MyService.class);

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterPropertiesSet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">service created</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> destroy() <span class="directive">throws</span> <span class="exception">Exception</span> {
        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">service destroyed</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">service destroyed</span><span class="delimiter">&quot;</span></span>); <span class="comment">// falls Logging schon beendet wurde</span>
    }
}</code></pre></section><section id="_initdestroy_über_jsr_250_annotationen"><h2>Init/Destroy über JSR-250 Annotationen</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PostConstruct</span>
<span class="directive">public</span> <span class="type">void</span> before() <span class="directive">throws</span> <span class="exception">Exception</span> {
    log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">service created</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@PreDestroy</span>
<span class="directive">public</span> <span class="type">void</span> after() <span class="directive">throws</span> <span class="exception">Exception</span> {
    log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">service destroyed</span><span class="delimiter">&quot;</span></span>);
}</code></pre>
<div class="admonitionblock caution"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Dafür ist ein <code>AnnotationConfigApplicationContext</code> notwendig!</td></tr></table></div></section></section>
<section id="_aufgabe_4_lebenszyklus_einer_bean_nachvollziehen"><h2>Aufgabe 4: Lebenszyklus einer Bean nachvollziehen</h2><div class="paragraph"><p>Erweitern Sie den <code>GreetingService</code> so, dass er loggt,</p></div>
<div class="ulist"><ul><li><p>wenn er vollständig initialisiert wurde und</p></li><li><p>wenn er zerstört wird.</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock caution teacherBox"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Beachten Sie, dass <code>registerShutdownHook()</code> notwendig ist, damit der
ApplicationContext mitbekommt, wenn die Applikation beendet wird.</td></tr></table></div></section>
<section id="_lernziele_dieser_lektion"><h2>Lernziele dieser Lektion</h2><div class="ulist"><ul><li><p>Entwicklungsumgebung einrichten (Beispielanwendung auschecken, bauen und laufen lassen)</p></li><li><p>Verwendung der Spring-Dokumentation (Reference, API, Guides)</p></li><li><p>Logging konfigurieren</p></li><li><p>Wie erzeugt man einen ApplicationContext?</p></li><li><p>Lebenszyklus des ApplicationContext (registerShutdownHook)</p></li><li><p>Wie nutzt man einen ApplicationContext (Zugriff auf Beans)?</p></li><li><p>Was ist der ApplicationContext?</p></li><li><p>ApplicationContext mit dem Debugger untersuchen</p></li></ul></div></section>
<section id="_einstieg_in_die_entwicklung_mit_spring"><h2>Einstieg in die Entwicklung mit Spring</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson03-context.html">&#8594; Weiter zu ApplicationContext Konfigurieren</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_3_applicationcontext_konfiguration" data-state="no-title-footer"><h2>Lektion 3 - ApplicationContext Konfiguration</h2></section>
<section id="_applicationcontext_konfiguration"><h2>ApplicationContext Konfiguration</h2><div class="paragraph heading"><p>Möglichkeiten den ApplicationContext zu konfigurieren:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>XML</p></li><li><p>Annotationen</p></li><li><p>Java-Methoden</p></li><li><p>Lambda Ausdrücke (seit Spring 5)</p></li><li><p>&#8230;&#8203; und jede Kombination davon!</p></li></ol></div></section>
<section><section id="_beispielanwendung_wa_tor" class="columns"><h2>Beispielanwendung: Wa-Tor</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Diskrete Simulation eines<br>
einfachen Räuber-Beute-Modells</p></li><li><p>Es gibt nur Fische und Haie</p></li><li><p>Simuliert toroidalen<br>
"Planeten" aus Wasser</p></li><li><p>Entspricht rechteckigem Spielfeld, das in<br>
Zeilen und Spalten unterteilt ist und<br>
dessen Ende mit dem Anfang verbunden ist</p></li><li><p>Eine Zelle ist von max. einem Wesen besetzt</p></li></ul></div>
<div class="paragraph"><p>Siehe: <a href="https://de.wikipedia.org/wiki/Wator" class="bare">https://de.wikipedia.org/wiki/Wator</a></p></div></div></div><div class="paragraph"><p><span class="image"><img src="images/torus.jpg" alt="torus"></span></p></div></section><section id="_regeln_für_einen_fisch"><h2>Regeln für einen Fisch</h2><div class="ulist"><ul><li><p>Schwimmt zufällig auf angrenzendes Feld (sofern leer)</p></li><li><p>Vermehrt sich nach Ablauf einer bestimmten Zeit (<em>Breed Time</em>),
indem neuer Fisch in angrenzendem Feld geboren wird</p></li><li><p>Bewegt sich nur horizontal oder vertikal</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph heading"><p>Regeln für einen Hai</p></div>
<div class="ulist"><ul><li><p>Hai frisst Fisch auf einem angrenzenden Feld (falls vorhanden)</p></li><li><p>Verhungert nach <em>Starve Time</em></p></li><li><p>Verhält sich ansonsten wie ein Fisch</p></li></ul></div></section></section>
<section id="_anwendungsmodell"><h2>Anwendungsmodell</h2><div class="imageblock" style="text-align: center"><img src="images/wator-draft.svg" alt="wator draft" width="1200" height="800"></div></section>
<section id="_zusammenstöpseln_der_anwendung_ohne_spring"><h2>Zusammenstöpseln der Anwendung (ohne Spring)</h2><div class="title">WatorAppNoSpring.java</div><pre class="CodeRay listingblock"><code class="java language-java">    <span class="directive">private</span> <span class="type">void</span> plumb() {
        <span class="predefined-type">Random</span> rnd = ThreadLocalRandom.current();

        torus = <span class="keyword">new</span> SimpleTorus(<span class="integer">60</span>, <span class="integer">10</span>);

        FishStrategy fishStrategy = <span class="keyword">new</span> FishStrategy();
        fishStrategy.setBreedTime(<span class="integer">3</span>);
        fishStrategy.setRnd(rnd);
        fishStrategy.setTorus(torus);

        SharkStrategy sharkStrategy = <span class="keyword">new</span> SharkStrategy();
        sharkStrategy.setBreedTime(<span class="integer">5</span>);
        sharkStrategy.setRnd(rnd);
        sharkStrategy.setStarveTime(<span class="integer">4</span>);
        sharkStrategy.setTorus(torus);

        worldEngine = WorldEngine.createPopulatedWorld(
                <span class="float">0.3</span>, <span class="comment">// initial rate of fish per cell</span>
                <span class="float">0.1</span>, <span class="comment">// initial rate of shark per cell</span>
                rnd, <span class="comment">// random base</span>
                torus, <span class="comment">// the torus the creatures live in</span>
                <span class="keyword">new</span> FishStrategy<span class="type">[]</span>{fishStrategy, sharkStrategy}
        );
    }</code></pre></section>
<section id="_xml_basierte_konfiguration"><h2>XML-basierte Konfiguration</h2><div class="ulist"><ul><li><p>XML-Datei zur Konfiguration des ApplicationContext</p></li><li><p>Verdrahtung der <em>Beans</em> erfolgt über XML-Elemente</p></li><li><p>Vorteil: Klare Trennung von Implementierung und Verdrahtung</p></li><li><p>Nachteil: Medienbruch</p></li><li><p>Stammt aus den Anfängen der JEE</p></li><li><p>Sinnvoll in Kombination mit anderen XML-Konfigurationen</p></li></ul></div></section>
<section id="_grundgerüst_für_xml_konfiguration"><h2>Grundgerüst für XML-Konfiguration</h2><div class="title">context.xml</div><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
       <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/beans</span>
        <span class="content">http://www.springframework.org/schema/beans/spring-beans.xsd</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

<span class="tag">&lt;/beans&gt;</span></code></pre></section>
<section><section id="_beans_via_xml_definieren"><h2>Beans via XML definieren</h2><div class="paragraph"><p>Die Definition</p></div><div class="literalblock"><div class="content"><pre>&lt;bean id="firstCar" class="container.fragments.Car"/&gt;</pre></div></div><div class="paragraph"><p>entspicht einem Constructor-Aufruf:</p></div><div class="literalblock"><div class="content"><pre>Car firstCar = new Car();</pre></div></div><div class="paragraph"><p>Zugriff erfolgt über:</p></div><div class="literalblock"><div class="content"><pre>ctx.getBean("firstCar", Car.class)</pre></div></div></section><section id="_bean_aliases"><h2>Bean Aliases</h2><div class="paragraph"><p>Definition einer Bean mit 2 Aliasen:</p></div>
<div class="literalblock"><div class="content"><pre>&lt;bean id="firstCar" name="bobbyCar,myCar"
      class="container.fragments.Car"/&gt;</pre></div></div>
<div class="paragraph"><p>damit gilt:</p></div>
<div class="literalblock"><div class="content"><pre>ctx.getBean("firstCar") == ctx.getBean("bobbyCar")</pre></div></div></section><section id="_bean_mit_konstruktorparametern"><h2>Bean mit Konstruktorparametern:</h2><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">engine</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container.fragments.Engine</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">0</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">index</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">48</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
<div class="paragraph"><p>entspricht:</p></div>
<div class="literalblock"><div class="content"><pre>Engine engine = new Engine("diesel", 48);</pre></div></div></section><section id="_bean_mit_properties"><h2>Bean mit Properties</h2><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">realCar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container.fragments.Car</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yellow</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">engine</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">engine</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
<div class="paragraph"><p>entspricht:</p></div>
<div class="literalblock"><div class="content"><pre>Car realCar = new Car();
realCar.setColor("yellow");
realCar.setEngine(engine);</pre></div></div></section><section id="_collections_und_geschachtelte_beans"><h2>Collections und geschachtelte Beans</h2><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">luxuryCar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container.fragments.Car</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">color</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">engine</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container.fragments.Engine</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">120</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/bean&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">features</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;list&gt;</span>
            <span class="tag">&lt;ref</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">aircon</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;bean</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container.fragments.Feature</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
                <span class="tag">&lt;constructor-arg</span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">radio</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;/bean&gt;</span>
        <span class="tag">&lt;/list&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
<div class="paragraph"><p>entspricht:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">Car car = <span class="keyword">new</span> Car();
car.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>);
car.setEngine(<span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>, <span class="integer">120</span>));
car.setFeatures(<span class="predefined-type">Arrays</span>.asList(aircon, <span class="keyword">new</span> Feature(<span class="string"><span class="delimiter">&quot;</span><span class="content">radio</span><span class="delimiter">&quot;</span></span>)));</code></pre></section></section>
<section><section id="_xml_config_elemente"><h2>XML-Config Elemente</h2><div class="paragraph heading"><p>Attribute des 'bean' Elements 1/2</p></div><div class="paragraph"><p>Siehe <a href="http://www.springframework.org/schema/beans/spring-beans.xsd" class="bare">http://www.springframework.org/schema/beans/spring-beans.xsd</a>.<br>
Ist auch im Projekt <em>lesson-03-container</em> unter <em>src/test/xsd</em> abgelegt.</p></div><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Attribut</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name der Bean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Aliases</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">class</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bean-Klasse, bzw. Factory-Klasse</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">factory-method</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Methode zum Erzeugen einer Bean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">factory-bean</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Name der Factory Bean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">init-method</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Methode für Initialisierung</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">destroy-method</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Methoden für Aufräumarbeiten</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">scope</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">'singleton' (default) oder 'prototype'</p></td></tr></table></section><section id="_attribute_des_bean_elements_22"><h2>Attribute des 'bean' Elements 2/2</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Attribut</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">lazy-init</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Initialisierung bei Bedarf</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">depends-on</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Explizite Abhängigkeit</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">autowire</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeiten automatisch verknüpfen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">autowire-candidate</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Für Abhängigkeiten verwenden</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">primary</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bevorzugte Alternative</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">parent</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Referenz auf Vorlage</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">abstract</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ist Vorlage</p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<div class="dlist"><dl><dt class="hdlist1">Wichtige Subelemente: </dt><dd><p>property, constructor-arg</p></dd></dl></div></section><section id="_das_property_element"><h2>Das 'property' Element</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Attribut</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Property-Name</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ref</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bean-Name</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wert</p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<div class="dlist"><dl><dt class="hdlist1">Subelemente: </dt><dd><p>description, meta, bean, ref, idref, value,
null, array, list, set, map, props</p></dd></dl></div></section><section id="_das_constructor_arg_element"><h2>Das 'constructor-arg' Element</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Attribut</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">type</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Argumenttyp</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Argumentindex</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Argumentname</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ref</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Beanname</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wert</p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<div class="dlist"><dl><dt class="hdlist1">Subelemente: </dt><dd><p>bean, ref, idref, value, null, array, list,
set, map, props</p></dd></dl></div></section><section id="_die_elemente_array_list_und_set"><h2>Die Elemente 'array', 'list' und 'set'</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Attribut</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">value-type</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Elementtyp</p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<div class="dlist"><dl><dt class="hdlist1">Subelemente: </dt><dd><p>description, bean, ref, idref, value,
null, array, list, set, map, props</p></dd></dl></div></section><section id="_die_elemente_map_entry_props_und_prop"><h2>Die Elemente 'map', 'entry', 'props' und 'prop'</h2><div class="paragraph"><p>Beispiel zum Setzen von Properties:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">specialCar</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">container.fragments.Car</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">properties</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
            <span class="tag">&lt;props&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">length</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>4.12<span class="tag">&lt;/prop&gt;</span>
                <span class="tag">&lt;prop</span> <span class="attribute-name">key</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">height</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>1.68<span class="tag">&lt;/prop&gt;</span>
            <span class="tag">&lt;/props&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
<div class="paragraph"><p>Maps werden analog dazu mit <code>&lt;map&gt;</code> und <code>&lt;entry&gt;</code> Elementen aufgebaut.<br>
Siehe auch den <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-collection-elements">
entsprechenden Abschnitt in der Spring Referenzdokumentation</a>.</p></div></section></section>
<section id="_aufteilung_auf_mehere_konfigurationsdateien"><h2>Aufteilung auf mehere Konfigurationsdateien</h2><pre class="CodeRay listingblock"><code>&lt;beans&gt;
    &lt;import resource="services.xml"/&gt;                   &lt;!-- gleiches Verzeichnis --&gt;
    &lt;import resource="resources/messageSource.xml"/&gt;    &lt;!-- Unterverzeichnis resources --&gt;
    &lt;import resource="/resources/themeSource.xml"/&gt;     &lt;!-- führender '/' wird ignoriert --&gt;

    &lt;bean id="bean1" class="..."/&gt;
    &lt;bean id="bean2" class="..."/&gt;
&lt;/beans&gt;</code></pre></section>
<section><section id="_applicationcontext"><h2>ApplicationContext</h2><div class="imageblock" style=""><img src="images/application-context-hierarchy.svg" alt="application context hierarchy" width="1213" height="499"></div></section><section id="_applicationcontext_erzeugen_und_verwenden"><h2>ApplicationContext erzeugen und verwenden</h2><pre class="CodeRay listingblock"><code class="java language-java">ApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string"><span class="delimiter">&quot;</span><span class="content">car-context.xml</span><span class="delimiter">&quot;</span></span>);
Car car = ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstCar</span><span class="delimiter">&quot;</span></span>, Car.class);</code></pre></section></section>
<section id="_aufgabe_1_xml_konfiguration_anwenden"><h2>Aufgabe 1: XML-Konfiguration anwenden</h2><div class="paragraph"><p>Diese Aufgabe basiert auf der Methode <code>plumb</code> der Klasse <em>WatorAppNoSpring.java</em> im
Verzeichnis <em>src/main/java/wator</em>.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Verwenden Sie <em>src/main/resources/context.xml</em> als Grundgerüst.</p></li><li><p>Bilden Sie die Methode <code>plumb</code> mit einer XML-Konfiguration nach.
Sie benötigen dafür die Elemente <code>bean</code>, <code>property</code> und <code>constructor-arg</code>.</p></li><li><p>Kopieren Sie <em>WatorAppNoSpring</em> und ändern Sie die Methode <code>plumb</code>, so dass sie Ihre
XML-Konfiguration verwendet. Sie benötigen dafür die Klasse <code>ClassPathXmlApplicationContext</code>.</p></li></ol></div>
<div class="paragraph"><p>Details finden Sie in der <a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html">
Spring Framework Referenzdokumentation, Abschnitt 'The IoC Container'</a>.</p></div></section>
<section><section id="_java_basierte_konfiguration"><h2>Java-basierte Konfiguration</h2><div class="ulist"><ul><li><p>Java-Klasse zur Konfiguration des ApplicationContext</p></li><li><p>XML-Konfiguration wird mit Java-Syntax nachgebildet</p></li><li><p>Kein Medienbruch (Refactoring, Compiler erkennt Fehler)</p></li><li><p>Weniger Boilerplate</p></li><li><p>Trennung von Implementierung und Verdrahtung erfordert Disziplin</p></li></ul></div></section><section id="_grundgerüst"><h2>Grundgerüst</h2><div class="title">CarConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CarConfig</span> {

    <span class="comment">// Bean mit Namen 'firstCar'</span>
    <span class="annotation">@Bean</span>
    Car firstCar() {
        <span class="keyword">return</span> <span class="keyword">new</span> Car();
    }

    <span class="comment">// Bean mit Name 'firstCar2' und Aliasen 'bobbyCar' und 'car2'</span>
    <span class="annotation">@Bean</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">firstCar2</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bobbyCar</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">car2</span><span class="delimiter">&quot;</span></span>})
    Car firstCar2() {
        <span class="keyword">return</span> <span class="keyword">new</span> Car();
    }
}</code></pre></section><section id="_zusammenstöpseln_von_beans"><h2>Zusammenstöpseln von Beans</h2><div class="title">CarConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="comment">// Ist Singleton, d. h. gibt es nur einmal!</span>
<span class="annotation">@Bean</span>
Engine engine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span>, <span class="integer">48</span>);
}

<span class="annotation">@Bean</span>
Car realCar() {
    Car car = <span class="keyword">new</span> Car();
    car.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">yellow</span><span class="delimiter">&quot;</span></span>);
    car.setEngine(engine()); <span class="comment">// Verdrahtung über Methode (Cache!)</span>
    <span class="keyword">return</span> car;
}

<span class="annotation">@Bean</span>
Car realCar2(Engine engine) { <span class="comment">// Verdrahtung über Parameter</span>
    Car car = <span class="keyword">new</span> Car();
    car.setEngine(engine);
    <span class="keyword">return</span> car;
}</code></pre>
<div class="paragraph"><p>Bgzl. Auflösung von Mehrdeutigkeiten siehe
<a href="https://www.logicbig.com/tutorials/spring-framework/spring-core/javaconfig-methods-inter-dependency.html">
Dependency injection in @Bean method parameters</a>.</p></div></section><section id="_collections_und_nested_beans_mit_java_mitteln"><h2>Collections und nested Beans mit Java-Mitteln</h2><div class="title">CarConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
Feature aircon() {
    <span class="keyword">return</span> <span class="keyword">new</span> Feature(<span class="string"><span class="delimiter">&quot;</span><span class="content">air conditioning</span><span class="delimiter">&quot;</span></span>);
}

<span class="annotation">@Bean</span>
Car luxuryCar() {
    Car car = <span class="keyword">new</span> Car();
    car.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">black</span><span class="delimiter">&quot;</span></span>);
    car.setEngine(<span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>, <span class="integer">120</span>));
    car.setFeatures(<span class="predefined-type">List</span>.of(aircon(), <span class="keyword">new</span> Feature(<span class="string"><span class="delimiter">&quot;</span><span class="content">radio</span><span class="delimiter">&quot;</span></span>)));
    <span class="keyword">return</span> car;
}</code></pre></section></section>
<section id="_annotationen_für_java_config_ohne_autowiring"><h2>Annotationen für Java-Config (ohne Autowiring)</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Annotation</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Configuration</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Markiert eine Klasse als Konfigurationsklasse</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Bean</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Makiert eine Methode als Bean-Factory</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Lazy</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bean wird nur bei Bedarf initialisiert</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Nullable (bei Bean-Methode)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bean darf <code>null</code> sein</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Scope</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Legt den Scope einer Bean fest</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Import</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeiten aus anderer Config-Klasse importieren</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@ImportResource</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeiten aus XML-Datei importieren</p></td></tr></table></section>
<section id="_java_config_ohne_autowiring"><h2>Java-Config (ohne Autowiring)</h2><div class="paragraph heading"><p>ApplicationContext erzeugen und verwenden</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">ApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(CarConfig.class);
Car car = ctx.getBean(<span class="string"><span class="delimiter">&quot;</span><span class="content">firstCar</span><span class="delimiter">&quot;</span></span>, Car.class);</code></pre></section>
<section id="_aufgabe_2_wa_tor_mit_java_config_zusammenstöpseln"><h2>Aufgabe 2: Wa-Tor mit Java-Config zusammenstöpseln</h2><div class="paragraph"><p>Auch diese Aufgabe basiert auf der Methode <code>plumb</code> der Klasse <em>WatorAppNoSpring.java</em> im
Verzeichnis <em>src/main/java/wator</em>. Sie können auch Ihre vorherige Lösung als Gundlage verwenden.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Erstellen Sie die Klasse <code>wator.config.WatorConfig</code></p></li><li><p>Bauen Sie die Methode <code>plumb</code> als Java-Config nach</p></li><li><p>Fertigen Sie eine weitere Kopie von <code>WatorAppNoSpring</code> und
verwenden Sie diesmal <code>AnnotationConfigApplicationContext</code> in der <em>plumb</em> Methode.</p></li></ol></div></section>
<section><section id="_autowiring"><h2>Autowiring</h2><div class="paragraph heading"><p>Motivation</p></div><div class="ulist"><ul><li><p>Verdrahten von Beans erfordert viel Boilerplate (unübersichtlich, pflegeintensiv)</p></li><li><p>Oft ist Verdrahtung eindeutig</p></li><li><p>Per Reflection machbar</p></li></ul></div></section><section id="_die_anfänge_von_autowiring"><h2>Die Anfänge von Autowiring</h2><div class="ulist"><ul><li><p><code>&lt;bean autowire="&#8230;&#8203;"&gt;</code> &#8594; Setzt Autowiring für diese Bean auf &#8230;&#8203;</p><div class="ulist"><ul><li><p><code>no</code> &#8594; deaktivert</p></li><li><p><code>byName</code> &#8594; Zuordnung über Property-Name</p></li><li><p><code>byType</code> &#8594; Zuordnung über Property-Typ</p></li><li><p><code>constructor</code>&#8594; Zuordnung über Konstruktorargumente (Typ)</p></li></ul></div></li><li><p><code>&lt;bean autowire-candidate="false"&gt;</code> &#8594; Bean wird nicht für Autowiring verwendet</p></li><li><p><code>&lt;beans default-autowire-candidates="*Repository, *Service"&gt;</code> &#8594;
Alle Beans mit dem entsprechenden Namensmuster werden für Autowiring verwendet</p></li></ul></div></section><section id="_annotationen_für_autowiring"><h2>Annotationen für Autowiring</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Annotation</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Autowired</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Befüllt Property über Autowiring</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Nullable (bei Abhängigkeit)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeit darf <code>null</code> sein</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Required (deprecated)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängigkeit notwendig (nur bei Setter sinnvoll)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Primary</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Legt die bevorzugte Bean fest</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Qualifier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Makiert eine Bean oder eine Abhängigkeit</p></td></tr></table></section><section id="_aktivierung_von_autowiring"><h2>Aktivierung von Autowiring</h2><div class="paragraph"><p>Bei Java-Config standardmäßig aktiviert</p></div>
<div class="paragraph"><p>Bei XML-Config notwendig:</p></div>
<pre class="CodeRay listingblock"><code>&lt;context:annotation-config/&gt;</code></pre></section><section id="_field_autowiring"><h2>Field Autowiring</h2><div class="paragraph"><p>Es gibt 3 Arten von Autowiring. Am häufigsten wird diese Variante verwendet:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Engine engine;
<span class="annotation">@Autowired</span>
<span class="directive">private</span> <span class="predefined-type">List</span>&lt;Feature&gt; features;</code></pre></section><section id="_setter_autowiring"><h2>Setter Autowiring</h2><div class="paragraph"><p>Eher selten:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">public</span> <span class="type">void</span> setEngine(Engine engine) {
    <span class="local-variable">this</span>.engine = engine;
}

<span class="annotation">@Autowired</span>
<span class="directive">public</span> <span class="type">void</span> setFeatures(<span class="predefined-type">List</span>&lt;Feature&gt; features) {
    <span class="local-variable">this</span>.features = features;
}</code></pre></section><section id="_konstruktor_autowiring"><h2>Konstruktor Autowiring</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> <span class="directive">final</span> Engine engine;
<span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">List</span>&lt;Feature&gt; features;

<span class="annotation">@Autowired</span>
<span class="directive">public</span> CarConstructorWiring(Engine engine, <span class="predefined-type">List</span>&lt;Feature&gt; features) {
    <span class="local-variable">this</span>.engine = engine;
    <span class="local-variable">this</span>.features = features;
}</code></pre>
<div class="paragraph"><p>Nur sinnvoll in Kombination mit annotationsbasierter Konfiguration.<br>
Für Muss-Parameter in Kombination mit <code>final</code> empfohlen.</p></div></section><section id="_verwendung_von_primary"><h2>Verwendung von @Primary</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="annotation">@Primary</span>
Engine gasEngine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>, <span class="integer">68</span>);
}

<span class="annotation">@Bean</span>
Engine dieselEngine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span>, <span class="integer">72</span>);
}

<span class="annotation">@Bean</span>
Car car(Engine engine) {
   var car = <span class="keyword">new</span> Car();
   car.setEngine(engine);
   <span class="keyword">return</span> car;
}</code></pre>
<div class="paragraph"><p>Wird häufig für Tests verwendet.</p></div></section><section id="_verwendung_von_qualifier"><h2>Verwendung von @Qualifier</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>)
Engine gasEngine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>, <span class="integer">68</span>);
}

<span class="annotation">@Bean</span>
<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span>)
Engine dieselEngine() {
    <span class="keyword">return</span> <span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">diesel</span><span class="delimiter">&quot;</span></span>, <span class="integer">72</span>);
}

<span class="annotation">@Bean</span>
Car car(<span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">gas</span><span class="delimiter">&quot;</span></span>) Engine engine) {
    var car = <span class="keyword">new</span> Car();
    car.setEngine(engine);
    <span class="keyword">return</span> car;
}</code></pre>
<div class="paragraph"><p><code>@Qualifier</code> kann auch in Kombination mit <code>@Autowire</code> verwendet werden.<br>
Der Bean-Name ist immer auch ein Qualifier.</p></div></section><section id="_verwendung_von_nullable"><h2>Verwendung von @Nullable</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
Car car(<span class="annotation">@Nullable</span> Engine engine) {
    var car = <span class="keyword">new</span> Car();
    car.setEngine(engine);
    <span class="keyword">return</span> car;
}</code></pre>
<div class="paragraph"><p>Ohne <code>@Nullable</code> wäre die Konfiguration fehlerhaft, solange es keine <code>Engine</code> gibt.<br>
Ein <code>@Autowired(required=false)</code> hat die gleiche Wirkung.</p></div></section></section>
<section id="_aufgabe_3_konfiguration_mit_autowiring_vereinfachen"><h2>Aufgabe 3: Konfiguration mit Autowiring vereinfachen</h2><div class="olist arabic"><ol class="arabic"><li><p>Nutzen Sie Autowiring, um die <code>Random</code> und <code>Torus</code> Beans bei den beiden Strategies zu setzen.</p></li><li><p>Wann und durch wen wird das Autowiring durchgeführt? Verwenden Sie Setter-Autowiring und setzen
Sie in dem Setter einen Breakpoint, um das herauszufinden.</p></li><li><p>Optional: Wie müssten Sie die <code>WorldEngine</code> ändern, um Autowiring verwenden zu können?</p></li></ol></div></section>
<section><section id="_container_erweiterungspunkte"><h2>Container Erweiterungspunkte</h2><div class="paragraph"><p>Das Verhalten des Containers kann durch spezielle Beans beeinflusst werden, die
eines der folgenden Interfaces implementieren:</p></div><div class="paragraph"><p><br></p></div><div class="dlist"><dl><dt class="hdlist1">BeanPostProcessor</dt><dd><p>Nachbearbeitung aller Beans im Container, z. B. Auswertung von Annotationen</p></dd><dt class="hdlist1">BeanFactoryPostProcessor </dt><dd><p>Nachbearbeitung des Containers, bevor Beans erzeugt werden</p></dd><dt class="hdlist1">FactoryBean</dt><dd><p>Implementierung einer eigenen Factory für eine Bean (nicht mit <strong>ObjectFactory</strong> verwechseln!)</p></dd></dl></div><div class="paragraph"><p><br></p></div><div class="paragraph"><p>Diese Interfaces werden vor allem Spring-intern verwendet, z. B. für den
<code>AutowiredAnnotationBeanPostProcessor</code>.</p></div></section><section id="_beanpostprocessor"><h2>BeanPostProcessor</h2><div class="paragraph"><p>Implementierung</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LoggingBeanPostProcessor</span> <span class="directive">implements</span> BeanPostProcessor {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> postProcessBeforeInitialization(<span class="predefined-type">Object</span> bean, <span class="predefined-type">String</span> beanName) <span class="directive">throws</span> BeansException {
        <span class="comment">// Hier könnte man ein Stellvertreterobjekt zurückgeben, z. B. Proxy- oder</span>
        <span class="comment">// Decorator</span>
        <span class="keyword">return</span> bean;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> postProcessAfterInitialization(<span class="predefined-type">Object</span> bean, <span class="predefined-type">String</span> beanName) <span class="directive">throws</span> BeansException {
        <span class="predefined-type">System</span>.out.printf(<span class="string"><span class="delimiter">&quot;</span><span class="content">after-init %12s: %s%n</span><span class="delimiter">&quot;</span></span>, beanName, bean);
        <span class="keyword">return</span> bean;
    }
}</code></pre>
<div class="paragraph"><p>Konfiguration</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">static</span> BeanPostProcessor postProcessor() {
    <span class="keyword">return</span> <span class="keyword">new</span> LoggingBeanPostProcessor();
}</code></pre></section><section id="_beanfactorypostprocessor"><h2>BeanFactoryPostProcessor</h2><div class="paragraph"><p>Implementierung</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">LoggingBeanFactoryPostProcessor</span> <span class="directive">implements</span> BeanFactoryPostProcessor {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) <span class="directive">throws</span> BeansException {
        <span class="comment">// Hier könnte man den Container ändern, bevor die ersten Beans erzeugt werden.</span>
        <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">bean-factory: </span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.toString(beanFactory.getBeanDefinitionNames()));
    }
}</code></pre>
<div class="paragraph"><p>Konfiguration</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">static</span> BeanFactoryPostProcessor factoryPostProcessor() {
    <span class="keyword">return</span> <span class="keyword">new</span> LoggingBeanFactoryPostProcessor();
}</code></pre></section><section id="_factorybean"><h2>FactoryBean</h2><div class="paragraph"><p>Implementierung</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">CarFactoryBean</span> <span class="directive">implements</span> FactoryBean&lt;Car&gt; {

    <span class="directive">final</span> Car car = <span class="keyword">new</span> Car();
    {
        car.setEngine(<span class="keyword">new</span> Engine(<span class="string"><span class="delimiter">&quot;</span><span class="content">electric</span><span class="delimiter">&quot;</span></span>, <span class="integer">50</span>));
        car.setColor(<span class="string"><span class="delimiter">&quot;</span><span class="content">white</span><span class="delimiter">&quot;</span></span>);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Car getObject() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> car;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Class</span>&lt;?&gt; getObjectType() {
        <span class="keyword">return</span> Car.class;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> isSingleton() {
        <span class="keyword">return</span> <span class="predefined-constant">true</span>; <span class="comment">// Default-Implementierung</span>
    }
}</code></pre></section><section id="_factorybean_2"><h2>FactoryBean</h2><div class="paragraph"><p>Konfiguration</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
FactoryBean&lt;Car&gt; electricCar() {
    <span class="keyword">return</span> <span class="keyword">new</span> CarFactoryBean();
}</code></pre></section></section>
<section id="_aufgabe_4_konfiguration_mit_beanpostprocessor_verfolgen"><h2>Aufgabe 4: Konfiguration mit BeanPostProcessor verfolgen</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie einen <code>BeanPostProcessor</code>, der zu jeder Bean den Namen und die
String-Repräsenation der Bean logged.</p></li><li><p>Binden Sie diesen <code>BeanPostProcessor</code> in die Wa-Tor Applikation ein.</p></li><li><p>Welchen Unterschied macht es, wenn Sie die Bean-Methode dazu mit <code>static</code> deklarieren?</p></li><li><p>Optional: Implementieren sie eine <code>FactoryBean</code>, welche <em>Random</em> bereitstellt.</p></li></ol></div></section>
<section id="_annotationsbasierte_konfiguration" data-state="no-title-footer"><h2>Annotationsbasierte Konfiguration</h2><div class="paragraph center"><p>Was ist das?</p></div></section>
<section><section id="_annotationsbasierte_konfiguration_2"><h2>Annotationsbasierte Konfiguration</h2><div class="paragraph heading"><p>Aktivieren der annotationsbasierten Konfiguration</p></div><div class="title">XML-Config</div><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;beans</span> <span class="attribute-name">xmlns</span>=<span class="attribute-value">...</span><span class="tag">&gt;</span>
    <span class="tag">&lt;context:component-scan</span> <span class="attribute-name">base-package</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    ...
<span class="tag">&lt;/beans&gt;</span></code></pre><div class="title">Java-Config</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SomeConfig</span> {
    <span class="comment">// ...</span>
}</code></pre><div class="paragraph"><p>Mit Component-Scanning werden zwangsläufig Annotationen ausgewertet.<br>
Ein <code>&lt;context:annotation-config/&gt;</code> ist damit überflüssig.</p></div></section><section id="_annotationen_für_annotationsbasierten_konfiguration"><h2>Annotationen für annotationsbasierten Konfiguration</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Annotation</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@ComponentScan</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Festlegung der Packages, die für annotationsbasierte Konfiguration herangezogen werden</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Component (@Service, @Repository, @Controller)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Markiert eine Klasse als Bean</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Value</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wertangabe mit den Features der XML-Config</p></td></tr></table></section><section id="_meta_annotationen_und_zusammengesetze_annotationen"><h2>Meta-Annotationen und Zusammengesetze Annotationen</h2><div class="title">org.springframework.stereotype.Service</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@Component</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> Service {

    <span class="comment">/**
     * The value may indicate a suggestion for a logical component name,
     * to be turned into a Spring bean in case of an autodetected component.
     * @return the suggested component name, if any (or empty String otherwise)
     */</span>
    <span class="annotation">@AliasFor</span>(annotation = <span class="predefined-type">Component</span>.class)
    <span class="predefined-type">String</span> value() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><strong>@Service</strong>, <strong>@Repository</strong> und <strong>@Controller</strong> sind Annotationen, die selbst wiederum mit <strong>@Component</strong> annotiert sind.</td></tr></table></div>
<div class="paragraph"><p>Zusammengesetzte Annotationen sind Meta-Annotation, die mit mehreren Annotationen annotiert sind.</p></div></section><section id="_varianten_zur_angabe_der_packages"><h2>Varianten zur Angabe der Packages</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ComponentScan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example1</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ComponentScan</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example2</span><span class="delimiter">&quot;</span></span>) <span class="comment">// ComponentScan ist Repeatable</span>

<span class="annotation">@ComponentScan</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example2</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ComponentScan</span>(value = {<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example2</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ComponentScan</span>(basePackages = {<span class="string"><span class="delimiter">&quot;</span><span class="content">org.example1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">org.example2</span><span class="delimiter">&quot;</span></span>}) <span class="comment">// sind alle äquivalent</span>

<span class="annotation">@ComponentScan</span>(basePackageClasses = BigDieselEngine.class) <span class="comment">// robust gegen Refactorings</span></code></pre></section><section id="_filter"><h2>Filter</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ComponentScan</span>(basePackageClasses = BigDieselEngine.class,
               excludeFilters = <span class="annotation">@Filter</span>(type=FilterType.ANNOTATION, <span class="comment">// default</span>
                                        classes = Service.class))

<span class="annotation">@ComponentScan</span>(basePackageClasses = BigDieselEngine.class,
               excludeFilters = <span class="annotation">@Filter</span>(type = FilterType.ASSIGNABLE_TYPE,
                                        classes = Umbrella.class))

<span class="annotation">@ComponentScan</span>(basePackageClasses = BigDieselEngine.class,
                   excludeFilters = <span class="annotation">@Filter</span>(type=FilterType.REGEX,
                                            pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">.*Umbrella</span><span class="delimiter">&quot;</span></span>))

<span class="annotation">@ComponentScan</span>(basePackageClasses = BigDieselEngine.class,
               excludeFilters = <span class="annotation">@Filter</span>(type=FilterType.ASPECTJ, <span class="comment">// erfodert spring-aspects</span>
                                        pattern=<span class="string"><span class="delimiter">&quot;</span><span class="content">*..Umbrella</span><span class="delimiter">&quot;</span></span>))</code></pre>
<div class="paragraph"><p>Über <code>FilterType.CUSTOM</code> kann man auch eine eigene Filter-Implementierung angeben.</p></div></section><section id="_weitere_konfigurationsmöglichkeiten"><h2>Weitere Konfigurationsmöglichkeiten</h2><div class="paragraph"><p>Die ComponentScan Annotation bietet noch weitere Konfiurationsmöglichkeiten:</p></div>
<div class="ulist"><ul><li><p>Include-/Exclude-Filter</p></li><li><p>Verwendung der Default-Filter (@Component, @Service, &#8230;&#8203;) an-/abschalten</p></li><li><p>Generator für Bean-Namen</p></li><li><p>Lazy-Intialisierung der gefundenen Beans</p></li><li><p>Scope-Resolver</p></li><li><p>Proxies für Beans erzeugen</p></li></ul></div>
<div class="paragraph"><p>Für Details siehe <a href="https://docs.spring.io/spring/docs/5.3.6/javadoc-api/org/springframework/context/annotation/ComponentScan.html">Javadocs</a>.</p></div></section></section>
<section id="_aufgabe_5_annotationsbasierte_konfiguration"><h2>Aufgabe 5: Annotationsbasierte Konfiguration</h2><div class="olist arabic"><ol class="arabic"><li><p>Löschen Sie in Ihrer Java-Config die beiden Bean-Methoden, welche die Beans für die <code>FishStrategy</code> und die <code>SharkStrategy</code>
erzeugen. Verwenden Sie stattdessen die Annotationen <code>@ComponentScan</code> und <code>@Service</code>.</p></li><li><p>Stellen Sie auch die <code>WorldEngine</code> auf annotationsbasierte Konfiguration um. Dafür sind mehrere Anpassungen notwendig:</p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Führen Sie Instanzvariablen für die Konfigurationswerte <code>fishRate</code> und <code>sharkRate</code> ein</p></li><li><p>Nutzen Sie Konstruktor-Autowiring für alle Abhängigkeiten</p></li><li><p>Initialisieren sie die <code>WorldEngine</code> über <code>@PostConstruct</code> oder das <code>InitializingBean</code> Interface.</p></li></ol></div></li></ol></div></section>
<section id="_jee_annotationen"><h2>JEE-Annotationen</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:33.3333%"><col style="width:33.3334%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JSR-330</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Spring</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">JSR-250<br>
  <span class="small">(bis Java 10 im JDK enthalten)</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Inject</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">@Autowired</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">@Resource</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Named</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">@Component<br>
  <span class="small">Meta-Annotationen:<br>
  @Service, @Respository oder @Controller</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">@ManagedBean<br>
<span class="small">(Kein Bestandteil des JDK)</span></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Singleton<br>
  <span class="small">(Laut JSR-330 ist Default-Scope <em>prototype</em><br>
  bei Spring dagegen: <em>singleton</em>)</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">@Scope("singleton")</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Named<br>
@Qualifier <span class="small">(nur für Meta-Annotation)</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">@Qualifier</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Provider&lt;T&gt;<br>
  <span class="small">(mit Methode <code>T get()</code>)</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">ObjectFactory&lt;T&gt;<br>
  <span class="small">(mit Methode <code>T getObject()</code>)</span></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td></tr></table>
<aside class="notes"><div class="ulist"><ul><li><p>Gemäß JSR-330 ist der Default-Scope für Beans immer <em>prototype</em>. Bei Spring ist der Default-Scope aber immer <em>singleton</em>,
deshalb ist die <code>@Singleton</code> Annotation bei Spring nicht notwendig.</p></li><li><p>JSR-330 kennt auch eine <code>@Qualifier</code> Annotation, diese kann aber nur für Meta-Annotationen verwendet werden</p></li><li><p><code>Provider</code> und <code>ObjectFactory</code> sind keine Annotationen, sondern Factory-Interfaces</p></li><li><p>Seit Java 11 ist der JSR-250 und damit die Annotationen <code>@Resource</code>, <code>@PostConstruct</code> und <code>@PreDestory</code> kein Bestandteil
des JDK mehr. <code>@ManagedBean</code> war ohnehin noch nie Bestandteil des JDK.</p></li></ul></div></aside></section>
<section id="_aufgabe_6_optional_jsr_330_annotationen"><h2>Aufgabe 6 (optional): JSR-330 Annotationen</h2><div class="paragraph"><p>Stellen Sie die Wa-Tor Anwendung auf JSR-330 Annotationen um.
Dafür sind folgende Anpassungen notwendig:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Maven-Abhängigkeit zu <code>javax.inject:javax.inject:1</code> oder <code>org.glassfish.hk2.external:jakarta.inject:2.6.1</code> ergänzen</p></li><li><p>Modul-Abhängigkeit für <code>javax.inject</code> bzw. <code>jakarta.inject</code> in <code>module-info.java</code> eintragen</p></li><li><p>Annotationen <code>@Autowired</code> und <code>@Component</code> durch <code>@Inject</code> und <code>@Named</code> ersetzen</p></li></ol></div></section>
<section><section id="_asynchrone_ausführung_und_hintergrundprozesse"><h2>Asynchrone Ausführung und Hintergrundprozesse</h2><div class="ulist"><ul><li><p>Spring bietet die Abstraktionen <code>TaskExecutor</code> und <code>TaskScheduler</code></p></li><li><p><code>TaskExecutor</code> ist identisch zu <code>java.util.concurrent.Executor</code></p></li><li><p>Für beide Interfaces liegen diverse Implementierungen vor</p></li><li><p><code>@EnableAsync</code> und <code>@EnableScheduling</code> aktivieren eine Default-Konfiguration für asynchrone Ausführung
bzw. Hintergrundprozesse.</p></li><li><p>Mit <code>@Async</code> annotierten Bean-Methode werden asynchron ausgeführt</p></li><li><p>Mit <code>@Scheduled</code> annotierte Beans werden in regelmäßig im Hintegrund ausgeführt</p></li></ul></div><div class="paragraph"><p>Weitere Hinweise dazu finden Sie in der
<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/integration.html#scheduling">
Spring Framework Referenzdokumentation, Abschnitt 'Task Execution and Scheduling'</a>.</p></div></section><section id="_enablescheduling"><h2>@EnableScheduling</h2><div class="title">org.springframework.scheduling.annotation.EnableScheduling</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.TYPE)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Import</span>(SchedulingConfiguration.class)
<span class="annotation">@Documented</span>
<span class="directive">public</span> <span class="annotation">@interface</span> EnableScheduling {

}</code></pre>
<div class="ulist"><ul><li><p>Die <strong>@Enable&#8230;&#8203;</strong> Annotationen aktivieren diverse Spring-Features</p></li><li><p>Üblicherweise werden <code>@Configuration</code> Klassen damit annotiert,<br>
möglich sind aber beliebige Bean-Klassen.</p></li><li><p>Es handelt sich dabei immer um Meta-Annotationen, die mit
<code>@Import</code> eine weitere Konfiguration einbinden.</p></li></ul></div></section><section id="_schedulingconfiguration"><h2>SchedulingConfiguration</h2><div class="title">org.springframework.scheduling.annotation.SchedulingConfiguration</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Role</span>(BeanDefinition.ROLE_INFRASTRUCTURE)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SchedulingConfiguration</span> {

    <span class="annotation">@Bean</span>(name = TaskManagementConfigUtils.SCHEDULED_ANNOTATION_PROCESSOR_BEAN_NAME)
    <span class="annotation">@Role</span>(BeanDefinition.ROLE_INFRASTRUCTURE)
    <span class="directive">public</span> ScheduledAnnotationBeanPostProcessor scheduledAnnotationProcessor() {
        <span class="keyword">return</span> <span class="keyword">new</span> ScheduledAnnotationBeanPostProcessor();
    }

}</code></pre>
<div class="paragraph"><p>Der <code>ScheduledAnnotationBeanPostProcessor</code> ist ein <code>BeanPostProcessor</code>, der die
<code>@Scheduled</code> Annotationen verarbeitet und die entsprechende Methode bei
einem <code>TaskScheduler</code> registriert.</p></div></section><section id="_scheduled"><h2>@Scheduled</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Scheduled(fixedDelay=5000)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Nach 5 Sek. erneut ausführen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Scheduled(fixedRate=5000)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Alle 5 Sek. ausführen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Scheduled(initialDelay=1000, fixedRate=5000)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Nach initialer Pause von 1 Sek. alle 5 Sek. ausführen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Scheduled(cron="*/5 * * * * MON-FRI")</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">An Wochentagen alle 5 Sek. ausführen</p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Scheduled</span>(fixedDelay=<span class="integer">5000</span>)
<span class="directive">public</span> <span class="type">void</span> doSomething() {
    <span class="comment">// something that should execute periodically</span>
}</code></pre>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Über <code>fixedDelayString</code>, <code>fixedRateString</code> und <code>initialDelayString</code> können die Werte auch als String
angegeben werden. Das ist notwendig, um die Werte von außen konfigurierbar zu machen.</p></div></section></section>
<section id="_aufgabe_7_optional_scheduling_verwenden"><h2>Aufgabe 7 (optional): Scheduling verwenden</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie eine <em>Timer</em> Bean, welche jede Sekunde
<code>worldEngine.tick()</code> und <code>torus.dump(count)</code> aufruft.</p></li><li><p>Binden Sie die Bean in die Wa-Tor Application ein und aktivieren Sie das <em>Scheduling</em>.</p></li><li><p>Löschen Sie den Aufruf der <code>run()</code> Methode aus Ihrer <em>main</em>-Klasse.</p></li><li><p>Sehen Sie sich die Logausgaben ihres <em>BeanPostProcessor</em> an.<br>
Was hat sich im <em>ApplicationContext</em> geändert?</p></li><li><p>Analysieren Sie die <em>Timer</em> Bean mit dem Debugger.<br>
Wer ruft die Methode mit der <code>@Scheduled</code> Annotation auf?</p></li></ol></div></section>
<section><section id="_wa_tor_mit_java_fx_oberfläche"><h2>Wa-Tor mit Java FX Oberfläche</h2><div class="paragraph center"><p><span class="image"><img src="images/WatorFx.png" alt="WatorFx" height="800"></span></p></div></section><section id="_java_fx"><h2>Java FX</h2><div class="ulist"><ul><li><p>UI-Technologie für Desktop-Anwendungen</p></li><li><p>Als Nachfolger von Swing gedacht</p></li><li><p>Seit Java 11 kein Bestandteil des JDK mehr</p></li><li><p>Über Maven-Central (z. B. <code>org.openjfx:javafx-controls:12</code>) verfügbar</p></li><li><p>Erfordert Java 9 Modulsystem</p></li><li><p>Wird auf <a href="https://openjfx.io/" class="bare">https://openjfx.io/</a> gepflegt</p></li><li><p>Ohne Modulsystem ist das <a href="https://gluonhq.com/products/javafx">JavaFX SDK</a> notwendig
und die Anwendung muss mit<br>
<code>--module-path &lt;path-to-sdk&gt;/lib --add-modules=javafx.controls</code><br>
aufgerufen werden.</p></li></ul></div></section><section id="_nachträgliches_autowiring_für_existierende_objekte"><h2>Nachträgliches Autowiring für existierende Objekte</h2><div class="ulist"><ul><li><p>Manchmal hat man auf die Erzeugung eines Objekts keinen Einfluss<br>
(z. B. bei einer Java FX Applikationsklasse)</p></li><li><p>Dennoch ist Autowiring möglich:</p></li></ul></div>
<pre class="CodeRay listingblock"><code class="java language-java">ctx.getAutowireCapableBeanFactory().autowireBean(object);</code></pre>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Man kann auch eine Configuration-Klasse mit einer main-Methode ausstatten.<br>
Das ist für Mini-Programme nützlich, die nur aus einer Klasse bestehen.</td></tr></table></div></section></section>
<section id="_aufgabe_8_optional_fx_torus_einbinden"><h2>Aufgabe 8 (optional): Fx-Torus einbinden</h2><div class="paragraph"><p>Die Klasse <code>WritableImageTorus</code> ist eine Torus-Implementierung,
bei der jede Zelle einem Pixel auf einer Bitmap entspricht.
Fische erscheinen als blaue Pixel und Haie als gelbe Pixel.
Die Applikation <code>WatorAppFx</code> zeigt diesen Torus an.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prüfen Sie, ob die Anwendung <strong>WatorAppFx</strong> lauffähig ist</p></li><li><p>Erstellen Sie eine Kopie Ihrer Java-Config, die statt dem <code>SimpleTorus</code>
einen <code>WritableImageTorus</code> mit Auflösung 800 x 600 erstellt.</p></li><li><p>Ersetzten Sie die Methode <code>plumb</code> durch Verwendung eines
entsprechenden <em>ApplicationContext</em>.</p></li><li><p>Die <em>Timer</em> Bean aus der vorherigen Ausgabe funktioniert nicht
für den <code>WritableImageTorus</code>. Ergänzen Sie deshalb die <code>@ComponentScan</code>
Annotation um einen Exclude-Filter, der die <em>Timer</em> Bean ausschließt.</p></li><li><p>Nutzen Sie Autowiring, um <code>torus</code> und <code>worldEngine</code>
in <strong>WatorAppFx</strong> zu setzen.</p></li></ol></div></section>
<section id="_konfiguration_auf_mehrere_xml_dateien_oder_config_klassen_aufteilen"><h2>Konfiguration auf mehrere XML-Dateien oder Config-Klassen aufteilen</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Beispiel</th><th class="tableblock halign-left valign-top">Beschreibung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">&lt;import resource="base-config"/&gt;</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Import der Definitionen von einer anderen XML-Datei.
 Pfadangaben sind relativ zur importierenden Datei.</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@ImportResource("classpath:/base-config.xml")</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Import der Definitionen aus einer XML-Datei in eine Java-Configuration</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">@Import(BaseConfig.class)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Import der Definitionen aus einer anderen Java-Config</p></td></tr></table>
<div class="title">Beispiel für Import einer Konfiguration:</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@Import</span>(BaseConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MasterConfig</span> {
    <span class="comment">// ...</span>
}</code></pre></section>
<section id="_aufgabe_9_optional_konfiguration_auf_mehrere_klassen_aufteilen"><h2>Aufgabe 9 (optional): Konfiguration auf mehrere Klassen aufteilen</h2><div class="olist arabic"><ol class="arabic"><li><p>Lagern Sie gemeinsame Teile (Random, LogBeansPostProcessor) aus den beiden Java-Configs
(für ursprüngliche Anwendung und für Fx-Anwendung) in eine <strong>WatorBaseConfig</strong> aus.</p></li><li><p>Verwenden Sie die <code>@Import</code> Annotation um die <strong>WatorBaseConfig</strong> in die beiden Java-Configs
einzubinden.</p></li></ol></div></section>
<section id="_applicationcontext_konfiguration_2"><h2>ApplicationContext Konfiguration</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson04-config.html">&#8594; Weiter zu Externe Konfiguration</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_4_externe_konfiguration" data-state="no-title-footer"><h2>Lektion 4 - Externe Konfiguration</h2></section>
<section id="_externe_konfiguration"><h2>Externe Konfiguration</h2><div class="paragraph heading"><p>Themen</p></div>
<div class="ulist"><ul><li><p>Zugriff auf Ressourcen</p></li><li><p>Konfiguration über eine Properties-Datei</p></li><li><p>Umschalten zwischen Konfigurationsdateien</p></li><li><p>Spring Expression Language</p></li><li><p>Spring Environment</p></li><li><p>Implementierung einer PropertySource</p></li><li><p>Flexible Konfiguration mittels Profilen</p></li><li><p>Verwendung der @Conditional Annotation</p></li></ul></div></section>
<section><section id="_ressourcen"><h2>Ressourcen</h2><div class="paragraph heading"><p>Was sind Ressourcen?</p></div><div class="ulist"><ul><li><p>Ressourcen sind beliebige Dateien (Bilder, Schriften, Konfigurationsdateien, Daten, etc.)</p></li><li><p><code>java.net.URL</code> hat Einschränkungen:</p><div class="ulist"><ul><li><p>Kein Zugriff auf Ressourcen im <em>classpath</em></p></li><li><p>Kein Zugriff auf Ressourcen relativ zu ServletContext</p></li><li><p>Keine Prüfung, ob Ressource existiert</p></li></ul></div></li><li><p>Spring bietet eigene Abstraktion über das <code>Resource</code> Interface</p></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#resources">
&#8594; Reference: Resources</a></p></div></section><section id="_das_resource_interface"><h2>Das Resource Interface</h2><div class="title">Resource.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">Resource</span> <span class="directive">extends</span> InputStreamSource {
        <span class="type">boolean</span> exists();
        <span class="predefined-type">URL</span> getURL() <span class="directive">throws</span> <span class="exception">IOException</span>;
        <span class="predefined-type">File</span> getFile() <span class="directive">throws</span> <span class="exception">IOException</span>;
        Resource createRelative(<span class="predefined-type">String</span> relativePath) <span class="directive">throws</span> <span class="exception">IOException</span>;
        <span class="predefined-type">String</span> getFilename();
        <span class="predefined-type">String</span> getDescription();
        ...
}</code></pre>
<div class="title">InputStreamSource.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">interface</span> <span class="class">InputStreamSource</span> {
        <span class="predefined-type">InputStream</span> getInputStream() <span class="directive">throws</span> <span class="exception">IOException</span>;
}</code></pre></section><section id="_resource_implementierungen"><h2>Resource Implementierungen</h2><div class="imageblock" style=""><img src="images/Resource.svg" alt="Resource" width="1600" height="250"></div></section><section id="_resourceloader"><h2>ResourceLoader</h2><div class="imageblock" style=""><img src="images/ResourceLoader.svg" alt="ResourceLoader" width="1600" height="500"></div></section><section id="_resource_location"><h2>Resource Location</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:20%"><col style="width:40%"><col style="width:40%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Präfix</th><th class="tableblock halign-left valign-top">Beispiel</th><th class="tableblock halign-left valign-top">Erklärung</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">classpath:</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">classpath:com/myapp/config.xml</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Aus dem <em>classpath</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">classpath*:</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">classpath*:META-INF/beans.xml</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Alle META-INF/beans.xml im <em>classpath</em></p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">file:</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="file:///data/config.xml" class="bare">file:///data/config.xml</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Datei /data/config.xml</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">http:</p></td><td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://myserver/logo.png" class="bare">http://myserver/logo.png</a></p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Als URL</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">(ohne)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">com/myapp/config.xml</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Abhängig vom <code>ApplicationContext</code></p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Die <em>Resource</em> Abstraktion kann man auch ohne den Rest von Spring verwenden.</td></tr></table></div></section><section id="_verwendung_einer_ressource"><h2>Verwendung einer Ressource</h2><div class="ulist"><ul><li><p>Ressource über ApplicationContext laden</p><div class="literalblock"><div class="content"><pre>Resource resource = ctx.getResource("classpath:config.properties");</pre></div></div></li><li><p>Resource per Dependency Injection</p><div class="literalblock"><div class="content"><pre>@Value("classpath:config.properties")
private Resource config;</pre></div></div></li></ul></div></section><section id="_implementieren_von_resourceloaderaware"><h2>Implementieren von ResourceLoaderAware</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">ResourceLoaderAwareBean</span> <span class="directive">implements</span> ResourceLoaderAware, InitializingBean {
    <span class="directive">private</span> ResourceLoader resourceLoader;
    <span class="directive">private</span> <span class="predefined-type">Properties</span> config;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> setResourceLoader(ResourceLoader resourceLoader) {
        <span class="local-variable">this</span>.resourceLoader = resourceLoader;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> afterPropertiesSet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        Resource resource = resourceLoader.getResource(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:config.properties</span><span class="delimiter">&quot;</span></span>);
        config = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
        config.load(resource.getInputStream());
    }
}</code></pre>
<div class="paragraph"><p>Jede Bean, die <code>ResourceLoaderAware</code> implementiert erhält den <code>ResourceLoader</code>.</p></div></section></section>
<section id="_aufgabe_1_eine_properties_datei_mittels_resource_abstraction_laden"><h2>Aufgabe 1: Eine Properties-Datei mittels Resource-Abstraction laden</h2><div class="paragraph"><p>Nutzen Sie den <code>ApplicationContext</code> in <code>WatorAppSimple</code>, um die <em>wator-prod.properties</em> Datei
als <code>Resource</code> zu laden und geben Sie den Inhalt dieser Datei mit der Methode <code>dumpProperties</code> aus.</p></div>
<div class="paragraph"><p><br></p></div>
<div class="title">WatorAppSimple.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> <span class="type">void</span> dumpProperties(<span class="predefined-type">InputStream</span> is) <span class="directive">throws</span> <span class="exception">IOException</span> {
    <span class="predefined-type">Properties</span> props = <span class="keyword">new</span> <span class="predefined-type">Properties</span>();
    props.load(is);
    props.list(<span class="predefined-type">System</span>.out);
}</code></pre></section>
<section><section id="_externe_konfiguration_2"><h2>Externe Konfiguration</h2><div class="paragraph heading"><p>Motivation</p></div><div class="paragraph"><p>Manche Konfigurationswerte sind</p></div><div class="ulist"><ul><li><p>zum Entwicklungszeitpunkt noch nicht bekannt,</p></li><li><p>sind abhängig von der Laufzeitumgebung oder</p></li><li><p>müssen nachträglich änderbar sein.</p></li></ul></div><div class="paragraph"><p>Im Java-Umfeld werden dafür meistens Properties-Dateien verwendet.<br>
Diese enthalten einfache Key-Value Paare:</p></div><div class="literalblock"><div class="content"><pre>server.port=8081
debug: true</pre></div></div><div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Man kann entweder '=' oder ': ' als Trenner zwischen Schlüssel und Wert verwenden.</td></tr></table></div></section><section id="_propertysource"><h2>@PropertySource</h2><div class="paragraph"><p>Bei Spring bindet man eine Properties-Datei über die <code>@PropertySource</code> Annotation ein:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:app.properties</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyJavaConfig</span> {
    <span class="comment">//...</span>
}</code></pre>
<div class="paragraph"><p>Das XML-Gegenstück ist:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;context:property-placeholder</span> <span class="attribute-name">location</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:app.properties</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre></section><section id="_zugriff_auf_property_werte"><h2>Zugriff auf Property-Werte</h2><div class="paragraph"><p>Platzhalter der Form <code>${key}</code> werden in Annotationsparameter durch die
entsprechenden Property-Werte ersetzt.
Häufig wird das in Kombination mit der <code>@Value</code> Annotation verwendet:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${server.port}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">int</span> serverPort;

<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:${server.port}/</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> serverUrl;

<span class="annotation">@Bean</span>
SomeService someService(<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${debug}</span><span class="delimiter">&quot;</span></span>) <span class="type">boolean</span> debug) {</code></pre>
<div class="paragraph"><p>In XML genügt es direkt die <code>${key}</code> Platzhalter in Werten zu verwenden.</p></div></section><section id="_defaultwerte"><h2>Defaultwerte</h2><div class="paragraph"><p>Man kann auch Platzhalter mit Defaultwerten definieren. Das lässt sich sogar schachteln:</p></div>
<div class="title">AppConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${service.port:9080}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">int</span> servicePort;

<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">${service.url:http://localhost:${service.port:9080}/}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="predefined-type">String</span> serviceUrl;</code></pre>
<div class="paragraph"><p>Platzhalter lassen sich insbesondere auch für die <code>@PropertySource</code> verwenden:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PropertySource</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:config-${platform:dev}.properties</span><span class="delimiter">&quot;</span></span>)</code></pre>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Damit sind unterschiedliche Konfigurationen für verschiede Plattformen möglich.</td></tr></table></div></section><section id="_werte_für_platzhalter_setzen"><h2>Werte für Platzhalter setzen</h2><div class="paragraph"><p>Platzhalter-Werte können auch über Umgebungsvariablen oder System-Properties (<code>-Dservice.port=5555</code>) angegeben
werden, diese überschreiben ggf. entsprechende Werte aus Properties-Dateien. Dabei haben System-Properties
die höchste Priorität.</p></div>
<div class="admonitionblock caution teacherBox"><table><tr><td class="icon"><i class="fa fa-fire" title="Caution"></i></td><td class="content">Wie überall bei Java kommt es bei Properties auf Groß-/Kleinschreibung an!</td></tr></table></div></section><section id="_propertysourcesplaceholderconfigurer"><h2>PropertySourcesPlaceholderConfigurer</h2><div class="paragraph"><p>Bei älteren Spring-Versionen (vor 4.3) war es notwendig explizit einen <code>PropertySourcesPlaceholderConfigurer</code>
anzulegen, damit <code>${key}</code> Platzhalter ersetzt wurden. Dieser musste im ApplicationContext vorhanden sein, bevor
der 1. Platzhalter zu interpretieren war, deshalb wurde er mit einer <code>static</code> Methode erzeugt:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
<span class="directive">public</span> <span class="directive">static</span> PropertySourcesPlaceholderConfigurer placeholderConfigurer() {
    <span class="keyword">return</span> <span class="keyword">new</span> PropertySourcesPlaceholderConfigurer();
}</code></pre>
<div class="admonitionblock warning teacherBox"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Nicht mit dem veralteten <code>PropertyPlaceholderConfigurer</code> verwechseln!</td></tr></table></div></section></section>
<section id="_aufgaben_2_externe_konfiguration_über_properties_dateien"><h2>Aufgaben 2: Externe Konfiguration über Properties Dateien</h2><div class="olist arabic"><ol class="arabic"><li><p>Ergänzen Sie die <code>WatorBaseConfig</code> um die <code>@PropertySource</code> Notation, so dass die <em>wator-prod.properties</em>
geladen wird.</p></li><li><p>Machen Sie die entsprechenden Werte über <code>fish.breedTime</code>, <code>shark.breedTime</code> und <code>shark.starveTime</code>
konfigurierbar. Die Defaultwerte sollen bestehen bleiben.</p></li><li><p>Konfigurieren Sie die Wiederholungsrate für den <code>Timer</code> mit der Property <code>tick.millis</code>. Sie müssen dafür
die Verzögerung über <code>fixedDelayString</code> statt über <code>fixedDelay</code> angeben.</p></li><li><p>Erstellen Sie eine Kopie <em>wator-dev.properties</em> der <em>wator-prod.properties</em> und sorgen Sie dafür,
dass man mit <code>-Dplatform=dev</code> zwischen den Konfigurationen umschalten kann.</p></li><li><p>Stellen Sie sicher, dass die Anwendung auch noch läuft, wenn Sie z.B. mit <code>-Dplatform=none</code> aufgerufen wird.
Sie müssen dafür bei der PropertySource <code>ignoreResourceNotFound = true</code> setzen.</p></li><li><p><em>Optional:</em> Falls Sie noch Zeit haben, dann führen Sie die gleichen Änderungen bei der XML basierten
Konfiguration durch. Sie benötigen dafür `&lt;context:property-placeholder &#8230;&#8203;/&gt;'.</p></li></ol></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Sie sehen die aktuellen Einstellungen beim Starten der Applikation in den Logausgaben.<br>
Dafür sorgt der <code>LogBeansPostProcessor</code>.</td></tr></table></div></section>
<section><section id="_spring_expression_language_spel"><h2>Spring Expression Language (SpEL)</h2><div class="paragraph heading"><p>Motivation</p></div><div class="ulist"><ul><li><p>Für den Fall, dass einfache <code>${}</code> Platzhalter nicht ausreichen,<br>
bietet Spring eine sehr mächtige Expression Language.</p></li><li><p>Expressions werden genauso wie Platzhalter verwendet, aber haben<br>
die Form <code>#{}</code>, z. B. <code>#{ 1 + 1 }</code>.</p></li><li><p>Man kann auch Platzhalter in Expressions verwenden,<br>
beispielsweise: <code>#{ ${service.port} + 1 }</code>.</p></li></ul></div></section><section id="_spel_beispiele"><h2>SpEL Beispiele</h2><div class="title">AppConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ 'http://localhost:' + (${server.port} + 1) }</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> urlValue,
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ T(java.lang.Math).random() * 100.0 }</span><span class="delimiter">&quot;</span></span>) <span class="type">double</span> randomValue,
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ someService.serviceValue }</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> beanProperty,
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ systemProperties['service.port'] ?: 8888 }</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span> systemProperty, <span class="comment">// Elvis Operator</span>
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ {1, 3, 5, 7} }</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">List</span>&lt;<span class="predefined-type">Integer</span>&gt; listValue,
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ {banane: 'gelb', tomate: 'rot', gurke: 'grün'} }</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">String</span>&gt; mapValue,
<span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ new int[]{3,2,1} }</span><span class="delimiter">&quot;</span></span>) <span class="type">int</span><span class="type">[]</span> arrayValue, <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">#{ 'abcde'.substring(1, 4) }</span><span class="delimiter">&quot;</span></span>) <span class="predefined-type">String</span> subString</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#expressions">
&#8594; Reference: Spring Expression Language (SpEL)</a>.</p></div></section></section>
<section id="_aufgabe_3_verwendung_der_spring_expression_language_spel"><h2>Aufgabe 3: Verwendung der Spring Expression Language (SpEL)</h2><div class="olist arabic"><ol class="arabic"><li><p>Nutzen Sie EL-Ausdrücke, um die Werte folgendermaßen zu setzen:</p><div class="literalblock"><div class="content"><pre>sharkBreedTime = fishBreedTime * 2
sharkStarveTime = fishBreedTime * 2 - 2</pre></div></div></li><li><p>Für die <em>fishBreedTime</em> soll zusätzlich gelten:</p><div class="literalblock"><div class="content"><pre>fishBreedTime =
    Wert aus der Property fish.breedTime falls gesetzt
    Andernfalls: Zufallswert zwischen 2 und 20</pre></div></div></li><li><p>Wie hätten Sie diese Aufgabe ohne Expression-Language gelöst?</p></li></ol></div></section>
<section><section id="_environment"><h2>Environment</h2><div class="paragraph heading"><p>Hintergrund</p></div><div class="paragraph"><p>Das <code>Environment</code> ist die Quelle für Platzhalter-Werte.</p></div><div class="paragraph"><p>Statt über die <code>@Value</code> Annotation kann man das
<code>Environment</code> auch direkt verwenden:</p></div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Autowired</span>
<span class="directive">private</span> Environment env;</code></pre><div class="paragraph"><p>Zum Zugriff auf die Werte bietet <code>Environment</code> verschiedene <code>getProperty</code> Methoden, z.B. mit Typ und Defaultwert:</p></div><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">int</span> port = env.getProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">service.port</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class, <span class="integer">8079</span>);</code></pre><div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Gegenüber der Expression Language bietet der direkte Zugriff auf das Environment den Vorteil, dass Syntaxfehler
direkt vom Compiler erkannt werden.</td></tr></table></div></section><section id="_environment_datenstruktur"><h2>Environment Datenstruktur</h2><div class="imageblock" style=""><img src="images/Environment.svg" alt="Environment" width="1600" height="300"></div>
<div class="paragraph"><p>Die Reihenfolge der Property Sources bestimmt die Priorität (der Erste gewinnt).</p></div></section><section id="_propertysource_implementieren"><h2>PropertySource implementieren</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleMapPropertySource</span> <span class="directive">extends</span> PropertySource&lt;<span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt;&gt; {
    <span class="directive">public</span> SimpleMapPropertySource(<span class="predefined-type">String</span> name, <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; source) {
        <span class="local-variable">super</span>(name, source); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> getProperty(<span class="predefined-type">String</span> name) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> source.get(name);
    }
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Jede <code>PropertySource</code> hat einen Namen und Optional eine Quelle für die Propertywerte</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Die <code>getProperty()</code> Methode muss auf jeden Fall implementiert werden</td></tr></table></div></section><section id="_propertysource_verwenden"><h2>PropertySource verwenden</h2><pre class="CodeRay listingblock"><code class="java language-java">SimpleMapPropertySource propertySource = <span class="keyword">new</span> SimpleMapPropertySource(<span class="string"><span class="delimiter">&quot;</span><span class="content">simple-map</span><span class="delimiter">&quot;</span></span>, map);
AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(); <i class="conum" data-value="1"></i><b>(1)</b>
ctx.getEnvironment().getPropertySources().addLast(propertySource); <i class="conum" data-value="2"></i><b>(2)</b>
ctx.register(AppConfig.class);
ctx.refresh(); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Keine Konfiguration angeben, um <code>refresh()</code> zu verhindern</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Registriert <code>propertySource</code> als letztes, d.h. mit niedrigster Priorität</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Mit <code>refresh()</code> wird der <code>ApplicationContext</code> initialisiert</td></tr></table></div>
<div class="admonitionblock warning teacherBox"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">@PropertySource&#8217;s in der Konfiguration werden beim Refresh hinzugefügt!</td></tr></table></div></section></section>
<section id="_aufgaben_4_environment_selbst_implementierte_propertysource"><h2>Aufgaben 4: Environment selbst implementierte PropertySource</h2><div class="olist arabic"><ol class="arabic"><li><p>Nutzen Sie nun das <code>Environment</code>, um die beiden Strategies zu konfigurieren.
Die Applikation soll sich genauso wie nach Aufgabe 2 verhalten.</p></li><li><p>Implementieren Sie eine <code>RandomPropertySource</code>, die für jede der 3 Strategy-Properties einen Zufallswert zwischen 1 und 100 zurückliefert und binden Sie diese <code>RandomPropertySource</code> ein.</p></li></ol></div></section>
<section><section id="_profile"><h2>Profile</h2><div class="paragraph heading"><p>Einsatz von @Profile</p></div><div class="ulist"><ul><li><p>Unterschiedliche Umgebungen (Produktion, Entwicklung) erfordern unterschiedliche Konfiguration.</p></li><li><p>Profile kommen zum Einsatz, wenn Einstellungen (Konfigurationswerte) nicht ausreichen.</p></li><li><p>Mit der Annotation <code>@Profile("profilname")</code> legt man fest, dass eine Konfiguration nur gelten
soll, wenn das entsprechende Profil aktiviert ist.</p></li><li><p>Die <code>@Profile</code> Annotation kann man sowohl auf eine ganze (Konfigurations-)Klassen als auch auf
einzelne Bean-Methoden anwenden.</p></li><li><p>Profile lassen sich mit <code>&amp;</code> (und), <code>|</code> (oder), <code>!</code> (Negation) und Klammern verknüpfen:</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Profile</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">production &amp; (us-east | eu-central)</span><span class="delimiter">&quot;</span></span>)</code></pre></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#beans-definition-profiles-java">
&#8594; Reference: Using @Profile</a></p></div></section><section id="_profile_aktivieren"><h2>Profile aktivieren</h2><div class="paragraph"><p>Man kann mehrere Profile gleichzeitig aktiveren, entweder programmatisch:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">ctx.getEnvironment().setActiveProfiles(<span class="string"><span class="delimiter">&quot;</span><span class="content">profile1</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">profile2</span><span class="delimiter">&quot;</span></span>);</code></pre>
<div class="paragraph"><p>Oder über die <code>spring.profiles.active</code> Property, z. B. mit:</p></div>
<div class="literalblock"><div class="content"><pre>-Dspring.profiles.active="profile1,profile2"</pre></div></div>
<div class="paragraph"><p>Wenn kein Profil aktiviert wurde, dann ist immer das <strong><code>default</code></strong> Profil aktiv.</p></div></section><section id="_implementierung_von_profile"><h2>Implementierung von <code>@Profile</code></h2><div class="title">org.springframework.context.annotation.Profile</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Target</span>({<span class="predefined-type">ElementType</span>.TYPE, <span class="predefined-type">ElementType</span>.METHOD})
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@Conditional</span>(ProfileCondition.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> Profile {
    <span class="predefined-type">String</span><span class="type">[]</span> value();
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>@Profile</code> ist eine Metaannotation, für <code>@Conditional(ProfileCondition.class)</code>.</td></tr></table></div>
<div class="paragraph"><p>Mit <code>@Conditional</code> kann man die Registrierung einer Konfiguration oder einer Bean mit einer
Bedingung (<code>Condition</code>) verknüpfen.</p></div></section><section id="_implementierung_der_profilecondition"><h2>Implementierung der <code>ProfileCondition</code></h2><div class="title">org.springframework.context.annotation.ProfileCondition</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">class</span> <span class="class">ProfileCondition</span> <span class="directive">implements</span> <span class="predefined-type">Condition</span> {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> matches(ConditionContext context, AnnotatedTypeMetadata metadata) { <i class="conum" data-value="1"></i><b>(1)</b>
        MultiValueMap&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; attrs = metadata
                .getAllAnnotationAttributes(Profile.class.getName());
        <span class="keyword">if</span> (attrs != <span class="predefined-constant">null</span>) {
            <span class="keyword">for</span> (<span class="predefined-type">Object</span> value : attrs.get(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)) {
                <span class="keyword">if</span> (context.getEnvironment()
                        .acceptsProfiles(Profiles.of((<span class="predefined-type">String</span><span class="type">[]</span>) value))) {
                    <span class="keyword">return</span> <span class="predefined-constant">true</span>;
                }
            }
            <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        }
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Die <code>matches</code> Methode ist die einzige Methode, die jede <code>Condition</code> implementieren muss.</td></tr></table></div></section></section>
<section id="_aufgabe_5_profile_und_conditional"><h2>Aufgabe 5: Profile und Conditional</h2><div class="olist arabic"><ol class="arabic"><li><p>Ändern Sie die <code>WatorFxConfig</code> so, dass dort 2 verschiedene <code>WritableImageTorus</code> Beans
in unterschiedlichen Größen erstellt werden. Nutzen Sie dafür die Profile <em>big</em>
und <em>default</em>.</p></li><li><p><em>Optional</em>: Implementieren Sie eine Annotation <code>@Big</code> nebst zugehöriger Condition, so dass Sie <code>@Profile("big")</code> durch <code>@Big</code> und <code>@Profile("default")</code> durch <code>@Big(false)</code> ersetzen können.</p></li></ol></div></section>
<section id="_zusammenfassung"><h2>Zusammenfassung</h2><div class="ulist"><ul><li><p>ApplicationContext Konfiguration</p><div class="ulist"><ul><li><p>XML-Config</p></li><li><p>Java-Config</p></li><li><p>Annotationsbasierte Konfiguration</p></li></ul></div></li><li><p>Externe Konfiguration</p><div class="ulist"><ul><li><p>Zugriff auf Ressourcen</p></li><li><p>Konfigurationswerte angeben und auswerten</p></li><li><p>Spring Expression Language</p></li><li><p>Environment</p></li><li><p>Profile und Conditional</p></li></ul></div></li></ul></div></section>
<section id="_externe_konfiguration_3"><h2>Externe Konfiguration</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson05-testing.html">&#8594; Weiter zu Testentwicklung mit Spring</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_5_testentwicklung_mit_spring" data-state="no-title-footer"><h2>Lektion 5 - Testentwicklung mit Spring</h2><div class="paragraph center"><p>Wie könnte Sie Spring beim Testen unterstützen?</p></div></section>
<section id="_testentwicklung_mit_spring"><h2>Testentwicklung mit Spring</h2><div class="paragraph heading"><p>Bibliotheken und Frameworks für Testentwicklung mit Spring:</p></div>
<div class="ulist"><ul><li><p>JUnit 4/5</p></li><li><p>AssertJ</p></li><li><p>Spring Test</p></li><li><p>Mockito</p></li></ul></div></section>
<section id="_junit5"><h2>JUnit5</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>testCompile 'org.junit.jupiter:junit-jupiter-api:5.6.0'</pre></div></div>
<div class="paragraph"><p>Beispiel:</p></div>
<div class="title">JUnit5Test.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">testing.fragments</span>;

<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JUnit5Test</span> {

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testOnePlusOne() {
        assertEquals(<span class="integer">2</span>, <span class="integer">1</span> + <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">strange arithmetic</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section>
<section id="_assertj"><h2>AssertJ</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>testCompile 'org.assertj:assertj-core:3.15.0'</pre></div></div>
<div class="paragraph"><p>Verwendeter Import:</p></div>
<div class="literalblock"><div class="content"><pre>import static org.assertj.core.api.Assertions.assertThat;</pre></div></div>
<div class="paragraph"><p>Beispiel:</p></div>
<div class="literalblock"><div class="content"><pre>assertThat(1 + 1).as("adding").isEqualTo(2);</pre></div></div></section>
<section><section id="_spring_test"><h2>Spring Test</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div><div class="literalblock"><div class="content"><pre>testCompile 'org.springframework:spring-test:5.3.6'</pre></div></div><div class="paragraph"><p><br></p></div><div class="paragraph"><p>Enthält die Packages:</p></div><div class="ulist"><ul><li><p><code>org.springframework.mock</code></p></li><li><p><code>org.springframework.test</code></p></li></ul></div></section><section id="_package_org_springframework_test"><h2>Package <code>org.springframework.test</code>:</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">AopTestUtils</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">AOP-Utilities zum Zugriff auf Objekt hinter einem Proxy</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">AssertionErrors</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assertions unabhängig von JUnit</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JsonExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assertions zum Vergleich von JSON-Strings</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JsonPathExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Prüfung von JSON-Inhalten mittels JSON-Path Ausdrücken</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">XmlExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assertions zum Vergleich von XML-Inhalten oder XML-Eigenschaften</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">XpathExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Prüfung von XML-Inhalten mittels XPath-Ausdrücken</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">MetaAnnotationUtils</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Zugriff Annotationen hinter Metaannotationen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ReflectionTestUtils</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Zugriff auf private Variablen/Methoden</p></td></tr></table></section><section id="_zugriff_auf_private_variablen"><h2>Zugriff auf private Variablen</h2><div class="ulist"><ul><li><p>Beans haben private Variablen, die nur per DI befüllt werden.</p></li><li><p>Getter und Setter sind in der Regel nicht vorhanden.</p></li><li><p>Für Unittests müssen diese befüllt werden.</p></li></ul></div>
<div class="paragraph"><p>Man kann mit Java-Bordmitteln per Reflection auf private
Variablen zugreifen:</p></div>
<div class="title">AccessingPrivateFieldTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Field</span> breedTimeField = FishStrategy.class.getDeclaredField(<span class="string"><span class="delimiter">&quot;</span><span class="content">breedTime</span><span class="delimiter">&quot;</span></span>);
breedTimeField.setAccessible(<span class="predefined-constant">true</span>);
breedTimeField.set(fishStrategy, <span class="integer">99</span>);</code></pre>
<div class="paragraph"><p>Die <code>ReflectionTestUtils</code> bietet diverse <code>getField</code> und <code>setField</code> Methoden zum
Zugriff auf private Variablen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">ReflectionTestUtils.setField(someObject, <span class="string"><span class="delimiter">&quot;</span><span class="content">fieldname</span><span class="delimiter">&quot;</span></span>, newValue);
<span class="predefined-type">Object</span> value = ReflectionTestUtils.getField(someObject, <span class="string"><span class="delimiter">&quot;</span><span class="content">fieldName</span><span class="delimiter">&quot;</span></span>);</code></pre></section></section>
<section id="_aufgabe_1_reflection_für_tests_einsetzen"><h2>Aufgabe 1: Reflection für Tests einsetzen</h2><div class="paragraph"><p>Bearbeiten Sie die Aufgaben in <code>SpringUnitTests</code>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Unit Test ausführen (positives und negatives Ergebnis prüfen)</p></li><li><p>Zugriff auf private Variable per Reflection</p></li><li><p>Verwendung von <code>ReflectionTestUtils</code></p></li></ol></div></section>
<section><section id="_mocking"><h2>Mocking</h2><div class="paragraph"><p>Was versteht man unter Mocking? Wofür ist das gut?</p></div><div class="ulist"><ul><li class="fragment"><p>Mocking dient dazu,<br>
Objekte durch Platzhalter zu ersetzen,<br>
die ein bestimmtes Verhalten zeigen</p></li></ul></div></section><section id="_verwendung_von_mockito"><h2>Verwendung von Mockito</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>testCompile 'org.mockito:mockito-core:3.3.0'</pre></div></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Verwendung:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.Mockito</span>.*; <span class="comment">// Importiert statische Methoden der Klasse Mockito</span>

Torus mockTorus = mock(Torus.class); <span class="comment">// Erzeugt Mock-Objekt, das Torus implementiert</span>
when(mockTorus.getWidth()).thenReturn(<span class="integer">300</span>); <span class="comment">// Gib 300 zurück, wenn getWidth()</span>
                                            <span class="comment">// aufgerufen wird</span>

verify(mockTorus).setFishAt(<span class="integer">10</span>, <span class="integer">20</span>, <span class="predefined-constant">null</span>); <span class="comment">// Prüfe, ob setFishAt(10, 20, null)</span>
                                           <span class="comment">// aufgerufen wurde</span></code></pre></section><section id="_spring_klassen_für_mocking"><h2>Spring Klassen für Mocking</h2><div class="paragraph"><p>Spring stellt einige Klassen bereit, die als Mockobjekte in Tests
verwendet werden können.<br>
Diese befinden sich alle in den Subpackages
von <code>org.springframework.mock</code>.<br>
Sie dienen dem Mocking von:</p></div>
<div class="ulist"><ul><li><p>Environment (<code>MockEnvironment</code>)</p></li><li><p>PropertySource (<code>MockPropertySource</code>)</p></li><li><p>JNDI</p></li><li><p>HTTP-Kommunikation (u. a. Servlet-API)</p></li></ul></div></section></section>
<section id="_aufgabe_3_mocking"><h2>Aufgabe 3: Mocking</h2><div class="paragraph"><p>Bearbeiten Sie die Aufgabe im <code>FishStrategyTest</code>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prüfen, ob das Verschieben eines Fisches auf dem Torus prinzipiell
korrekt erfolgt</p></li></ol></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Falls Sie noch Zeit haben, können Sie folgendes probieren:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Verschieben testen, wenn Nachbarzelle bereits belegt ist</p></li><li><p>Vermehrung eines Fisches testen</p></li></ol></div></section>
<section id="_mocking_2"><h2>Mocking</h2><div class="paragraph heading"><p>Warnung vor dem Mock!</p></div>
<div class="imageblock" style="float: right"><img src="images/dog.jpg" alt="dog"></div>
<div class="paragraph"><p>Mocking ist</p></div>
<div class="ulist"><ul><li><p>aufwendig</p></li><li><p>pflegeintensiv (bei Schnittstellenänderungen)</p></li><li><p>fehleranfällig (Schnittstellenverhalten falsch simuliert)</p></li></ul></div>
<div class="paragraph"><p>&#8658; Es kommt eben immer auf die richtige Dosis an</p></div></section>
<section><section id="_integrationstests"><h2>Integrationstests</h2><div class="paragraph heading"><p>Motivation</p></div><div class="ulist"><ul><li><p>Integrationstests prüfen das Zusammenspiel mehrerer Klassen.</p></li><li><p>Spring-Anwendungen benötigen in der Regel einen speziellen
Test-ApplicationContext.</p></li><li><p>Das Testframework von Spring dient dazu, diesen bereitzustellen.</p></li></ul></div></section><section id="_verwendung_mit_junit_4"><h2>Verwendung mit JUnit 4</h2><div class="title">SpringJUnit4Test.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@RunWith</span>(SpringRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = WatorConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringJUnit4Test</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Torus torus;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testInjectionWorks() {
        assertThat(torus).isNotNull();
    }
}</code></pre>
<div class="paragraph"><p>Statt <code>SpringRunner</code> kann auch <code>SpringJUnit4ClassRunner</code> verwendet werden.</p></div></section><section id="_verwendung_mit_junit_5"><h2>Verwendung mit JUnit 5</h2><div class="title">SpringJUnit5Test.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringJUnitConfig</span>(WatorConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringJUnit5Test</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Torus torus;

    <span class="annotation">@Test</span>
    <span class="type">void</span> testInjectionWorks() {
        assertThat(torus).isNotNull();
    }
}</code></pre></section><section id="_springjunitconfig"><h2>@SpringJUnitConfig</h2><div class="paragraph"><p>Die Annotation <code>SpringJUnitConfig</code> ist eine <em>Meta-Annotation</em>:</p></div>
<div class="title">org.springframework.test.context.junit.jupiter.SpringJUnitConfig</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ExtendWith</span>(SpringExtension.class)
<span class="annotation">@ContextConfiguration</span>
<span class="annotation">@Documented</span>
<span class="annotation">@Inherited</span>
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> SpringJUnitConfig {</code></pre></section><section id="_meta_annotationen"><h2>Meta-Annotationen</h2><div class="paragraph"><p>Sowohl fast alle JUnit Jupiter Annotationen als auch fast alle Spring Annotionen können<br>
für <strong>Meta-Annotationen</strong> verwendet werden.<br>
D.h. man kann eigene Annotionen aus diesen Meta-Annotionen zusammensetzen.</p></div>
<div class="paragraph"><p><strong><code>@SpringJUnitConfig</code></strong> ist so eine zusammengesetzte Annotation</p></div>
<div class="paragraph"><p>Man könnte den SpringJUnit5Test auch so implementieren:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ExtendWith</span>(SpringExtension.class)
<span class="annotation">@ContextConfiguration</span>(classes=WatorConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringJUnit5Test</span> {
    <span class="comment">// ...</span>
}</code></pre></section><section id="_springextension"><h2>SpringExtension</h2><div class="paragraph"><p>JUnit 5 Extensions implementieren entsprechende Lifecyle-Interfaces:</p></div>
<div class="title">org.springframework.test.context.junit.jupiter.SpringExtension</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SpringExtension</span> <span class="directive">implements</span> BeforeAllCallback, AfterAllCallback, <span class="comment">// ...</span>
{
    <span class="comment">// ...</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeAll(ExtensionContext context) <span class="directive">throws</span> <span class="exception">Exception</span> {
        getTestContextManager(context).beforeTestClass();
    }
    <span class="comment">// ...</span>
}</code></pre></section><section id="_test_context_via_xml_config"><h2>Test-Context via XML-Config</h2><div class="paragraph"><p><code>ApplicationContext</code> aus dem Wurzelvereichnis des <em>classpath</em> laden:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(locations={<span class="string"><span class="delimiter">&quot;</span><span class="content">/app-config.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>})</code></pre>
<div class="paragraph"><p>Alternativen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">/app-config.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ContextConfiguration</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ContextConfiguration</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">test-config.xml</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SpringJUnitConfig</span>(locations={<span class="string"><span class="delimiter">&quot;</span><span class="content">/app-config.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>})</code></pre></section><section id="_test_context_via_java_config"><h2>Test-Context via Java-Config</h2><div class="paragraph"><p><code>ApplicationContext</code> über Java-Config erstellen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(classes = {AppConfig.class, TestConfig.class})</code></pre>
<div class="paragraph"><p>Alternativen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(classes = TestConfig.class)
<span class="annotation">@SpringJUnitConfig</span>(classes = {TestConfig.class})
<span class="annotation">@SpringJUnitConfig</span>({TestConfig.class})</code></pre>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Bei <code>@ContextConfiguration</code> ist <em>locations</em> der Default,
bei <code>@SpringJUnitConfig</code> dagegen <em>classes</em>.</td></tr></table></div></section><section id="_test_context_defaults"><h2>Test-Context Defaults</h2><div class="paragraph"><p>Eine <code>@ContextConfiguration</code> oder <code>@SpringJUnitConfig</code> ohne Parameter
in einer Testklasse mit dem Namen <em>MyTest</em> entspricht:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyTest-config.xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
<div class="paragraph"><p>Wenn es diese XML-Datei nicht gibt, wird nach einer mit <code>@Configuration</code> annotierten
<em>static</em> Innerclass gesucht:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringJUnitConfig</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyTest</span> {

    <span class="annotation">@Configuration</span>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {
        <span class="comment">// ...</span>
    }
    <span class="comment">// ...</span>
}</code></pre></section><section id="_innerclass_mit_annotationen"><h2>Innerclass mit Annotationen</h2><div class="paragraph"><p>Diese Innerclass kann selbst wiederum mit Annotationen versehen werden.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringJUnitConfig</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyTest</span> {

    <span class="annotation">@Configuration</span>
    <span class="annotation">@Import</span>(SampleConfig.class)
    <span class="annotation">@ComponentScan</span>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {
        <span class="comment">// ...</span>
    }
    <span class="comment">// ...</span>
}</code></pre></section></section>
<section><section id="_test_konfiguration"><h2>Test Konfiguration</h2><div class="paragraph"><p>Tests kann man konfigurieren mit:</p></div><div class="ulist"><ul><li><p><code>@TestPropertySource</code></p></li><li><p><code>@ActiveProfiles</code></p></li><li><p><code>@EnabledIf</code>, <code>@DisabledIdf</code> (nur JUnit 5)</p></li></ul></div></section><section id="_testpropertysource"><h2>TestPropertySource</h2><div class="paragraph"><p>Beispiele (Testklassen-Annotation):</p></div>
<div class="literalblock"><div class="content"><pre>@TestPropertySource("classpath:/test.properties")
@TestPropertySource("/test.properties")
@TestPropertySource("file:${user.home}/test.properties")
@TestPropertySource(properties = { "timezone = GMT", "port: 4242" })</pre></div></div></section><section id="_profile_für_test_aktivieren"><h2>Profile für Test aktivieren</h2><div class="paragraph"><p>Beispiele (Testklassen-Annotation):</p></div>
<div class="literalblock"><div class="content"><pre>@ActiveProfiles("dev")
@ActiveProfiles({"dev", "integration"})</pre></div></div></section><section id="_bedingte_testausführung_nur_junit_5"><h2>Bedingte Testausführung (nur JUnit 5)</h2><div class="paragraph"><p>Beispiele (anwendbar auf Testmethoden und Testklassen):</p></div>
<div class="literalblock"><div class="content"><pre>@EnabledIf("#{systemProperties['os.name'].toLowerCase().contains('mac')}")
@DisabledIf("${smoke.tests.disabled}")
@EnabledIf("true")</pre></div></div></section></section>
<section id="_kontext_test"><h2>Kontext-Test</h2><div class="ulist"><ul><li><p>Ein Kontext-Test prüft, ob der <code>ApplicationContext</code> geladen werden kann.</p></li><li><p>Der <code>ApplicationContext</code> sollte möglichst der produktiven Umgebung entsprechen.</p></li><li><p>So ein Test ist hilfreich bei der Fehlersuche.</p></li></ul></div></section>
<section id="_aufgabe_3_konfigurations_und_kontext_test"><h2>Aufgabe 3: Konfigurations- und Kontext-Test</h2><div class="olist arabic"><ol class="arabic"><li><p>Bearbeiten Sie die Aufgaben im <code>ConfigurationTest</code></p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Properties in eine Properties-Datei auslagern</p></li><li><p>Profil 'dev' aktivieren</p></li></ol></div></li><li><p>Ändern Sie den <code>WatorApplicationContextTest</code> so, dass er die XML-basierte Konfiguration testet.</p></li></ol></div></section>
<section><section id="_spring_test_features"><h2>Spring-Test Features</h2><div class="paragraph heading"><p>Context-Cache</p></div><div class="paragraph"><p>Da es sehr Zeitintensiv sein kann, den ApplicationContext aufzubauen, verwendet Spring
einen Context-Cache.</p></div><div class="paragraph"><p>Die eindeutige Kombination von Konfigurationsparametern wird verwendet, um einen Schlüssel
zu generieren, unter dem der Kontext gecached wird. Diese sind
<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testcontext-ctx-management-caching">u.a.</a>:</p></div><div class="ulist"><ul><li><p>locations (from @ContextConfiguration)</p></li><li><p>classes (from @ContextConfiguration)</p></li><li><p>activeProfiles (from @ActiveProfiles)</p></li><li><p>propertySourceLocations (from @TestPropertySource)</p></li><li><p>propertySourceProperties (from @TestPropertySource)</p></li></ul></div><div class="admonitionblock warning teacherBox"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Es können Seiteneffekte auftreten, wenn eine VM mehrere Tests auf einmal ausführt,
z.B. beim Jenkins Build</td></tr></table></div></section><section id="_context_cache_beeinflussen"><h2>Context-Cache beeinflussen</h2><div class="ulist"><ul><li><p>Context-Cache wird in einer <em>static</em> Variablen gespeichert, also je VM.</p></li><li><p>Die Größe kann über die System-Property <code>spring.test.context.cache.maxSize</code>
festgelegt werden, Standard ist 32.</p></li><li><p>Über <code>@DirtiesContext</code> kann man erzwingen, dass der Context für einen
Test verworfen wird.</p></li></ul></div></section><section id="_spring_test_lifecycle_callbacks"><h2>Spring Test-Lifecycle Callbacks</h2><div class="ulist"><ul><li><p><code>@TestExecutionListeners</code> registriert einen <code>TestExecutionListener</code>,
dessen Callbacks in verschiedenen Phasen der Testausführung aufgerufen werden.</p></li><li><p>Einige <code>TestExecutionListener</code> registriert Spring standardmäßig,
z.B. den <code>DirtiesContextTestExecutionListener</code> zur Behandlung von <code>@DirtiesContext</code>.</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testcontext-tel-config">
&#8594; Reference: TestExecutionListener configuration</a></p></div></section><section id="_testen_von_webapplikationen"><h2>Testen von Webapplikationen</h2><div class="paragraph"><p>Folgende Annotationen laden einen <code>WebApplicationContext</code> statt einem <code>ApplicationContext</code>:</p></div>
<div class="ulist"><ul><li><p>@WebAppConfiguration</p></li><li><p>@SpringJUnitWebConfig (nur JUnit 5)</p></li></ul></div></section><section id="_test_sql_skripte_ausführen"><h2>Test SQL-Skripte ausführen</h2><div class="paragraph"><p>Beispiel (anwendbar auf Testmethoden und Testklassen):</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Sql</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">/test-schema.sql</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-user-data.sql</span><span class="delimiter">&quot;</span></span>})</code></pre></section><section id="_transaktionsteuerung_beim_test"><h2>Transaktionsteuerung beim Test</h2><div class="ulist"><ul><li><p>Mit <code>@Commit</code> und <code>@Rollback</code> kann man das Transaktionsverhalten eines Tests steuern.</p></li><li><p>Sie sind anwendbar auf eine Testklasse oder eine einzelne Methode.</p></li><li><p>Standardmäßig rollt das Testframework jede Transaktion zurück.</p></li><li><p>Mit <code>@BeforeTransaction</code> oder <code>@AfterTransaction</code> kann man Callback-Methoden definieren,
um sich in die Transaktionsverarbeitung einzuklinken.</p></li></ul></div></section><section id="_überschreiben_von_bean_definitionen"><h2>Überschreiben von Bean-Definitionen</h2><div class="paragraph"><p>Die Annotation <strong><code>@Primary</code></strong> ist keine Test-Annotation, aber Sie ist besonders
für Tests nützlich, um mit einer Testkonfiguration eine vorhandene Bean zu
ersetzen.</p></div></section></section>
<section id="_learning_tests"><h2>Learning-Tests</h2><div class="ulist"><ul><li><p>Bevor man eine neue API verwendet, sollte man immer mit Learning-Tests prüfen,
ob diese sich so verhält, wie man das erwartet.</p></li><li><p>Bei späteren API-Updates decken diese Tests frühzeitig Unterschiede auf.</p></li></ul></div></section>
<section id="_aufgabe_4_mit_learning_tests_spezialfälle_im_spring_framework_ergründen"><h2>Aufgabe 4: Mit Learning Tests Spezialfälle im Spring-Framework ergründen</h2><div class="paragraph"><p>Ergründen Sie mit Learning-Tests das Verhalten der Annotationen <code>@Primary</code>, <code>@Qualifier</code>
und <code>@Nullable</code> und beantworten Sie die folgenen Fragen:</p></div>
<div class="ulist"><ul><li><p>Was passiert, wenn eine Bean nicht eindeutig über den Typ zugeordnet werden kann?
Welche Möglichkeiten haben Sie, einer Bean den Vorzug zu geben?</p></li><li><p>Was passiert, wenn keine entsprechende Bean vorhanden ist?</p></li><li><p>Was ist der Unterschied zwischen <code>@Bean(name="bla")</code>, <code>@Qualifier("bla")</code> und <code>@Named("bla")</code>?</p></li><li><p>Was bewirkt <code>@Scope("prototype")</code>? Wofür könnte das gut sein?</p></li></ul></div>
<div class="paragraph"><p>Verwenden Sie <code>LearningTest</code> im Package <code>testing.learning</code> als Vorlage.</p></div></section>
<section id="_testentwicklung_mit_spring_2"><h2>Testentwicklung mit Spring</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson06-tx.html">&#8594; Weiter zu Persistenz &amp; Transaktionen</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_6_persistenz_und_transaktionen" data-state="no-title-footer"><h2>Lektion 6 - Persistenz und Transaktionen</h2><div class="paragraph center"><p>Wie funktioniert der Datenbankzugriff mit Java?</p></div></section>
<section id="_lektion_06"><h2>Lektion 06</h2><div class="paragraph heading"><p>Themen</p></div>
<div class="ulist"><ul><li><p>Einführung in HSQLDB</p></li><li><p>JdbcTemplate und JdbcDaoSupport</p></li><li><p>Exception Handling</p></li><li><p>Connection Pools</p></li><li><p>TransactionTemplate</p></li><li><p>Deklarative Transaktionen</p></li></ul></div></section>
<section><section id="_hsqldb"><h2>HSQLDB</h2><div class="paragraph heading"><p>HSQLDB in Stichworten</p></div><div class="ulist"><ul><li><p>Freie, vollständig in Java programmierte relationale SQL-Datenbank</p></li><li><p>Bestandteil von OpenOffice und LibreOffice</p></li><li><p>Sehr schlank (nur ein JAR)</p></li><li><p>Als In-Memory-Datenbank verwendbar (nützlich für Tests)</p></li><li><p>Alternative: H2</p></li></ul></div></section><section id="_verwendung_in_process"><h2>Verwendung <em>In-Process</em></h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>compile 'org.hsqldb:hsqldb:2.4.1'</pre></div></div>
<div class="paragraph"><p>Datenbankverbindung aufbauen:</p></div>
<div class="title">JdbcSamples.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">String</span> jdbcUrl = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:hsqldb:mem:mymemdb</span><span class="delimiter">&quot;</span></span>; <span class="comment">// In-Memory-Datenbank mit Name 'mymemdb'</span>
<span class="predefined-type">Class</span>.forName(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbc.JDBCDriver</span><span class="delimiter">&quot;</span></span>);
<span class="predefined-type">Connection</span> connection = <span class="predefined-type">DriverManager</span>.getConnection(jdbcUrl, <span class="string"><span class="delimiter">&quot;</span><span class="content">SA</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);</code></pre>
<div class="paragraph"><p>JDBC-URL für Standalone Datenbank:</p></div>
<div class="literalblock"><div class="content"><pre>jdbc:hsqldb:file:build/standalonedb</pre></div></div></section><section id="_verwendung_als_server"><h2>Verwendung als Server</h2><div class="paragraph"><p>Aufruf:</p></div>
<div class="literalblock"><div class="content"><pre>java -cp hsqldb-2.4.1.jar org.hsqldb.server.Server --database.0 file:mydb --dbname.0 xdb</pre></div></div>
<div class="paragraph"><p>JDBC-URL:</p></div>
<div class="literalblock"><div class="content"><pre>jdbc:hsqldb:hsql://localhost/xdb</pre></div></div>
<div class="paragraph"><p><a href="http://hsqldb.org/doc/guide/running-chapt.html">&#8594; HSQLDB Guide:Running and Using HyperSQL</a></p></div></section><section id="_datenbank_management_tool"><h2>Datenbank Management Tool</h2><div class="paragraph"><p>Aufruf:</p></div>
<div class="literalblock"><div class="content"><pre>java -cp hsqldb-2.4.1.jar org.hsqldb.util.DatabaseManagerSwing</pre></div></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Mögliche Alternativen:</p></div>
<div class="ulist"><ul><li><p>Datenbankmanagement-Tool der jeweiligen IDE</p></li><li><p><a href="http://squirrel-sql.sourceforge.net/">&#8594; SQuirreL SQL Client</a></p></li></ul></div></section></section>
<section id="_aufgabe_1_arbeiten_mit_hsqldb"><h2>Aufgabe 1: Arbeiten mit HSQLDB</h2><div class="olist arabic"><ol class="arabic"><li><p>Starten Sie einen HSQLDB-Server und lassen Sie die <code>tx.hsql.AccessDbTests</code> laufen.</p><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Verwenden Sie das <code>hsqldb-server</code> Projekt</td></tr></table></div></li><li><p>Verbinden Sie sich mit einem <em>Datenbank Management Tool</em> und führen Sie damit
folgendes SQL-Statement aus:</p><pre class="CodeRay listingblock"><code class="sql language-sql"><span class="class">select</span> <span class="integer">1</span> + <span class="integer">1</span>, current_timestamp <span class="keyword">from</span> (<span class="keyword">values</span>(<span class="integer">0</span>))</code></pre></li><li><p>Wo liegen die Datenbank-Dateien der Datenbank, die Sie soeben angelegt haben?</p></li></ol></div></section>
<section><section id="_datenbankzugriff"><h2>Datenbankzugriff</h2><div class="paragraph heading"><p>Datenbankzugriff per JDBC</p></div><div class="title">JdbcSamples.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select ? + 1 from (values(0))</span><span class="delimiter">&quot;</span></span>;
<span class="keyword">try</span> (<span class="predefined-type">PreparedStatement</span> stmt = connection.prepareStatement(sql)) {
    stmt.setInt(<span class="integer">1</span>, <span class="integer">3</span>);
    <span class="keyword">try</span> (<span class="predefined-type">ResultSet</span> rs = stmt.executeQuery()) {
        assertThat(rs.next()).isTrue();
        assertThat(rs.getInt(<span class="integer">1</span>)).isEqualTo(<span class="integer">4</span>);
    }
}</code></pre></section><section id="_jdbctemplate"><h2>JdbcTemplate</h2><div class="ulist"><ul><li><p>Entwurfsmuster: Template-Method</p></li><li><p>Vereinfacht die Ausführung von JDBC-Statements</p></li><li><p>Mapping von Abfrageergebnissen auf Java-Objekte</p></li><li><p>Übersetzt <em>SQLExceptions</em> auf einheitliche Exception-Hierarchie</p></li><li><p>Alternativen:</p><div class="ulist"><ul><li><p><code>NamedParameterJdbcTemplate</code></p></li><li><p>SimpleJdbc Klassen, z. B. <code>SimpleJdbcInsert</code></p></li></ul></div></li></ul></div>
<div class="paragraph heading"><p>Verwendung:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">String</span> sql = <span class="string"><span class="delimiter">&quot;</span><span class="content">select ? + 1 from (values(0))</span><span class="delimiter">&quot;</span></span>;
<span class="predefined-type">Integer</span> result = jdbcTemplate.queryForObject(sql, <span class="predefined-type">Integer</span>.class, <span class="integer">3</span>);
assertThat(result).isEqualTo(<span class="integer">4</span>);</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring/docs/5.3.6/javadoc-api/org/springframework/jdbc/core/JdbcTemplate.html">
&#8594; Javadocs</a></p></div></section><section id="_aufgabe_2_datenbankzugriff_mit_jdbctemplate"><h2>Aufgabe 2: Datenbankzugriff mit JdbcTemplate</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie die verschiedenen Schritte eines vollständigen
CRUD-Tests (Create, Read, Update, Delete) aus, indem Sie die Aufgaben
in <code>tx.jdbc.JdbcTemplateTests</code> lösen.</p></li><li><p>Führen Sie den Test mit verschiedenen <em>DataSources</em> aus. Die <code>DataSourceConfig</code>
bietet dafür mehrere Konfigurationen, die Sie über Profile auswählen können.</p></li><li><p>Debuggen Sie den Test und prüfen Sie
nach jedem Schritt die Änderung in der Datenbank.</p></li></ol></div></section><section id="_jdbcdaosupport"><h2>JdbcDaoSupport</h2><div class="ulist"><ul><li><p>Entwurfsmuster: Data Access Object</p></li><li><p>Abstrakte Basisklasse</p></li><li><p>Zusätzliche Kapselung der Framework-Klassen</p></li><li><p>Zugriff auf DataSource, JdbcTemplate und Connection</p></li><li><p>Einschränkung: nur Setter-Injection</p></li></ul></div></section><section id="_aufgabe_3_optional_nutzung_von_jdbcdaosupport"><h2>Aufgabe 3 (optional): Nutzung von JdbcDaoSupport</h2><div class="paragraph"><p>Nachfolgend soll die Logik zur Persistierung von Personen in ein eigenes DAO
verschoben werden.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Lassen Sie die Klasse <code>PersonDaoImpl</code> die Klasse <code>JdbcDaoSupport</code> erweitern.
Welche zusätzliche Funktionalität erhalten Sie dadurch?</p></li><li><p>Implementieren Sie die Methodenrümpfe des DAOs.
Hierzu können Sie sich an den <code>JdbcTemplateTests</code> orientieren.</p></li><li><p>Passen Sie die eingebettete Konfiguration im <code>PersonDaoTest</code> so an, dass das <code>PersonDao</code>
korrekt konfiguriert wird.</p></li></ol></div></section></section>
<section><section id="_exception_handling"><h2>Exception Handling</h2><div class="ulist"><ul><li><p>Quellen für Exceptions</p><div class="ulist"><ul><li><p>JPA</p></li><li><p>Hibernate</p></li><li><p>JDBC (z.B. SQLException)</p></li><li><p>Datenbanktreiber</p></li></ul></div></li><li><p>Checked vs. Runtime Exceptions</p></li></ul></div></section><section id="_dataaccessexception"><h2>DataAccessException</h2><div class="ulist"><ul><li><p>Ziel: einheitliche Hierarchie von Runtime Exceptions</p></li><li><p>Automatisches Mapping</p></li><li><p><code>DataAccessException</code></p><div class="ulist"><ul><li><p><code>DataIntegrityViolationException</code>: Verletzung von Constraints</p></li><li><p><code>DuplicateKeyException</code>: Verletzung von Schlüssel-Constraints</p></li><li><p><code>EmptyResultDataAccessException</code>: Leere Ergebnismenge</p></li><li><p><code>TypeMismatchDataAccessException</code>: Fehler beim Mapping</p></li></ul></div></li></ul></div></section><section id="_exception_hierarchie"><h2>Exception Hierarchie</h2><div class="imageblock" style=""><img src="images/lesson06/DataAccessException.gif" alt="DataAccessException" height="700"></div></section></section>
<section><section id="_connection_pools"><h2>Connection Pools</h2><div class="paragraph heading"><p>Interaktion mit einer Datenbank</p></div><div class="olist arabic"><ol class="arabic"><li><p>Initialisieren einer <code>Connection</code> durch <code>JdbcDriver</code></p></li><li><p>Aufbau einer TCP-Verbindung</p></li><li><p>Login</p></li><li><p>Ausführen von <code>Query</code> bzw. <code>Statement</code></p></li><li><p>Logout</p></li><li><p>Schließen der TCP-Verbindung</p></li><li><p>Schließen der <code>Connection</code></p></li></ol></div><div class="paragraph"><p><strong>Auf- und Abbau von Datenbankverbindungen ist teuer!</strong></p></div></section><section id="_connection_pool"><h2>Connection Pool</h2><div class="ulist"><ul><li><p>Wiederverwendung von Connections</p></li><li><p>Konfiguration als DataSource</p></li><li><p>Implementierungen</p><div class="ulist"><ul><li><p>Apache Commons DBCP: <code>BasicDataSource</code></p></li><li><p>HikariCP: <code>HikariDataSource</code></p></li><li><p>C3P0: <code>ComboPooledDataSource</code></p></li><li><p>Tomcat JDBC Connection Pool: <code>DataSource</code></p></li></ul></div></li><li><p>Wichtige Optimierungsparameter</p><div class="ulist"><ul><li><p># Verbindungen initial</p></li><li><p># Verbindungen maximal</p></li></ul></div></li></ul></div></section><section id="_konfiguration_apache_commons_dbcp"><h2>Konfiguration Apache Commons DBCP</h2><div class="title">DataSourceConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java">        BasicDataSource ds = <span class="keyword">new</span> BasicDataSource();
        ds.setDriverClassName(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.hsqldb.jdbc.JDBCDriver</span><span class="delimiter">&quot;</span></span>);
        ds.setUrl(jdbcUrl);
        ds.setUsername(<span class="string"><span class="delimiter">&quot;</span><span class="content">SA</span><span class="delimiter">&quot;</span></span>);
        ds.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
        ds.setInitialSize(<span class="integer">1</span>);
        ds.setMaxTotal(<span class="integer">10</span>);</code></pre></section><section id="_konfiguration_hikaricp"><h2>Konfiguration HikariCP</h2><div class="title">DataSourceConfig.java</div><pre class="CodeRay listingblock"><code class="java language-java">        HikariConfig config = <span class="keyword">new</span> HikariConfig();
        config.setJdbcUrl(jdbcUrl);
        config.setUsername(<span class="string"><span class="delimiter">&quot;</span><span class="content">SA</span><span class="delimiter">&quot;</span></span>);
        config.setPassword(<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>);
        config.setMaximumPoolSize(<span class="integer">10</span>);
        config.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">cachePrepStmts</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>);
        config.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">prepStmtCacheSize</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">250</span><span class="delimiter">&quot;</span></span>);
        config.addDataSourceProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">prepStmtCacheSqlLimit</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2048</span><span class="delimiter">&quot;</span></span>);

        HikariDataSource ds = <span class="keyword">new</span> HikariDataSource(config);</code></pre></section><section id="_aufgabe_4_verwendung_eines_connection_pools"><h2>Aufgabe 4: Verwendung eines Connection Pools</h2><div class="olist arabic"><ol class="arabic"><li><p>Setzen Sie in der <code>DataSourceConfig</code> zwei Connection Pools auf Basis von Apache Commons DBCP und HikariCP auf, welche
über entsprechende Profile aktiviert werden können. Beschränken Sie die Pools auf maximal 10 zeitgleiche Verbindungen.</p></li></ol></div></section></section>
<section><section id="_transaktionen"><h2>Transaktionen</h2><div class="paragraph heading"><p><strong>ACID</strong> Eigenschaften von Transaktionen:</p></div><div class="ulist"><ul><li><p><strong>A</strong>tomicity (Abgeschlossenheit)</p></li><li><p><strong>C</strong>onsistency (Konsistenzerhaltung)</p></li><li><p><strong>I</strong>solation (Abgrenzung)</p></li><li><p><strong>D</strong>urability (Dauerhaftigkeit)</p></li></ul></div></section><section id="_isolation"><h2>Isolation</h2><div class="paragraph"><p>Ausgangssituation: Konkurrierende Ausführung zweier Transaktionen A und B</p></div>
<div class="ulist"><ul><li><p><strong>Dirty Read</strong>: A liest nicht commitete Werte von B</p></li><li><p><strong>Non-repeatable Read</strong>: A liest andere Werte nach Commit von B</p></li><li><p><strong>Phantom Read</strong>: A liest zusätzliche Zeilen nach Commit von B</p></li><li><p><strong>Lost Update</strong>: A überschreibt Änderungen von B</p></li></ul></div></section><section id="_transaktionen_mit_jdbc"><h2>Transaktionen mit JDBC</h2><div class="title">JdbcSamples.java</div><pre class="CodeRay listingblock"><code class="java language-java">connection.setAutoCommit(<span class="predefined-constant">false</span>);
<span class="comment">// do something here ...</span>
connection.commit();</code></pre></section><section id="_spring_transaktionsmanager"><h2>Spring Transaktionsmanager</h2><div class="paragraph"><p>Implementierungen von <code>PlatformTransactionManager</code>:</p></div>
<div class="ulist"><ul><li><p><code>DataSourceTransactionManager</code></p></li><li><p><code>JpaTransactionManager</code></p></li><li><p><code>HibernateTransactionManager</code></p></li><li><p><code>JtaTransactionManager</code> (verteilte Transaktionen)</p><div class="ulist"><ul><li><p>benötigt JTA-Umgebung (Application-Server) oder</p></li><li><p>JTA-Implementierung (z. B. Atomikos, Bitronix)</p></li></ul></div></li></ul></div></section><section id="_transactiontemplate_verwenden"><h2>TransactionTemplate verwenden</h2><div class="title">TxSamples.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">void</span> executeTx() {
    <span class="predefined-type">Integer</span> result = transactionTemplate.execute(<span class="local-variable">this</span>::withinTx);
    assertThat(result).isEqualTo(<span class="integer">2</span>);
}

<span class="directive">private</span> <span class="predefined-type">Integer</span> withinTx(TransactionStatus status) {
    <span class="keyword">return</span> jdbcTemplate.queryForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">select 1 + 1 from (values(0))</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">Integer</span>.class);
}</code></pre></section></section>
<section id="_aufgabe_5_transaktionen_mit_dem_transactiontemplate"><h2>Aufgabe 5: Transaktionen mit dem TransactionTemplate</h2><div class="olist arabic"><ol class="arabic"><li><p>Fügen Sie in der Konfiguration für <code>TransactionTemplateTests</code> Beans für
<code>DataSourceTransactionManager</code> und <code>TransactionTemplate</code> hinzu.</p></li><li><p>Führen Sie den Test mit dem Debugger aus und halten Sie ihn nach dem
ersten Insert an. Prüfen Sie den Inhalt der Tabelle <em>person</em>.</p></li><li><p>Was genau passiert beim Ausführen von <code>insertWithConflict</code>?</p></li></ol></div></section>
<section><section id="_deklarative_transaktionen"><h2>Deklarative Transaktionen</h2><div class="paragraph"><p>Man kann Transaktionsgrenzen auch deklarativ (d. h. mit <code>@Transactional</code>) angeben:</p></div><div class="ulist"><ul><li><p><code>@EnableTransactionManagement</code> ist notwendig, um deklarative Transaktionen zu aktivieren</p></li><li><p><code>@Transactional</code></p><div class="ulist"><ul><li><p>an Klasse oder Methode</p></li><li><p>erfordert JDK DynamicProxy (Default), CGLIB oder AspectJ</p></li></ul></div></li><li><p>Automatisches Commit sowie Rollback bei Runtime Exceptions</p></li><li><p>Alternative Implementierungen (weitgehend austauschbar):</p><div class="ulist"><ul><li><p>Spring: <code>org.springframework.transaction.annotation.Transactional</code></p></li><li><p>EJB: <code>javax.transaction.Transactional</code></p></li></ul></div></li></ul></div></section><section id="_enabletransactionmanagement"><h2>@EnableTransactionManagement</h2><div class="title">org.springframework.transaction.annotation.EnableTransactionManagement</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.TYPE)
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Documented</span>
<span class="annotation">@Import</span>(TransactionManagementConfigurationSelector.class) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="annotation">@interface</span> EnableTransactionManagement {
<span class="type">boolean</span> proxyTargetClass() <span class="keyword">default</span> <span class="predefined-constant">false</span>;
    <span class="type">boolean</span> proxyTargetClass() <span class="keyword">default</span> <span class="predefined-constant">false</span>;
    AdviceMode mode() <span class="keyword">default</span> AdviceMode.PROXY; <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="type">int</span> order() <span class="keyword">default</span> Ordered.LOWEST_PRECEDENCE;
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td><code>Enable</code> Annotationen importieren immer irgendwelche Konfigurationsklassen</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td><code>AdviceMode.PROXY</code> oder <code>AdviceMode.ASPECTJ</code></td></tr></table></div></section><section id="_transactionmanagementconfigurationselector"><h2>TransactionManagementConfigurationSelector</h2><div class="paragraph"><p><code>TransactionManagementConfigurationSelector</code> implementiert <code>ImportSelector</code></p></div>
<div class="title">org.springframework.transaction.annotation.TransactionManagementConfigurationSelector</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">protected</span> <span class="predefined-type">String</span><span class="type">[]</span> selectImports(AdviceMode adviceMode) {
    <span class="keyword">switch</span> (adviceMode) {
        <span class="keyword">case</span> PROXY:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {AutoProxyRegistrar.class.getName(),
                ProxyTransactionManagementConfiguration.class.getName()};
        <span class="keyword">case</span> ASPECTJ:
            <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {
                TransactionManagementConfigUtils.TRANSACTION_ASPECT_CONFIGURATION_CLASS_NAME};
        <span class="keyword">default</span>:
            <span class="keyword">return</span> <span class="predefined-constant">null</span>;
    }
}</code></pre>
<div class="paragraph"><p>Importiert Konfigurationsklasse, abhängig von dem <code>mode</code> Parameter bei <code>@EnableTransactionManagement</code>.</p></div></section><section id="_proxytransactionmanagementconfiguration"><h2>ProxyTransactionManagementConfiguration</h2><div class="title">org.springframework.transaction.annotation.ProxyTransactionManagementConfiguration</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ProxyTransactionManagementConfiguration</span>
        <span class="directive">extends</span> AbstractTransactionManagementConfiguration {

    <span class="annotation">@Bean</span>(name = TransactionManagementConfigUtils.TRANSACTION_ADVISOR_BEAN_NAME)
    <span class="directive">public</span> BeanFactoryTransactionAttributeSourceAdvisor transactionAdvisor() {...}

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransactionAttributeSource transactionAttributeSource() {
        <span class="keyword">return</span> <span class="keyword">new</span> AnnotationTransactionAttributeSource();
    }

    <span class="annotation">@Bean</span>
    <span class="directive">public</span> TransactionInterceptor transactionInterceptor() {...}
}</code></pre>
<div class="paragraph"><p>Verwendet AOP, um Transaktionsverwaltung hinzuzufügen.</p></div></section><section id="_transactional"><h2>Transactional</h2><div class="title">org.springframework.transaction.annotation.Transactional</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="annotation">@interface</span> Transactional {
    <span class="annotation">@AliasFor</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">transactionManager</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> value() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    <span class="annotation">@AliasFor</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">value</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">String</span> transactionManager() <span class="keyword">default</span> <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>;

    Propagation propagation() <span class="keyword">default</span> Propagation.REQUIRED;

    Isolation isolation() <span class="keyword">default</span> Isolation.DEFAULT;

    <span class="type">int</span> timeout() <span class="keyword">default</span> -<span class="integer">1</span>;

    <span class="type">boolean</span> readOnly() <span class="keyword">default</span> <span class="predefined-constant">false</span>;

    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Throwable</span>&gt;<span class="type">[]</span> rollbackFor() <span class="keyword">default</span> {};

    <span class="predefined-type">String</span><span class="type">[]</span> rollbackForClassName() <span class="keyword">default</span> {};

    <span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> <span class="predefined-type">Throwable</span>&gt;<span class="type">[]</span> noRollbackFor() <span class="keyword">default</span> {};

    <span class="predefined-type">String</span><span class="type">[]</span> noRollbackForClassName() <span class="keyword">default</span> {};
}</code></pre></section><section id="_verwendung"><h2>Verwendung</h2><div class="paragraph"><p>Konfiguration:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableTransactionManagement</span></code></pre>
<div class="paragraph"><p>Eine transaktionale Service-Methode:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyServiceImpl</span> <span class="directive">implements</span> MyService {

    <span class="annotation">@Override</span>
    <span class="annotation">@Transactional</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="directive">public</span> <span class="type">void</span> doSomething() {
        <span class="comment">// ...</span>
    }
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Statt einer Methode kann man auch die ganze Klasse mit <code>@Transactional</code> annotieren.</td></tr></table></div></section><section id="_propagation"><h2><em>Propagation</em></h2><div class="ulist"><ul><li><p><code><strong>REQUIRED</strong></code> (default) startet Tx bei Bedarf</p></li><li><p><code><strong>REQUIRES_NEW</strong></code> startet neue Tx</p></li><li><p><code><strong>MANDATORY</strong></code> wirft Exception, wenn keine Tx</p></li><li><p><code><strong>SUPPORTS</strong></code> ggf. Ausführung im Tx-Context</p></li><li><p><code><strong>NOT_SUPPORTED</strong></code> suspendiert ggf. Tx</p></li><li><p><code><strong>NEVER</strong></code> wirft Exception bei Tx</p></li><li><p><code><strong>NESTED</strong></code> (nur Spring) verschachtelte Tx, falls unterstützt,
sonst wie <code>REQUIRED</code></p></li></ul></div>
<div class="paragraph"><p>Verwendung:
* Spring: <code>@Transactional(propagation = Propagation.REQUIRED)</code>
* EJB: <code>@Transactional(Transactional.TxType.REQUIRED)</code></p></div></section><section id="_isolation_2"><h2><em>Isolation</em></h2><div class="ulist"><ul><li><p><code><strong>DEFAULT</strong></code> verwendet Isolation Level der DB</p></li><li><p><code><strong>SERIALIZABLE</strong></code> verhindert Dirty Reads, non-repeatable Reads, Phantom Reads und
Lost Updates</p></li><li><p><code><strong>REPEATABLE_READ</strong></code> verhindert Dirty Reads, non-repeatable Reads und Lost Updates,
erlaubt Phantom Reads</p></li><li><p><code><strong>READ_COMMITTED</strong></code> verhindert Dirty Reads, erlaubt non-repeatable Reads, Phantom Reads
und Lost Updates</p></li><li><p><code><strong>READ_UNCOMMITTED</strong></code> erlaubt Dirty Reads, non-repeatable Reads, Phantom Reads
und Lost Updates</p></li></ul></div></section><section id="_isolation_3"><h2><em>Isolation</em></h2><div class="paragraph"><p>Verwendung:</p></div>
<div class="ulist"><ul><li><p>Spring: <code>@Transactional(isolation = Isolation.DEFAULT)</code></p></li></ul></div>
<div class="paragraph"><p>Auf Seite der DB zu beachten:</p></div>
<div class="ulist"><ul><li><p>Default Isolation Level und Konfiguration</p></li><li><p>Locking</p></li></ul></div></section><section id="_pitfalls"><h2>Pitfalls</h2><div class="ulist"><ul><li><p><code>@Transactional</code> wirkt nicht bei Selbstaufrufen (Umgehung des Proxys)!</p></li><li><p>Automatisches Rollback per Default nicht bei Checked Exceptions! Abhilfe: <code>rollbackFor=Exception.class</code></p></li><li><p><code>readOnly=true</code> unterbindet nicht zwingend schreibende Zugriffe!</p></li></ul></div>
<div class="imageblock" style=""><img src="images/attention.svg" alt="attention" height="300"></div></section></section>
<section><section id="_aufgabe_6_deklarative_transaktionen"><h2>Aufgabe 6: Deklarative Transaktionen</h2><div class="paragraph heading"><p>Schritt 1: ProxyTxTests</p></div><div class="paragraph"><p>Sehen Sie sich <code>tx.transactional.ProxyTxTests</code> an und beantworten Sie
folgende Fragen:</p></div><div class="olist arabic"><ol class="arabic"><li><p>Was müssen Sie ergänzen, damit <code>testProxy</code> funktionert?
(<em>Hinweis</em>: Deklarative Transaktionen müssen erst per Konfiguration
 aktiviert werden.)</p></li><li><p>Was passiert, wenn Sie ein <code>select * from person</code> ausführen,
während Sie den Test in der <code>insert</code> Methode angehalten haben?</p></li><li><p>Sehen Sie sich den Stacktrace beim Ausführen der <code>insert</code> Methode
an. Welche Methodenaufrufe dienen der Transaktionsverwaltung?</p></li><li><p>Die Klasse <code>ProxyTests</code> ist mit <code>@Rollback</code> annotiert. Was passiert,
wenn Sie diese Annotation durch <code>@Commit</code> ersetzen?</p></li><li><p>Was passiert, wenn Sie <code>@Transactional</code> bei <code>ProxyTxTests</code> weglassen?</p></li><li><p>Welche Auswirkung hat <code>@EnableTransactionManagement(proxyTargetClass = true)</code>?</p></li></ol></div></section><section id="_schritt_2_optional_aspectjtxtests"><h2>Schritt 2 (optional): AspectJTxTests</h2><div class="paragraph"><p>Führen Sie nun <code>tx.transactional.AspectJTxTests</code> aus.</p></div>
<div class="paragraph"><p>Beachten Sie, dass
Sie dafür den VM-Parameter <code>-javaagent:&lt;spring-instrument.jar&gt;</code> angegeben
müssen. Das <code>&lt;spring-instrument.jar&gt;</code> ist hier ein Platzhalter für den
Pfad zu diesem jar (siehe Abhängigkeiten im CLASSPATH).</p></div>
<div class="paragraph"><p>Wie ändert sich der Stacktrace beim Ausführen einer Transaktion
im Vergleich zu <code>ProxyTxTests</code>?</p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Wichtig für diese Aufgabe: Probieren geht über Studieren!</td></tr></table></div></section></section>
<section id="_datenbankzugriff_transaktionen"><h2>Datenbankzugriff &amp; Transaktionen</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson07-aop.html">&#8594; Weiter zu AOP</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_7_aop" data-state="no-title-footer"><h2>Lektion 7 - AOP</h2><div class="paragraph center"><p>Was versteht man darunter?</p></div></section>
<section><section id="_was_ist_aop"><h2>Was ist AOP?</h2><div class="paragraph heading"><p>Aspektorientierte Programmierung:</p></div><div class="ulist"><ul><li><p>Initiert 1997 durch Xerox</p></li><li><p>Im Java-Umfeld populär seit 2006 durch</p><div class="ulist"><ul><li><p>Aufnahme von AspectJ in die Eclipse Foundation</p></li><li><p>AJDT: AspectJ Development Tools (Eclipse-Plugin)</p></li></ul></div></li><li><p>Neues Programmierparadigma</p></li><li><p><strong>Ergänzt</strong> OOP (objektorientierte Programmierung)</p></li><li><p>Erhöht Modularität</p></li><li><p>DRY-Prinzip: "Don&#8217;t repeat yourself"</p></li></ul></div></section><section id="_wofür_aop_im_ee_umfeld"><h2>Wofür AOP im EE-Umfeld?</h2><div class="paragraph"><p>Versprechen von JEE:</p></div>
<div class="ulist"><ul><li><p>Entwickler kümmert sich nur um Geschäftslogik</p></li><li><p>Plattform kümmert sich um den ganzen Rest</p></li><li><p>Plattform ist austauschbar</p></li></ul></div>
<div class="ulist"><ul><li class="fragment"><p>&#8658; JEE sollte sich um die ganzen querschnittlichen Belange kümmern</p></li><li class="fragment"><p>AOP ist schlanker und flexibler</p></li></ul></div></section><section id="_wofür_ist_aop_hilfreich"><h2>Wofür ist AOP hilfreich?</h2><div class="ulist"><ul><li><p>Logging / Tracing / Monitoring</p></li><li><p>Fehlerbehandlung / Fehlertoleranz</p></li><li><p>Synchronisation / Threadsicherheit</p></li><li><p>Transaktionen</p></li><li><p>Sicherheit / Authentifizierung / Zugriffskontrolle</p></li><li><p>Caching</p></li><li><p>Validierung</p></li><li><p>Einhaltung von Standards</p></li><li><p>Plattform-/umgebungsabhängige Variationen</p></li></ul></div>
<div class="paragraph"><p><strong>&#8658; Querschnittliche Belange (<em>cross cutting concerns</em>)</strong></p></div></section><section id="_umsetzung_von_aop"><h2>Umsetzung von AOP</h2><div class="ulist"><ul><li><p>AspectJ compiler (ajc) nutzt "compile time weaving", d. h.
betroffene Klassen enthalten die Aspekt-Funktionalität</p></li><li><p>AspectJ Load-Time Weaving modifiziert Klassen beim Laden,
erfordert <code>javaagent:pathto/aspectjweaver.jar</code></p></li><li><p>Dynamic Proxies (seit JDK 1.3) nur für Interfaces</p></li><li><p>Proxies mit CGLIB (Byte Code Generation Library) nur
für sichtbare (nicht private) Methoden</p></li></ul></div></section><section id="_beispiel_für_dynamic_proxy"><h2>Beispiel für Dynamic Proxy</h2><div class="title">DynamicProxySample.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">DynamicProxySample</span> <span class="directive">implements</span> <span class="predefined-type">InvocationHandler</span> {

    <span class="type">interface</span> <span class="class">Greeter</span> {
        <span class="predefined-type">String</span> say(<span class="predefined-type">String</span> greeting);
    }

    <span class="annotation">@Test</span>
    <span class="type">void</span> testDynamicProxy() {
        Greeter greeterProxy = (Greeter) <span class="predefined-type">Proxy</span>.newProxyInstance(<span class="local-variable">this</span>.getClass().getClassLoader(),
                <span class="keyword">new</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> { Greeter.class }, <span class="local-variable">this</span>);
        <span class="predefined-type">System</span>.out.println(greeterProxy.say(<span class="string"><span class="delimiter">&quot;</span><span class="content">World</span><span class="delimiter">&quot;</span></span>));
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Object</span> invoke(<span class="predefined-type">Object</span> proxy, <span class="predefined-type">Method</span> method, <span class="predefined-type">Object</span><span class="type">[]</span> args) {
        <span class="keyword">return</span> method.getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">: Hello </span><span class="delimiter">&quot;</span></span> + args[<span class="integer">0</span>] + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre>
<div class="paragraph"><p>Ausgabe:</p></div>
<div class="literalblock"><div class="content"><pre>say: Hello World!</pre></div></div></section></section>
<section id="_aufgabe_1_türme_von_hanoi_mit_dynamic_proxy_nachvollziehen"><h2>Aufgabe 1: Türme von Hanoi mit Dynamic Proxy nachvollziehen</h2><div class="paragraph"><p>Der <code>aop.TowersOfHanoiUsingDynamicProxyTest</code> simuliert das Spiel
<em>Türme von Hanoi</em> (<a href="https://de.wikipedia.org/wiki/T%C3%BCrme_von_Hanoi">&#8594; Wikipedia</a>).</p></div>
<div class="paragraph"><p>Jeder Stab wird durch einen Stapel (Deque) von Zahlen repräsentiert, wobei der
1. Eintrag der obersten Scheibe entspricht. Die Größe der Zahl entspricht der Größe
der Scheibe.</p></div>
<div class="paragraph"><p>Verpacken Sie in der Methode <code>wrap</code> jeden Stapel mit einem Dynamic Proxy,
der die Methodenaufrufe protokolliert. Verwenden Sie dazu den <code>StackInvocationHandler</code>.</p></div></section>
<section><section id="_spring_aop"><h2>Spring AOP</h2><div class="paragraph heading"><p>Historie</p></div><div class="ulist"><ul><li><p>Seit Spring 1.2: Spring AOP APIs</p></li><li><p>Seit Spring 2.0: Aspekte per XML-Config oder AspectJ Annotationen</p></li></ul></div><div class="paragraph"><p><br></p></div><div class="paragraph heading"><p>Einschränkungen gegenüber AspectJ:</p></div><div class="ulist"><ul><li><p>Wird nur auf Beans im <code>ApplicationContext</code> angewendet</p></li><li><p>Ist nur auf Methodenaufrufe anwendbar</p></li></ul></div><div class="paragraph"><p>&#8656; Mittels <code>BeanPostProcessor</code> umgesetzt</p></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop">
&#8594; Reference: Aspect Oriented Programming with Spring</a></p></div></section><section id="_aop_konzepte"><h2>AOP Konzepte</h2><div class="ulist"><ul><li><p><strong>Aspect</strong>: Zusammenfassung einer querschnittlichen Funktionalität &#8594; OO: Klasse</p></li><li><p><strong>Join point</strong>: Konkreter Punkt im Programmablauf, an dem Funktionalität eingehängt werden könnte
(bei Spring AOP immer ein Methodenaufruf)</p></li><li><p><strong>Advice</strong>: Aktion eines <em>Aspects</em> an einem bestimmten <em>Join point</em> (Advice-Typen: before, after, around) &#8594; OO: Methode</p></li><li><p><strong>Pointcut</strong>: Prädikat zum Eingrenzen von <em>Join points</em>, Spring verwendet dafür die
<em>AspectJ pointcut expression language</em></p></li><li><p><strong>Introduction</strong>: Zusätzliche(s) Methode/Feld in einer Klasse per AOP</p></li><li><p><strong>Weaving</strong>: Einflechten der querschnittlichen Funktionalität (<em>compile time, load time o. runtime</em>)</p></li><li><p><strong>Target object</strong> bzw. <strong>Advised object</strong>: Das Objekt in welches die querschnittliche
Funktionalität eingeflochten wird</p></li><li><p><strong>AOP proxy</strong>: Stellvertreter-Objekt, welches die querschnittliche Funktionalität mitbringt</p></li></ul></div></section><section id="_aspekt_implementierung"><h2>Aspekt Implementierung</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Aspect</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">DemoAspect</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = LoggerFactory.getLogger(DemoAspect.class);

    <span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(public * *(..))</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="type">void</span> anyPublicMethod() {
    }

    <span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">anyPublicMethod()</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> <span class="type">void</span> logMethodCall(JoinPoint jp) { <i class="conum" data-value="4"></i><b>(4)</b>
        log.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">public method {} called</span><span class="delimiter">&quot;</span></span>, jp.getSignature());
    }
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Spring-Aspekte sind mit <code>@Aspect</code> annotierte Java-Klassen</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Beschreibung der Einhängepunkte (zugehörige Methode ist immer leer)</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td><em>Advise</em>-Typ</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td><em>Advise</em>-Implementierung</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-at-aspectj">
&#8594; Reference: Declaring an aspect</a></p></div></section><section id="_aspekt_verwendung"><h2>Aspekt Verwendung</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@EnableAspectJAutoProxy</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">AopSampleConfig</span> {

    <span class="annotation">@Bean</span>
    DemoAspect aspect() { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="keyword">return</span> <span class="keyword">new</span> DemoAspect();
    }</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Aktiviert Auswertung der AspectJ-Annotationen</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Sobald der Aspekt registriert ist, wird er auf alle Beans angewendet</td></tr></table></div></section></section>
<section><section id="_pointcuts"><h2>Pointcuts</h2><div class="paragraph heading"><p>Pointcuts angewandt auf Methodensignaturen</p></div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(public * *(..))</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> anyPublicMethod() {
    <span class="comment">// jede öffentliche Methode</span>
}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(ReturnType aop.fragments.SomeClass.someMethod(..))</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> someMethod() {
    <span class="comment">// jede Methode 'someMethod' in 'SomeClass', die 'ReturnType' zurückgibt</span>
}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(* aop.fragments.*Class.*Method(..))</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> someMethodUsingPatterns() {
    <span class="comment">// jede Methode, die auf 'Method' endet in einer Klasse, die auf 'Class' endet</span>
}</code></pre><div class="paragraph"><p>Pointcut-Methoden haben immer einen leeren Methodenrumpf.<br>
Der Methodenname dient nur dazu, dem Pointcut einen Namen zu geben.</p></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-pointcuts">
&#8594; Reference: Declaring a pointcut</a></p></div></section><section id="_pointcuts_angewandt_auf_klassen_oder_annotationen"><h2>Pointcuts angewandt auf Klassen oder Annotationen</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">within(aop.fragments.SomeClass))</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> allMethodsWithinSomeClass() {
    <span class="comment">// alle Methoden in der Klasse 'SomeClass'</span>
}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@annotation(tag)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> methodAnnotatedByTag(Tag tag) {
    <span class="comment">// alle Methoden, die mit '@Tag' annotiert sind</span>
}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">@within(service)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> allMethodsWithinClassesAnnotedByService(Service service) {
    <span class="comment">// alle Methoden von Klassen, die mit '@Service' annotiert sind</span>
}</code></pre></section><section id="_kombinationen"><h2>Kombinationen</h2><div class="paragraph"><p>Drei verschiedene Varianten für: Jede öffentliche Methode, die mit '@Tag' annotiert ist.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(public * *(..)) &amp;&amp; @annotation(tag)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> anyPublicMethodAnnotedByTag(Tag tag) {
}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">anyPublicMethod() &amp;&amp; @annotation(tag)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> anyPublicMethodAnnotedByTagVariant(Tag tag) {
}

<span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">anyPublicMethod() &amp;&amp; methodAnnotatedByTag(tag)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> anyPublicMethodAnnotedByTagVariant2(Tag tag) {
}</code></pre></section></section>
<section><section id="_aop_advises"><h2>AOP <em>Advises</em></h2><div class="paragraph heading"><p><em>Advise</em> Typen</p></div><div class="ulist"><ul><li><p><code>@Before</code></p></li><li><p><code>@AfterReturning</code></p></li><li><p><code>@AfterThrowing</code></p></li><li><p><code>@After</code> (entspricht finally)</p></li><li><p><code>@Around</code></p></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-advice">
&#8594; Reference: Declaring advice</a></p></div></section><section id="_advise_parameter"><h2><em>Advise</em> Parameter</h2><div class="ulist"><ul><li><p>Erster Parameter: <code>JoinPoint</code> (optional)</p><div class="ulist"><ul><li><p>bei <code>@Around</code> <code>ProceedingJoinPoint</code> (obligatorisch)</p></li></ul></div></li><li><p>Weitere Parameter über <em>Pointcut</em> Deklaration:</p><div class="ulist"><ul><li><p>Argumente aus der Methode am <em>Join point</em></p></li><li><p>Proxy-Objekt oder Target-Object</p></li><li><p>Annotationen der Methode am <em>Join point</em></p></li></ul></div></li></ul></div></section><section id="_advise_mit_methoden_parameter"><h2>Advise mit Methoden-Parameter</h2><div class="paragraph"><p><em>Advice</em> für DAO-Operation mit <code>Account</code> als ersten Parameter, der auch vom <em>Advice</em> benötigt wird:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Pointcut</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">private</span> <span class="type">void</span> accountDataAccessOperation(Account account) {}

<span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDataAccessOperation(account)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> validateAccount(Account account) {
    <span class="comment">// ...</span>
}</code></pre></section><section id="_advise_mit_annotation_parameter"><h2>Advise mit Annotation-Parameter</h2><div class="paragraph"><p>Advise für jede <code>public</code> Methode, die mit <code>@Auditable</code> annotiert ist:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Before</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">execution(public * *(..)) &amp;&amp; @annotation(auditable)</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> audit(Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="comment">// ...</span>
}</code></pre></section></section>
<section id="_spring_aop_apis"><h2>Spring AOP-APIs</h2><div class="paragraph"><p>Mit der <code>ProxyFactory</code> kann man programmatisch einen Aspekt in eine Klasse einflechten:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">private</span> &lt;T&gt; <span class="predefined-type">List</span>&lt;T&gt; wrap(<span class="predefined-type">List</span>&lt;T&gt; list) {
    ProxyFactory proxyFactory = <span class="keyword">new</span> ProxyFactory(list);
    proxyFactory.addAdvisor(<span class="keyword">new</span> RegexpMethodPointcutAdvisor(<span class="string"><span class="delimiter">&quot;</span><span class="content">.*</span><span class="char">\\</span><span class="content">.[gs]et</span><span class="delimiter">&quot;</span></span>, <span class="keyword">new</span> MethodInterceptor() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="predefined-type">Object</span> invoke(MethodInvocation invocation) <span class="directive">throws</span> <span class="predefined-type">Throwable</span> {
            <span class="predefined-type">String</span> call = invocation.getMethod().getName() + <span class="string"><span class="delimiter">&quot;</span><span class="content">(</span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.toString(invocation.getArguments()) + <span class="string"><span class="delimiter">&quot;</span><span class="content">)</span><span class="delimiter">&quot;</span></span>;
            <span class="predefined-type">Object</span> result = invocation.proceed();
            <span class="predefined-type">System</span>.out.println(call + <span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + result);
            <span class="keyword">return</span> result;
        }
    }));
    <span class="predefined-type">Object</span> wrapped = proxyFactory.getProxy();
    <span class="keyword">return</span> (<span class="predefined-type">List</span>&lt;T&gt;) wrapped;
}</code></pre>
<div class="ulist"><ul><li><p>Man kann mit <code>addAdvisor</code> einen <em>Advice</em> (z.B. <code>MethodInterceptor</code>) hinzufügen, der auf jede
Methode angewandt wird.</p></li><li><p>Ein <em>Advisor</em> ist eine Kombination aus <em>Pointcut</em> und <em>Advice</em>.</p></li><li><p>Als <em>Pointcut</em> eignet sich der <code>JdkRegexpMethodPointcut</code>.</p></li><li><p>Der <code>RegexpMethodPointcutAdvisor</code> kombiniert diesen <em>Pointcut</em> zu einem <em>Advisor</em>.</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/core.html#aop-prog">
&#8594; Reference: Creating AOP Proxies Programmatically with the ProxyFactory</a></p></div></section>
<section id="_aufgabe_2_advices_implementieren"><h2>Aufgabe 2: Advices implementieren</h2><div class="paragraph"><p>Bearbeiten Sie die Aufgaben in <code>aop.SpringAopSamplesTest</code>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Sorgen Sie dafür, dass <code>logMethodEntry</code> vor jeder DemoService-Methode ausgeführt wird. Sie müssen dafür die
richtige Advice-Typ Annotation angeben.</p></li><li><p>Bringen Sie nun <code>logMethodExit</code> nach jeder mit <code>Tag</code> annotierten DemoService-Methode zur Ausführung, wenn diese
regulär (d. h. ohne Exception) beendet wurde.</p></li><li><p>Implementieren Sie einen Around-Advise, der dafür sorgt, dass beim Aufruf von <code>greet("World")</code> statt <code>"Hello World!"</code>
<code>"Goodbye World!"</code> zurückgegeben wird.</p></li><li><p>Implementieren Sie einen Around-Advise, der bei jeder der Rechenoperationen im <code>DemoService</code> den ersten Parameter
und das Ergebnis loggt.</p></li><li><p>Was passiert, wenn Sie das <code>proxyTargetClass = true</code> bei <code>@EnableAspectJAutoProxy</code> weglassen? Warum?</p></li><li><p>Optional: Implementieren Sie einen Caching-Advice für die Methode <code>square</code></p></li><li><p>Optional: Verwenden Sie <em>AspectJ Load-Time Weaving</em> statt den CGLIB-Proxies.</p></li></ol></div>
<div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0801-boot.html">&#8594; Weiter zu Spring Boot</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_8_spring_boot" data-state="no-title-footer"><h2>Lektion 8 - Spring Boot</h2></section>
<section><section id="_spring_boot"><h2>Spring-Boot</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Spring Boot makes it easy to create stand-alone, production-grade Spring based Applications
that you can "just run".</p></div>
<div class="paragraph"><p>We take an opinionated<sup>*</sup>
view of the Spring platform and third-party libraries so you can get
started with minimum fuss. Most Spring Boot applications need very little Spring configuration.</p></div></blockquote><div class="attribution">&#8212; <a href="https://spring.io/projects/spring-boot" class="bare">https://spring.io/projects/spring-boot</a></div></div><div class="paragraph"><p><sup>*</sup>: eigensinnig, rechthaberisch</p></div></section><section id="_was_bringt_spring_boot"><h2>Was bringt Spring Boot?</h2><div class="ulist"><ul><li><p>Aufeinander abgestimmte Bibliotheksabhängigkeiten</p></li><li><p>Sinnvolle Vorgaben für automatische Konfiguration</p></li><li><p>Einheitliche Verwaltung von Einstellungen</p></li><li><p>Entwicklung und Ausführung ohne separaten Application-Server (dank <em>fat jars</em>)</p></li><li><p>Tools für Entwicklung und Monitoring</p></li></ul></div></section><section id="_woraus_besteht_spring_boot"><h2>Woraus besteht Spring Boot?</h2><div class="ulist"><ul><li><p>Große Sammlung aufeinander abgestimmter Open-Source Bibliotheksversionen</p></li><li><p>Sinnvolle Zusammenstellungen von Bibliotheken für verschiedene Anwendungsbereiche (<em>Starter</em>)</p></li><li><p>Plugins und Konfigurationseinstellungen für Gradle und Maven</p></li><li><p>Module zur automatischen Konfiguration</p></li></ul></div>
<div class="paragraph"><p>Für den Schnelleinstieg:</p></div>
<div class="ulist"><ul><li><p><a href="https://start.spring.io/">Spring Initializr</a></p></li><li><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#getting-started-installing-the-cli">Spring Boot CLI</a></p></li></ul></div></section></section>
<section><section id="_überblick_zu_den_aufgaben_dieser_lektion"><h2>Überblick zu den Aufgaben dieser Lektion</h2><div class="paragraph"><p>Wir bauen eine Aufgabenliste, bestehend aus</p></div><div class="ulist"><ul><li><p>einem Backend-Server, der eine REST-Schnittstelle bereitstellt und die
Tasks mittels JPA in einer HSQL-Datenbank speichert</p></li><li><p>einem Frontend-Server, der eine Thymeleaf basierte Oberfläche für
das Backend bereitstellt</p></li></ul></div><div class="paragraph"><p>Ziel ist, zu verstehen, was im Hintergrund tatsächlich passiert, also wie
Spring Boot das Spring-Framework nutzt, um die Funktionalität bereitzustellen.</p></div></section><section id="_vorgehen"><h2>Vorgehen</h2><div class="olist arabic"><ol class="arabic"><li><p>Grundgerüst der Applikation mit Spring Initializr anlegen</p></li><li><p>Persistenzschicht implementieren</p></li><li><p>REST-Controller für Backend implementieren</p></li><li><p>Frontend implementieren</p></li></ol></div></section></section>
<section id="_spring_initializr" class="columns"><h2>Spring Initializr</h2><div class="openblock"><div class="content"><div class="ulist"><ul><li><p>Web-Anwedung, mit der man<br>
ein ausführbares Grundgerüst<br>
einer Spring-Boot Applikation<br>
erstellen kann</p></li><li><p>In IDEs integriert<br>
(Spring-Tool-Suite,<br>
IntelliJ IDEA)</p></li></ul></div></div></div>
<div class="imageblock" style=""><img src="images/lesson08/SpringInitializr.png" alt="SpringInitializr"></div></section>
<section><section id="_aufgabe_1_grundgerüst_einer_spring_boot_applikation_erstellen_und_ergründen"><h2>Aufgabe 1: Grundgerüst einer Spring-Boot Applikation erstellen und ergründen</h2><div class="paragraph heading"><p>Schritt 1: Spring Initializr</p></div><div class="paragraph"><p>Erstellen Sie mit Spring Initializr (<a href="https://start.spring.io/" class="bare">https://start.spring.io/</a>) eine Spring-Boot
Anwendung mit folgenden Einstellungen:</p></div><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:28.5714%"><col style="width:71.4286%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Einstellungen:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Java/Maven-Projekt mit Java-Version 11</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Group:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>spring-training</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Artifact:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>lesson08-backend-rest</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Package:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>boot.backend</p></div></div></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Dependencies:</p></td><td class="tableblock halign-left valign-top"><div><div class="paragraph"><p>Web, JPA, HSQLDB, Actuator, DevTools</p></div></div></td></tr></table><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content"><em>"Depedencies/See all"</em> zeigt alle verfügbaren Abhängigkeiten</td></tr></table></div></section><section id="_schritt_2_applikation_ausführen"><h2>Schritt 2: Applikation ausführen</h2><div class="olist arabic"><ol class="arabic"><li><p>Packen Sie das heruntergeladene Projekt aus, bauen Sie es mit <code>mvn clean verify</code>
und führen Sie es mit <code>mvn spring-boot:run</code> aus.</p></li><li><p>Sehen Sie sich die Logausgaben an. Welche Informationen können Sie daraus ziehen?</p></li><li><p>Öffnen Sie <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a> im Browser.</p></li><li><p>Probieren Sie auch mal <a href="http://localhost:8080/actuator" class="bare">http://localhost:8080/actuator</a>. Was können Sie damit machen?</p></li></ol></div></section><section id="_schritt_3_implementierung_verstehen"><h2>Schritt 3: Implementierung verstehen</h2><div class="olist arabic"><ol class="arabic"><li><p>Beenden Sie nun die Applikation mit <strong>Strg-C</strong> und importieren Sie das Projekt in Ihre IDE.<br>
Alternativ können Sie auch direkt das Projekt <strong>lesson08-boot-backend-rest</strong> öffnen.</p></li><li><p>Woraus besteht das Projekt?</p></li><li><p>Sehen Sie sich die <strong>pom.xml</strong> an. Welche Teile davon sind Spring-Boot spezifisch?</p></li><li><p>Öffnen Sie die <code>Lesson08BootBackendApplication</code> Klasse. Was fällt Ihnen daran auf?</p></li><li><p>Wozu nützt der <code>Lesson08BootBackendApplicationTests</code>?</p></li></ol></div></section><section id="_schritt_4_konfiguration_anpassen"><h2>Schritt 4: Konfiguration anpassen</h2><div class="paragraph"><p>Spring Boot Applikationen werden über die <code>application.properties</code> konfiguriert. Details dazu finden
Sie im Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config">Externalized Configuration</a>
des <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle">Spring Boot Reference Guide</a>. Der Anhang
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#common-application-properties">Common application properties</a>
gibt einen groben Überblick über die Stellschrauben von Spring Boot.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Tragen Sie nun <code>debug=true</code> in die <code>application.properties</code> ein und führen Sie <code>Lesson08BootBackendApplicationTests</code> aus.</p></li><li><p>In den Logausgaben erscheint jetzt ein <strong>CONDITIONS EVALUATION REPORT</strong>. Was besagt dieser Report?</p></li></ol></div>
<div class="openblock teacherBox"><div class="content"><div class="admonitionblock tip"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Mit <strong>Spring Tool Suite 4</strong> funktioniert die Code-Completion nur, wenn der <strong>Spring Boot Validations Builder</strong>
registiert ist. Andernfalls muss man <code>.project</code> um folgenden Eintrag ergänzen und einen <strong>Restart</strong> durchführen:</td></tr></table></div>
<div class="literalblock"><div class="content"><pre>&lt;buildCommand&gt;
    &lt;name&gt;org.springframework.ide.eclipse.boot.validation.springbootbuilder&lt;/name&gt;
    &lt;arguments&gt;
    &lt;/arguments&gt;
&lt;/buildCommand&gt;</pre></div></div></div></div></section><section id="_schritt_5_actuator_endpoints_ergründen"><h2>Schritt 5: Actuator-Endpoints ergründen</h2><div class="paragraph"><p>Sie haben zuvor nur einen kleinen Teil der verfügbaren Actuator-Endpoints gesehen.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Fügen Sie <code>management.endpoints.web.exposure.include=*</code> in die <code>application.properties</code> ein, um alle Endpoints zu sehen.</p></li><li><p>Starten Sie die Applikation und öffnen Sie erneut <a href="http://localhost:8080/actuator/" class="bare">http://localhost:8080/actuator/</a>.</p></li><li><p>Ergründen Sie die verschiedenen Endpunkte. Warum sind nicht standardmäßig alle Endpunkte verfügbar?</p></li><li><p>Optional: Verwenden Sie <strong>jconsole</strong>, um die Actuator JMX-Beans zu ergründen.</p></li></ol></div>
<div class="paragraph"><p>Weitere Informationen zu Actuator finden Sie der Referenz-Doku, Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">
Spring Boot Actuator: Production-ready features</a>.</p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Mit Firefox sind Links in dem zurückgegebenen JSON navigierbar.</td></tr></table></div></section><section id="_schritt_6_logausgaben_in_eine_datei_umlenken"><h2>Schritt 6: Logausgaben in eine Datei umlenken</h2><div class="paragraph"><p>Standardmäßig erscheinen bei Spring-Boot alle Logausgaben auf der Konsole.</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Lenken Sie mit <code>logging.file.path=target/app.log</code> die Logausgaben zusätzlich in eine Datei um.</p></li><li><p>Starten Sie die Applikation neu prüfen Sie den Inhalt der Logdatei.</p></li><li><p>Vewenden Sie auch den <a href="http://localhost:8080/actuator/logfile" class="bare">http://localhost:8080/actuator/logfile</a> Link.</p></li></ol></div>
<div class="paragraph"><p>Weitere Hinweise dazu finden Sie in der Referenz-Doku, Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-logging-file-output">Logging/File Output</a>.</p></div></section></section>
<section><section id="_spring_boot_features"><h2>Spring Boot Features</h2><div class="paragraph"><p>Spring-Boot bringt einige Features mit, die wir uns im folgenden genauer ansehen.<br>
Einige davon haben wir bereits kennengelernt.</p></div></section><section id="_actuator"><h2>Actuator</h2><div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready">Actuator</a>
bietet Features für den Betrieb:</p></div>
<div class="ulist"><ul><li><p>Monitoring</p></li><li><p>Management</p></li><li><p>Endpoints per JMX oder REST</p></li><li><p><a href="https://micrometer.io/">Micrometer</a> Support, siehe Referenz-Doku, Abschnitt
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready-metrics">Metrics</a></p></li></ul></div></section><section id="_developer_tools_und_live_reload"><h2>Developer Tools und Live-Reload</h2><div class="paragraph"><p>Mit den <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-devtools">Developer Tools</a>
werden Änderungen ohne Neustart der Applikation sichtbar</p></div>
<div class="ulist"><ul><li><p>Arbeitet mit 2. <em>ClassLoader</em> für geänderte Klassen</p></li><li><p>Führt bei Änderungen automatisch einen Restart durch, d. h. der <em>ApplicationContext</em> wird neu initialisiert,
ohne dass alle Klassen neu geladen werden müssen</p></li><li><p>Unterstützt <a href="http://livereload.com/extensions/">LiveReload</a> (ein Browser-Plugin, welches den Klick auf den Refresh-Button erspart)</p></li><li><p>Ist kein vollwertiger Ersatz für <a href="https://jrebel.com/software/jrebel/">JRebel</a></p></li></ul></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Bei IntelliJ ist ein expliziter Rebuild (Ctrl-Shift-F9) notwendig, um einen Restart auszulösen</td></tr></table></div></section><section id="_parent_pom_und_dependencies"><h2>Parent-POM und Dependencies</h2><div class="paragraph"><p>Das Spring-Boot Parent-POM liefert sinnvolle Voreinstellung, Maven-Plugins und aufeinander abgestimmte
Versionen für 3<sup>rd</sup> Party Bibliotheken:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;parent&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>2.4.4<span class="tag">&lt;/version&gt;</span>
    <span class="tag">&lt;relativePath</span> <span class="tag">/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span>
<span class="tag">&lt;/parent&gt;</span></code></pre>
<div class="paragraph"><p>Alternativ kann man nur die aufeinander abgestimmten Abhängigkeiten verwenden
(das erspart Versionsangaben). Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-maven-without-a-parent">
Using Spring Boot without the Parent POM</a> in Referenz-Doku:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;dependencyManagement&gt;</span>
    <span class="tag">&lt;dependencies&gt;</span>
        <span class="tag">&lt;dependency&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-dependencies<span class="tag">&lt;/artifactId&gt;</span>
            <span class="tag">&lt;version&gt;</span>2.4.4<span class="tag">&lt;/version&gt;</span>
            <span class="tag">&lt;scope&gt;</span>import<span class="tag">&lt;/scope&gt;</span>
            <span class="tag">&lt;type&gt;</span>pom<span class="tag">&lt;/type&gt;</span>
        <span class="tag">&lt;/dependency&gt;</span>
    <span class="tag">&lt;/dependencies&gt;</span>
<span class="tag">&lt;/dependencyManagement&gt;</span></code></pre></section><section id="_spring_boot_maven_plugin"><h2>Spring-Boot Maven-Plugin</h2><div class="paragraph"><p>Man bindet es folgendermaßen ein:</p></div>
<pre class="CodeRay listingblock"><code class="xml language-xml"><span class="tag">&lt;build&gt;</span>
    <span class="tag">&lt;plugins&gt;</span>
        <span class="tag">&lt;plugin&gt;</span>
            <span class="tag">&lt;groupId&gt;</span>org.springframework.boot<span class="tag">&lt;/groupId&gt;</span>
            <span class="tag">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/artifactId&gt;</span>
        <span class="tag">&lt;/plugin&gt;</span>
    <span class="tag">&lt;/plugins&gt;</span>
<span class="tag">&lt;/build&gt;</span></code></pre>
<div class="paragraph"><p>Es bietet:</p></div>
<div class="ulist"><ul><li><p>Erstellung ausführbarer "fat" JARs</p></li><li><p>Ausführung mit <code>mvn spring-boot:run</code></p></li></ul></div>
<div class="paragraph"><p>Siehe auch <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-running-with-the-maven-plugin">
Using the Maven Plugin</a> in der Referenz-Doku.</p></div></section><section id="_weitere_unterstützung_beim_build"><h2>Weitere Unterstützung beim Build</h2><div class="ulist"><ul><li><p>Erzeugung von <code>META-INF/build-info.properties.</code> Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-build-info">
Generate Build Information</a>.</p></li><li><p>Erzeugung von <code>git.properties</code>. Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-git-info">
Generate Git Information</a>.</p></li><li><p>Anpassung einzelner Bibliotheksversionen. Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-customize-dependency-versions">
Customize Dependency Versions</a>.</p></li><li><p>Erstellung einer <strong>WAR</strong> Datei. Siehe
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-create-a-deployable-war-file">
Create a Deployable War File</a>.</p></li></ul></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Alle bisher genannten Features sind auch für <em>Gradle</em> verfügbar.</td></tr></table></div></section><section id="_springbootapplication"><h2>@SpringBootApplication</h2><div class="paragraph"><p>Meta-Annotation für:</p></div>
<div class="title">org.springframework.boot.autoconfigure.SpringBootApplication</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootConfiguration</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@EnableAutoConfiguration</span> <i class="conum" data-value="2"></i><b>(2)</b>
<span class="annotation">@ComponentScan</span>(excludeFilters = {
        <span class="annotation">@Filter</span>(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class), <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="annotation">@Filter</span>(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) }) <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Marker für Tests, sonst wie <code>@Configuration</code></td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Auto-Konfiguration aktivieren</td></tr><tr><td><i class="conum" data-value="3"></i><b>3</b></td><td>Verarbeitet alle TypeExcludeFilter Beans (nützlich fürs Testen)</td></tr><tr><td><i class="conum" data-value="4"></i><b>4</b></td><td>Auto-Config-Klassen ausschließen</td></tr></table></div>
<div class="paragraph"><p>Wichtigster Parameter ist <code>exclude</code>, um einzelne Autokonfigurationen auszuschließen.<br>
&#8594; <a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/autoconfigure/SpringBootApplication.html">Javadocs</a>.</p></div></section><section id="_application_klasse_standalone"><h2>Application Klasse (Standalone)</h2><div class="paragraph"><p>In der Regel ist eine Spring-Boot Applikation eine Config-Klasse mit einer <code>main</code> Methode:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBootApplication</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = <span class="predefined-type">LogManager</span>.getLogger(MyBootApplication.class);

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication.run(MyBootApplication.class, args);
    }
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/SpringApplication.html">
&#8594; Javadocs: SpringApplication</a></p></div></section><section id="_application_klasse_mit_angepassten_einstellungen"><h2>Application Klasse mit angepassten Einstellungen</h2><div class="paragraph"><p>Wenn man spezielle Einstellungen benötigt, kann man <code>SpringApplication</code> auch selbst erzeugen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyCustomizedBootApplication</span> {
    <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">Logger</span> log = <span class="predefined-type">LogManager</span>.getLogger(MyCustomizedBootApplication.class);

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) {
        SpringApplication application = <span class="keyword">new</span> SpringApplication(MyCustomizedBootApplication.class);
        customize(application);
        application.run();
    }

    <span class="directive">private</span> <span class="directive">static</span> <span class="type">void</span> customize(SpringApplication application) {
        application.addListeners(<span class="keyword">new</span> ApplicationListener&lt;ApplicationEvent&gt;() {

            <span class="annotation">@Override</span>
            <span class="directive">public</span> <span class="type">void</span> onApplicationEvent(ApplicationEvent event) {
                log.info(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Application Event: </span><span class="delimiter">&quot;</span></span> + event);
            }
        });
    }
}</code></pre></section><section id="_application_klasse_war"><h2>Application Klasse (WAR)</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootApplication</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyBootWebApplication</span> <span class="directive">extends</span> SpringBootServletInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
        <span class="keyword">return</span> builder.sources(MyBootWebApplication.class); <i class="conum" data-value="1"></i><b>(1)</b>
    }

    <span class="directive">public</span> <span class="directive">static</span> <span class="type">void</span> main(<span class="predefined-type">String</span><span class="type">[]</span> args) { <i class="conum" data-value="2"></i><b>(2)</b>
        SpringApplication.run(MyBootWebApplication.class, args);
    }
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Zeigt, wie man eine Konfigurationsklasse hinzufügt. (Nicht notwendig, wenn <code>SpringBootServletInitializer</code> selbst eine
Konfigurationsklasse ist.)</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Dank der <code>main</code> Methode ist für die Entwicklung kein Application-Server notwendig.</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#howto-create-a-deployable-war-file">
&#8594; Boot Reference: Create a Deployable War File</a><br>
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/web/servlet/support/SpringBootServletInitializer.html">
&#8594; Javadocs: SpringBootServletInitializer</a><br>
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/builder/SpringApplicationBuilder.html">
&#8594; Javadocs: SpringApplicationBuilder</a></p></div></section><section id="_commandlinerunner"><h2>CommandLineRunner</h2><div class="paragraph"><p>Beans, die das <code>CommandLineRunner</code> Interface implementieren werden unmittelbar nach Initialisierung
des <code>ApplicationContext</code> ausgeführt.</p></div>
<div class="paragraph"><p>Die Ausführungsreihenfolge kann man über die <code>@Order</code> Annotation oder das <code>Ordered</code> Interface beeinflussen.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
CommandLineRunner commandLineArgsInitializer() {
    <span class="keyword">return</span> <span class="keyword">new</span> CommandLineRunner() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> run(<span class="predefined-type">String</span>... args) <span class="directive">throws</span> <span class="exception">Exception</span> {
            log.info(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Command-Line: </span><span class="delimiter">&quot;</span></span> + <span class="predefined-type">Arrays</span>.toString(args));
        }
    };
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/CommandLineRunner.html">&#8594; Javadocs</a></p></div></section><section id="_applicationrunner"><h2>ApplicationRunner</h2><div class="paragraph"><p><code>ApplicationRunner</code> unterscheidet sich von <code>CommandLineRunner</code> nur dadurch, dass aus den Befehlszeilenargumenten
bereits die Optionen herausgefiltert sind.<br>
Optionen sind Argumente der Form <code>--opt=wert</code>.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Bean</span>
ApplicationRunner interpretedArgsInitializer() {
    <span class="keyword">return</span> <span class="keyword">new</span> ApplicationRunner() {

        <span class="annotation">@Override</span>
        <span class="directive">public</span> <span class="type">void</span> run(ApplicationArguments args) <span class="directive">throws</span> <span class="exception">Exception</span> {
            log.info(() -&gt; <span class="string"><span class="delimiter">&quot;</span><span class="content">Options: </span><span class="delimiter">&quot;</span></span> + args.getOptionNames().stream()
                    .map(name -&gt; name + <span class="string"><span class="delimiter">&quot;</span><span class="content">: </span><span class="delimiter">&quot;</span></span> + args.getOptionValues(name))
                    .collect(Collectors.joining(<span class="string"><span class="delimiter">&quot;</span><span class="content">, </span><span class="delimiter">&quot;</span></span>)));
        }
    };
}</code></pre>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/ApplicationRunner.html">&#8594; Javadocs</a><br>
<a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/ApplicationArguments.html#getOptionValues-java.lang.String-">
&#8594; Javadocs zu getOptionValues</a></p></div></section><section id="_spring_boot_tests"><h2>Spring Boot Tests</h2><div class="paragraph"><p><code>@SpringBootTest</code> ist Meta-Annotation für:</p></div>
<pre class="CodeRay listingblock"><code>@BootstrapWith(SpringBootTestContextBootstrapper.class)
@ExtendWith(SpringExtension.class)</code></pre>
<div class="ulist"><ul><li><p>Für JUnit-4 ist zusätzlich <code>@RunWith(SpringRunner.class)</code> notwendig.</p></li><li><p>Sucht im gleichen Package nach <code>@SpringBootConfiguration</code> und verwendet diese.<br>
(Deswegen sollte es nur eine Config-Klasse geben, die mit <code>@SpringBootConfiguration</code> annotiert ist.)</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/2.2.6.RELEASE/api/org/springframework/boot/test/context/SpringBootTestContextBootstrapper.html">
&#8594; Javadocs: SpringBootTestContextBootstrapper</a></p></div></section></section>
<section><section id="_externe_konfiguration_4"><h2>Externe Konfiguration</h2><div class="paragraph heading"><p>Rangfolge für Einstellungen (Auszug):</p></div><div class="olist arabic"><ol class="arabic"><li><p>Befehlszeilenargumente (z. B. <code>--server.port=7777</code>)</p></li><li><p><code>ServletConfig</code> bzw. <code>ServletContext</code> Init-Parameter</p></li><li><p>JNDI Attribute von <code>java:comp/env</code></p></li><li><p>System-Properties (z. B. <code>-Dserver.port=7777</code>)</p></li><li><p>Umgebungsvariablen</p></li><li><p><code>application-{profile}.properties</code> im lokalen Verzeichnis</p></li><li><p><code>application-{profile}.properties</code> im JAR</p></li><li><p><code>application.properties</code> im lokalen Verzeichnis</p></li><li><p><code>application.properties</code> im JAR</p></li><li><p>Mit <code>@PropertySource</code> Annotationen an den <code>@Configuration</code> Klassen</p></li><li><p>Default Properties, die mit <code>SpringApplication.setDefaultProperties</code> angegeben wurden</p></li></ol></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config-application-property-files">
&#8594; Reference: Externalized Configuration</a></p></div></section><section id="_application_properties_dateien"><h2>Application Properties Dateien</h2><div class="paragraph"><p>Spring Boot Applikationen suchen die <strong><code>application.properties</code></strong></p></div>
<div class="olist arabic"><ol class="arabic"><li><p>im <code>/config</code> Unterverzeichnis des aktuellen Verzeichnisses</p></li><li><p>im aktuellen Verzeichnis</p></li><li><p>in einem <code>/config</code> Package im Classpath</p></li><li><p>im Wurzelverzeichnis des Classpath</p></li></ol></div>
<div class="paragraph"><p>Dieses Verhalten lässt sich über <code>spring.config.name</code> und <code>spring.config.location</code> ändern.</p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Alternativ zu '.properties' Dateien kann man auch
<a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config-yaml">
&#8594; YAML</a> verwenden.</td></tr></table></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-external-config">
&#8594; Reference: Application Property Files</a></p></div></section></section>
<section id="_spring_boot_einführung"><h2>Spring Boot Einführung</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson0802-rest.html">&#8594; Weiter zu REST</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_rest" data-state="no-title-footer"><h2>REST</h2><div class="paragraph center"><p>Was ist das?</p></div></section>
<section><section id="_rest_grundlagen"><h2>REST Grundlagen</h2><div class="ulist"><ul><li><p>Steht für <strong>Representational State Transfer</strong></p></li><li><p>Begriff: Doktorarbeit von Roy Fielding aus dem Jahr 2000</p></li><li><p>Technologie für Maschine zu Maschine Kommunikation</p></li><li><p>Fußt auf den Prinzipien des Web (Web für Maschinen)</p></li><li><p>Eine REST-API muss 5 Bedingungen erfüllen</p></li></ul></div></section><section id="_1_client_server"><h2>1. Client-Server</h2><div class="ulist"><ul><li><p>Strikte Trennung der Systeme</p></li><li><p>Verbindung kann unterbrochen sein</p></li></ul></div></section><section id="_2_zustandslos"><h2>2. Zustandslos</h2><div class="ulist"><ul><li><p>Keine Sitzungsinformation auf dem Server<br>
(Andernfalls nur REST-artig)</p></li><li><p>Zustand (Sitzung) wird auf Client vorgehalten</p></li><li><p>Nachrichten sind selbstbeschreibend</p></li><li><p>Jede Anfrage muss alle notwendigen Informationen enthalten,
damit der Server diese verarbeiten kann (inkl. Sitzungsinformationen)</p></li><li><p>Jede Antwort muss alle Informationen enthalten, die der Client
benötigt, um die Sitzung zu aktualisieren</p></li></ul></div></section><section id="_3_cachbar"><h2>3. Cachbar</h2><div class="ulist"><ul><li><p>Antworten müssen Informationen enthalten,
ob und wie lange gecached werden kann</p></li><li><p>Client kann nicht davon Ausgehen, dass Antwort direkt vom Server kommt</p></li></ul></div></section><section id="_4_schichtenarchitektur"><h2>4. Schichtenarchitektur</h2><div class="ulist"><ul><li><p>Zwischen Client und Server kann diverse Middleware liegen</p></li><li><p>&#8658; Erhöht Skalierbarkeit und Ausfallsicherheit</p></li></ul></div></section><section id="_5_einheitliche_schnittstelle"><h2>5. Einheitliche Schnittstelle</h2><div class="ulist"><ul><li><p>Einhaltung der HTTP-Spezifikation</p></li><li><p>Ein Vertrag für alle Belange</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Richtlinien der einheitlichen Schnittstelle:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Ressourcen basiert (URIs zur Identifizierung, repräsentationsunabhängig)</p></li><li><p>Bearbeitung der Ressourcen über deren Repräsentation</p></li><li><p>Selbstbeschreibende Nachrichten (jede Nachricht enthält explizt alles, was zu
deren Verarbeitung notwendig ist, z. B. Typ, Cachbarkeit)</p></li><li><p><em>Hypermedia as the Engine of Application State</em> (HATEOS)</p></li></ol></div></section><section id="_hateoas"><h2>HATEOAS</h2><div class="ulist"><ul><li><p>Client-Request enthält alle notwendigen Zustandsinformationen, die der Server benötigt,
um den Request zu bearbeiten. Der Server weiß (speichert) nichts zu dem Client.</p></li><li><p>Der Server muss in seiner Antwort jeglichen Zustand an den Client übertragen, der
für den nächsten Schritt notwendig ist.</p></li><li><p>Der Client übertägt die Zustandsinformation in Form von URLs, Request-Parametern,
Request-Headern und dem Request-Inhalt (Body). Der Server überträgt Zustand mittels
dem Inhalt der Antwort (Body), den Headern und dem Response-Code.</p></li><li><p>Daneben versteht man unter HATEOAS auch, dass Antworten im Inhalt oder im Header (<em>Location</em>, <em>Link</em>)
die Links zu den zurückgegeben Objekten und ggf. zu weiterführenden Objekten enthalten.</p></li></ul></div></section><section id="_6_ausführbarer_code_auf_anforderung_optional"><h2>6. Ausführbarer Code auf Anforderung (optional)</h2><div class="paragraph"><p>Server kann Funktionalität auf den Client übertragen (z. B. JavaScript-Code)</p></div></section><section id="_resourcen_basiert"><h2>Resourcen basiert</h2><div class="ulist"><ul><li><p>Resourcen (Dinge) werden über URIs identifiziert<br>
(es kann mehrere URIs geben, die auf die gleiche Ressource zeigen)</p></li><li><p>Resourcen sind unabhängig von deren Repräsenation (verschiedene Repräsenationen möglich)</p></li><li><p>Aktionen werden über HTTP-Verben (GET, POST, PUT, DELETE) angegeben</p></li><li><p>Repräsenationen (JSON, XML, HTML, PDF, etc.) werden über den Content-Type (MIME) angegeben</p></li><li><p>&#8658; URLs werden zum Adressieren von Ressourcen verwendet</p></li></ul></div>
<div class="paragraph"><p><br></p></div>
<table class="tableblock frame-all grid-all" style="width:50%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">REST URLs</th><th class="tableblock halign-left valign-top">SOAP-RPC URLs</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Dinge</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Aktionen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Substantive</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Verben</p></td></tr></table></section><section id="_repräsentationen"><h2>Repräsentationen</h2><div class="ulist"><ul><li><p>Die Repräsentationen sind das, was tatsächlich zwischen Client und Server übertragen wird</p></li><li><p>Sie geben den Ressourcen Zustand (oder einen Teil davon) wieder</p></li><li><p>Umfassen neben Nutzdaten auch Metadaten (Typinformationen)</p></li><li><p>Typischerweise JSON oder XML, kann aber bliebiges Format sein (z. B. PDF, HTML, &#8230;&#8203;)</p></li></ul></div></section><section id="_vorteile"><h2>Vorteile</h2><div class="ulist"><ul><li><p>Skalierbarkeit</p></li><li><p>Einfachheit</p></li><li><p>Wartbarkeit</p></li><li><p>Sichtbarkeit</p></li><li><p>Portierbarkeit</p></li><li><p>Zuverlässigkeit</p></li></ul></div>
<div class="paragraph"><p><a href="https://www.restapitutorial.com/lessons/whatisrest.html">
&#8594; www.restapitutorial.com: What is REST?</a></p></div></section><section id="_http_verben"><h2>HTTP Verben</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:14.2857%"><col style="width:28.5714%"><col style="width:57.1429%"></colgroup><tbody><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">GET</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">idempotent und sicher</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Eine (Menge von) Ressource(n) über ihre URI abrufen</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">POST</p></th><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erstellt eine Ressource</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">PUT</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">idempotent</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Eine (Menge von) Ressource(n) anhand ihrer URI ändern (vollständig ersetzen)</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">PATCH</p></th><td class="tableblock halign-left valign-top"></td><td class="tableblock halign-left valign-top"><p class="tableblock">Eine Ressource ändern (nur einzelne Attribute)</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">DELETE</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">idempotent</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Entfernt eine Ressource anhand ihrer URI</p></td></tr></table>
<div class="paragraph"><p><a href="https://www.restapitutorial.com/lessons/httpmethods.html">
&#8594; HTTP-Methods für REST</a><br>
<a href="https://www.tutorialspoint.com/http/http_methods.htm">
&#8594; HTTP-Methods allgemein</a></p></div>
<aside class="notes"><div class="ulist"><ul><li><p><strong>Sicher</strong> heißt: Die Operation ändert nichts.</p></li><li><p><strong>GET</strong> Parameter können für Filter verwendet werden.</p></li><li><p><strong>PUT</strong> kann auch zum Anlegen verwendet werden, wenn der Identifier (die URI) bereits vorher bekannt ist.
Die URI muss die zu ändernde(n) Resource(n) eindeutig identifizieren (nicht der Nachrichteninhalt).</p></li><li><p><strong>POST</strong> kann für alle anderen Operationen verwendet werden, die zu keiner der genannten Kategorieen passt.</p></li><li><p><strong>DELETE</strong> ist zwar idempotnent, kann aber dennoch verschiedene Resposes liefern: 204 (wurde gelöscht)
und 404 (nicht mehr vorhanden)</p></li></ul></div></aside></section><section id="_richtlinien_für_rest_uris"><h2>Richtlinien für REST-URIs</h2><div class="ulist"><ul><li><p>IDs sind immer Bestandteil der URL (Parameter nur zum Filtern)</p></li><li><p>Nur Substantive (Verben sind ein <em>Bad Smell</em>)</p></li><li><p>Plural</p></li><li><p>Nur Kleinbuchstaben und '-' zur Trennung</p></li><li><p><em>/users</em> für eine Menge und <em>/users/123</em> für einzelne Ressource</p></li></ul></div>
<div class="paragraph"><p>Beispiel: <code>account/payment</code> statt <code>account/pay</code></p></div></section><section id="_wichtigste_http_antwortcodes"><h2>Wichtigste HTTP Antwortcodes</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">200 OK</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erfolg (normale Antwort)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">201 CREATED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erfolgreich erstellt (Antwort auf POST)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">204 NO CONTENT</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Erfolg, aber kein Inhalt (Antwort auf DELETE)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">400 BAD REQUEST</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Anfrage kann nicht verarbeitet werden (Validierungsfehler)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">401 UNAUTHORIZED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Notwendige Authentifizerung fehlt (z.B. kein Token vorhanden)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">403 FORBIDDEN</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Berechtigung nicht ausreichend</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">404 NOT FOUND</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Ressource existiert nicht</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">405 METHOD NOT ALLOWED</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">HTTP-Methode für die entsprechende URI nicht anwendbar</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">409 CONFLICT</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Bearbeitung der Anfrage würde zu Inkonsistenzen führen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">410 GONE</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Die Ressource wurde gelöscht (wenn das bekannt ist, sonst 404)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">415 UNSUPPORTED MEDIA TYPE</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Format der übertragenen Daten nicht untersützt</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">500 INTERNAL SERVER ERROR</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Unerwarteter Fehler auf Server</p></td></tr></table>
<div class="paragraph"><p><a href="https://www.restapitutorial.com/lessons/httpstatuscodes.html">
&#8594; HTTP Status Codes</a><br></p></div>
<aside class="notes"><div class="dlist"><dl><dt class="hdlist1">405 METHOD NOT ALLOWED</dt><dd><p>Beispielsweise bei einem POST auf <em>/users/123</em> statt auf <em>/users</em>. Die Antwort muss einen <em>Allow</em> Header mit den
unterstützten Methoden enthalten, z. B. <code>Allow: GET, PUT</code></p></dd><dt class="hdlist1">409 CONFLICT</dt><dd><p>Beispielsweise doppelte Einträge</p></dd></dl></div></aside></section><section id="_fragen"><h2>Fragen?</h2><div class="ulist"><div class="title">Auch interessant:</div><ul><li><p>JSON-API</p></li></ul></div></section></section>
<section><section id="_webanwendungen_mit_java"><h2>Webanwendungen mit Java</h2><div class="ulist"><ul><li><p>Servlet-API seit 1996 (aktuell 4.0 seit Sept. 2017 als Teil von JavaEE 8)</p></li><li><p>Servlets können aus Java Server Pages (JSPs) erzeugt werden</p></li><li><p>Werden als WAR deployed</p></li><li><p>Ausführbar auf Servlet Container (z.B. Tomcat) oder Application Server (z.B. GlassFish)</p></li></ul></div></section><section id="_einfaches_servlet"><h2>Einfaches Servlet</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        <span class="predefined-type">String</span> name = req.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
        resp.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
        resp.getWriter().println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section><section id="_zugehörige_web_infweb_xml"><h2>Zugehörige WEB-INF/web.xml</h2><pre class="CodeRay listingblock"><code class="xml language-xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;web-app</span> <span class="attribute-name">xmlns:xsi</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2001/XMLSchema-instance</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">xsi:schemaLocation</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://xmlns.jcp.org/xml/ns/javaee</span>
                             <span class="content">http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd</span><span class="delimiter">&quot;</span></span>
         <span class="attribute-name">version</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">3.1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Hello Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>hello.HelloServlet<span class="tag">&lt;/servlet-class&gt;</span>
    <span class="tag">&lt;load-on-startup&gt;</span>1<span class="tag">&lt;/load-on-startup&gt;</span>
  <span class="tag">&lt;/servlet&gt;</span>
  <span class="tag">&lt;servlet-mapping&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>Hello Servlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;url-pattern&gt;</span>/hello<span class="tag">&lt;/url-pattern&gt;</span>
  <span class="tag">&lt;/servlet-mapping&gt;</span>
<span class="tag">&lt;/web-app&gt;</span></code></pre></section><section id="_servlet_ohne_web_xml"><h2>Servlet ohne web.xml</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@WebServlet</span>(urlPatterns = <span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, loadOnStartup = <span class="integer">1</span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloServlet</span> <span class="directive">extends</span> HttpServlet {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> doGet(HttpServletRequest req, HttpServletResponse resp)
            <span class="directive">throws</span> ServletException, <span class="exception">IOException</span> {
        <span class="predefined-type">String</span> name = req.getParameter(<span class="string"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>);
        resp.setContentType(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>);
        resp.getWriter().println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre>
<div class="paragraph"><p>seit Servlet API 3.0</p></div></section></section>
<section><section id="_spring_web_mvc"><h2>Spring Web-MVC</h2><div class="ulist"><ul><li><p>Web Framework, das auf Servlet API basiert</p></li><li><p>Setzt Model-View-Controller Pattern um</p></li><li><p>Verwendet zentrales <code>DispatcherServlet</code></p></li></ul></div><div class="paragraph"><p><br></p></div><div class="paragraph"><div class="title">Problem:</div><p>Das <code>DispatcherServlet</code> muss über den <code>ApplicationContext</code> konfigurierbar sein</p></div></section><section id="_applicationcontext_bei_web_applikationen"><h2>ApplicationContext bei Web-Applikationen</h2><div class="imageblock" style=""><img src="images/web-application-context-hierarchy.svg" alt="web application context hierarchy" width="100%" height="391"></div></section><section id="_webapplicationcontext"><h2>WebApplicationContext</h2><div class="imageblock" style=""><img src="images/web-application-context.svg" alt="web application context" width="700" height="600"></div></section><section id="_kontext_hierarchie"><h2>Kontext-Hierarchie</h2><div class="imageblock" style=""><img src="images/context-hierarchie.svg" alt="context hierarchie" width="1200" height="720"></div></section><section id="_initialisierung_des_dispatcherservlet"><h2>Initialisierung des DispatcherServlet</h2><div class="dlist"><dl><dt class="hdlist1"><code>spring-web-5.3.6.jar!/META-INF/services/javax.servlet.ServletContainerInitializer</code></dt><dd><div class="ulist"><ul><li><p>wird von Servlet-Container geladen (<a href="https://download.oracle.com/otn-pub/jcp/servlet-3_1-fr-spec/servlet-3_1-final.pdf">&#8594; Servlet-Spec 3.1, Abschnitt 8.2.4</a>)</p></li><li><p>ist eine Textdatei, die auf einen <a href="https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/ServiceLoader.html#developing-service-providers">Service Provider</a> verweist</p></li><li><p>diese Textdatei enthält:</p></li></ul></div></dd><dt class="hdlist1"><code>org.springframework.web.SpringServletContainerInitializer</code></dt><dd><div class="ulist"><ul><li><p>führt alle <code>org.springframework.web.WebApplicationInitializer</code> aus, u. a. Subklassen von:</p></li></ul></div></dd><dt class="hdlist1"><code>org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer</code></dt><dd><div class="ulist"><ul><li><p>erzeugt <code>AnnotationConfigWebApplicationContext</code></p></li><li><p>registriert <code>DispatcherServlet</code> beim <code>ServletContext</code></p></li></ul></div></dd></dl></div></section><section id="_beispiel_für_einen_webapplicationinitializer"><h2>Beispiel für einen WebApplicationInitializer</h2><div class="title">HelloWebAppInitializer.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">HelloWebAppInitializer</span>
        <span class="directive">extends</span> AbstractAnnotationConfigDispatcherServletInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> getRootConfigClasses() {
        <span class="comment">// Config-Klassen für Root-ApplicationContext</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span>{};
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Class</span>&lt;?&gt;<span class="type">[]</span> getServletConfigClasses() {
        <span class="comment">// Config-Klassen für Servlet-ApplicationContext</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Class</span><span class="type">[]</span> {HelloConfig.class};
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">String</span><span class="type">[]</span> getServletMappings() {
        <span class="comment">// Servlet-Mappings für das DispatcherServlet</span>
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">String</span><span class="type">[]</span> {<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>};
    }
}</code></pre></section><section id="_dispatcherservlet_bei_rest_service"><h2>DispatcherServlet bei REST-Service</h2><div class="imageblock" style=""><img src="images/mvcrest-seq.svg" alt="mvcrest seq" width="1200" height="720"></div></section><section id="_konfiguration_ohne_spring_boot"><h2>Konfiguration ohne Spring-Boot</h2><div class="title">HelloConfig.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Configuration</span>
<span class="annotation">@ComponentScan</span>
<span class="annotation">@EnableWebMvc</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloConfig</span> <span class="directive">implements</span> WebMvcConfigurer { <i class="conum" data-value="2"></i><b>(2)</b>

}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Standardkonfiguration für MVC-Applikationen</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td>Das <code>WebMvcConfigurer</code> Interface bietet viele Methoden zur Anpassung der Konfiguration</td></tr></table></div></section></section>
<section><section id="_rest_mit_spring_web_mvc"><h2>REST mit Spring Web-MVC</h2><div class="paragraph"><p>REST-Endpunkte werden mit Controller-Klassen implementiert. Das sind normale Java-Klassen
mit entsprechenden Annotationen:</p></div><div class="title">HelloController.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@RestController</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">HelloController</span> {

    <span class="annotation">@GetMapping</span>(path=<span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>, produces = <span class="string"><span class="delimiter">&quot;</span><span class="content">text/html</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> <span class="predefined-type">String</span> hello(<span class="annotation">@RequestParam</span> <span class="predefined-type">String</span> name) {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">&quot;</span><span class="content">!</span><span class="delimiter">&quot;</span></span>;
    }
}</code></pre></section><section id="_wichtige_annotationen_für_controller"><h2>Wichtige Annotationen für Controller</h2><div class="dlist"><dl><dt class="hdlist1"><code>@Controller</code> bzw. <code>@RestController</code></dt><dd><p>Markiert eine Klasse als Controller<br>
<code>@RestController</code> ist Meta-Annotation für <code>@Controller</code> + <code>@ResponseBody</code></p></dd><dt class="hdlist1"><code>@RequestMapping</code> bzw. <code>@GetMapping</code> (analog für <code>Post</code>, <code>Put</code>, <code>Delete</code> und <code>Patch</code>)</dt><dd><p>Markiert eine Methode als Request-Handler<br>
<code>@GetMapping</code> ist Meta-Annotation für <code>@RequestMapping(method = RequestMethod.GET)</code></p></dd><dt class="hdlist1"><code>@PathVariable</code></dt><dd><p>Ein <code>{variable}</code> innerhalb eines Pfade definiert eine Variable und deren Wert
mittels <code>@PathVariable</code> der Handler-Methode übergeben werden kann.</p></dd></dl></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/owners/{ownerId}/pets/{petId}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Pet findPet(<span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> ownerId, <span class="annotation">@PathVariable</span> <span class="predefined-type">Long</span> petId) { ... }</code></pre>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(path = <span class="string"><span class="delimiter">&quot;</span><span class="content">/pets/{petId}</span><span class="delimiter">&quot;</span></span>, produces = <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json;charset=UTF-8</span><span class="delimiter">&quot;</span></span>)
<span class="comment">// statt &quot;application/json;charset=UTF-8&quot; geht auch org.springframework.http.MediaType.APPLICATION_JSON_UTF8_VALUE</span></code></pre></section><section id="_request_mapping"><h2>Request-Mapping</h2><div class="ulist"><ul><li><p>Die Zuordnung von Requests zu Handler-Methoden erfolgt über den <code>path</code> Wert der
entsprechenden <code>@RequestMapping</code> Annotation.</p></li><li><p>Neben den Platzhaltern von Path-Variablen <code>{var}</code> können auch <code>?</code>, <code><strong></code> und <code></strong>*</code> verwendet werden.</p></li><li><p>Implizit wird <code>.*</code> angehängt, so dass auf <code>/person</code> auch <code>/person.pdf</code> und <code>/person.xml</code> passen.</p></li><li><p>Mit <code>params</code> oder <code>header</code> kann zugleich noch auf das Vorhanden sein eines bestimmten
Parameters bzw. Headers geprüft werden:</p><div class="ulist"><ul><li><p><code>@GetMapping(path = "/pets", params = "myParam")</code> Parameter muss vorhanden sein</p></li><li><p><code>@GetMapping(path = "/pets", params = "!myParam")</code> Parameter darf nicht vorhanden sein</p></li><li><p><code>@GetMapping(path = "/pets", params = "myParam=myValue")</code> Parameter muss genau den angegeben Wert haben</p></li></ul></div></li></ul></div></section></section>
<section id="_rest_apis_testen"><h2>REST-APIs testen</h2><div class="paragraph heading"><p><strong>curl</strong> (über <strong>Git Bash</strong> aufrufbar)</p></div>
<div class="paragraph"><p>Liste aller Tasks:</p></div>
<div class="literalblock"><div class="content"><pre>curl http://localhost:8080/tasks</pre></div></div>
<div class="paragraph"><p>Einen Task hinzufügen:</p></div>
<div class="literalblock"><div class="content"><pre>curl -d '{"description": "curl lernen", "state":"STARTED", "dateDue":"2019-05-25T10:15:00Z"}' \
     -H "Content-Type: application/json" -X POST http://localhost:8080/tasks</pre></div></div>
<div class="paragraph"><p>Task löschen (mit <code>-v</code> werden u. a. Status-Code und Header ausgegeben):</p></div>
<div class="literalblock"><div class="content"><pre>curl -v -X DELETE http://localhost:8080/tasks/2</pre></div></div>
<div class="paragraph heading"><p>Alternativen:</p></div>
<div class="ulist"><ul><li><p><a href="https://www.getpostman.com/">&#8594; Postman</a></p></li><li><p><a href="https://addons.mozilla.org/de/firefox/addon/restclient/">&#8594; RESTClient (Browser-Plugin)</a></p></li></ul></div></section>
<section id="_aufgabe_3_rest_controller_implementieren_teil_1"><h2>Aufgabe 3: REST-Controller implementieren (Teil 1)</h2><div class="olist arabic"><ol class="arabic"><li><p>Implementieren Sie die fehlenden Methodenrümpfe (CRUD) im <code>TaskController</code> und ergänzen Sie notwendige Annotationen.</p></li><li><p>Starten Sie den Server und legen Sie manuell Daten über die REST-API an.
Prüfen Sie auch den Datenbankinhalt.</p></li><li><p>Experimentieren Sie!</p></li></ol></div></section>
<section><section id="_weitere_annotationen_für_parameter_von_handler_methoden"><h2>Weitere Annotationen für Parameter von Handler-Methoden</h2><div class="ulist"><ul><li><p><code>@RequestParam</code> (default)</p></li><li><p><code>@RequestHeader</code></p></li><li><p><code>@CookieValue</code></p></li><li><p><code>@SessionAttribute</code></p></li><li><p><code>@RequestBody</code></p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/accounts</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> handle(<span class="annotation">@RequestBody</span> Account account) { ... }</code></pre></li><li><p><code>@Valid</code> (Standard Bean Validation)</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@PostMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/accounts</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">void</span> handle(<span class="annotation">@Valid</span> <span class="annotation">@RequestBody</span> Account account) { ... }</code></pre></li></ul></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/web.html#mvc-controller">
&#8594; Spring Reference: Annotated Controllers</a></p></div></section><section id="_optionale_handler_methoden_parameter"><h2>Optionale Handler-Methoden Parameter</h2><div class="ulist"><ul><li><p><code>HttpServletRequest</code></p></li><li><p><code>HttpServletResponse</code></p></li><li><p><code>java.security.Principal</code></p></li><li><p><code>Locale</code></p></li><li><p><code>TimeZone</code> oder <code>ZoneId</code></p></li><li><p><code>HttpEntity&lt;B&gt;</code> (Zum Zugriff auf Header und Body)</p></li><li><p><code>Errors</code>, <code>BindingResult</code> (Zugriff auf Fehler bei Validierung oder Data Binding)</p></li><li><p><code>UriComponentsBuilder</code> (Um URLs relativ zur aktuellen URL zu erstellen)</p><div class="title">DemoController.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@GetMapping</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/uri/{id}</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="predefined-type">String</span> uri(<span class="annotation">@PathVariable</span> <span class="type">int</span> id, UriComponentsBuilder uriBuilder) {
    <span class="predefined-type">String</span> uri = uriBuilder.path(<span class="string"><span class="delimiter">&quot;</span><span class="content">/uri/{id}</span><span class="delimiter">&quot;</span></span>).build().expand(id).encode().toUriString();
    <span class="keyword">return</span> uri;
}</code></pre></li></ul></div></section><section id="_handler_methoden_rückgabewerte"><h2>Handler-Methoden Rückgabewerte</h2><div class="paragraph"><p>Ein Handler kann beliebige Objekte zurückgeben, die mittels Data-Binding in den
entsprechenden <em>content_type</em> konvertiert werden.</p></div>
<div class="ulist"><ul><li><p><code>@ResponseBody</code> (in <code>@RestController</code> enthalten)</p></li><li><p><code>@GetMapping(path="/json", produces = MediaType.APPLICATION_JSON_UTF8_VALUE)</code> (<em>content_type</em> angeben)</p></li><li><p><code>@ResponseStatus(HttpStatus.CREATED)</code> (default ist <code>HttpStatus.OK</code>)</p></li><li><p><code>ResponseEntity&lt;B&gt;</code> (bietet fluent-API für Status, Header, Body, Cache-Control, etc.)</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">return</span> ResponseEntity.status(status).body(body);</code></pre></li></ul></div></section></section>
<section><section id="_error_handling"><h2>Error Handling</h2><div class="olist arabic"><ol class="arabic"><li><p>Exception annotieren (Message ist fix):</p><div class="title">BadException.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ResponseStatus</span>(code = HttpStatus.BAD_REQUEST, reason=<span class="string"><span class="delimiter">&quot;</span><span class="content">Sample Exception</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">BadException</span> <span class="directive">extends</span> <span class="exception">RuntimeException</span> {
}</code></pre></li><li><p>ResponseStatusException (seit Spring 5):</p><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">throw</span> <span class="keyword">new</span> ResponseStatusException(HttpStatus.NOT_ACCEPTABLE, <span class="string"><span class="delimiter">&quot;</span><span class="content">Easy aufgrufen mit name=</span><span class="delimiter">&quot;</span></span> + name);</code></pre></li><li><p>Handler-Methode im Controller für die entsprechenden Exceptions:</p><div class="title">DemoController.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ExceptionHandler</span>({ WorseException.class })
<span class="directive">public</span> ResponseEntity&lt;RestApiError&gt; handleWorse(WorseException ex) {
    HttpStatus status = HttpStatus.GONE;
    RestApiError body = <span class="keyword">new</span> RestApiError(status.value(), ex.getMessage());
    <span class="keyword">return</span> ResponseEntity.status(status).body(body);
}</code></pre></li></ol></div></section><section id="_zentralisierte_fehlerbehandlung_mit_controlleradvice"><h2>Zentralisierte Fehlerbehandlung mit <code>@ControllerAdvice</code></h2><div class="title">RestExceptionHandler.java (lesson08-spring-rest)</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ControllerAdvice</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">RestExceptionHandler</span> <span class="directive">extends</span> ResponseEntityExceptionHandler {

    <span class="annotation">@ExceptionHandler</span>(WorstException.class)
    <span class="annotation">@ResponseStatus</span>(HttpStatus.CONFLICT)
    <span class="annotation">@ResponseBody</span>
    <span class="directive">public</span> RestApiError handleWorst(WorstException ex) {
        logger.warn(<span class="string"><span class="delimiter">&quot;</span><span class="content">Worst: </span><span class="delimiter">&quot;</span></span> + ex.getMessage());
        <span class="keyword">return</span> error(HttpStatus.CONFLICT, ex);
    }

    <span class="annotation">@ExceptionHandler</span>({ <span class="exception">NullPointerException</span>.class, <span class="exception">IllegalArgumentException</span>.class, <span class="exception">IllegalStateException</span>.class })
    <span class="directive">public</span> ResponseEntity&lt;<span class="predefined-type">Object</span>&gt; handleIntenalServerError(<span class="exception">RuntimeException</span> ex, WebRequest request) {
        logger.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">Internal Server Error</span><span class="delimiter">&quot;</span></span>, ex);

        HttpStatus status = HttpStatus.INTERNAL_SERVER_ERROR;
        RestApiError error = error(status, ex);
        <span class="keyword">return</span> handleExceptionInternal(ex, error, <span class="keyword">new</span> HttpHeaders(), status, request);
    }

    <span class="directive">private</span> RestApiError error(HttpStatus httpStatus, <span class="exception">Exception</span> ex) {
        <span class="predefined-type">String</span> message = ex.getMessage() == <span class="predefined-constant">null</span> ? ex.getClass().getSimpleName() : ex.getMessage();
        <span class="keyword">return</span> <span class="keyword">new</span> RestApiError(httpStatus.value(), message);
    }
}</code></pre></section></section>
<section><section id="_unit_tests"><h2>Unit-Tests</h2><div class="paragraph heading"><p>Test mit <strong>MockMvc</strong></p></div><div class="title">TaskControllerTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootTest</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">spring.datasource.url=</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@AutoConfigureMockMvc</span>
<span class="annotation">@Disabled</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Implement TaskController first</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TaskControllerTest</span> {
    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> MockMvc mockMvc;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testEmptyRepository() <span class="directive">throws</span> <span class="exception">Exception</span> {
        mockMvc.perform(get(<span class="string"><span class="delimiter">&quot;</span><span class="content">/tasks/</span><span class="delimiter">&quot;</span></span>)).andDo(print()).andExpect(status().isOk()).andExpect(content().json(<span class="string"><span class="delimiter">&quot;</span><span class="content">[]</span><span class="delimiter">&quot;</span></span>));
    }
}</code></pre></section><section id="_test_mit_testresttemplate"><h2>Test mit <strong>TestRestTemplate</strong></h2><div class="title">TaskControllerHttpRequestTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringBootTest</span>(properties = <span class="string"><span class="delimiter">&quot;</span><span class="content">spring.datasource.url=</span><span class="delimiter">&quot;</span></span>, webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
<span class="directive">public</span> <span class="type">class</span> <span class="class">TaskControllerHttpRequestTest</span> {

    <span class="annotation">@LocalServerPort</span>
    <span class="directive">private</span> <span class="type">int</span> port;

    <span class="annotation">@Autowired</span>
    <span class="directive">private</span> TestRestTemplate restTemplate;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testGet() <span class="directive">throws</span> <span class="exception">Exception</span> {
        TaskEntity task = restTemplate.getForObject(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="delimiter">&quot;</span></span> + port + <span class="string"><span class="delimiter">&quot;</span><span class="content">/tasks/42</span><span class="delimiter">&quot;</span></span>, TaskEntity.class);
    }
}</code></pre></section></section>
<section id="_aufgabe_4_rest_controller_implementieren_teil_2"><h2>Aufgabe 4: REST-Controller implementieren (Teil 2)</h2><div class="olist arabic"><ol class="arabic"><li><p>Lösen Sie die restlichen TODOs (Error Handling, Location Header) im <code>TaskController</code>.</p></li><li><p>Führen Sie die Tests <code>TaskControllerTest</code>, <code>TaskControllerHttpRequestTest</code> und <code>TaskControllerMockTest</code> aus.
Worin unterscheiden sich diese?</p></li><li><p>Debuggen Sie Ihre Anwendung. Wer ruft die Controller-Methoden auf? Was genau geschieht im DispatcherServlet?</p></li></ol></div></section>
<section id="_rest_2"><h2>REST</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson09-reactor.html">&#8594; Weiter zu Reactor</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section>
<section id="_lektion_9_reactor_webflux" data-state="no-title-footer"><h2>Lektion 9 - Reactor &amp; WebFlux</h2><div class="paragraph center"><p>Was verbirgt sich dahinter?</p></div></section>
<section><section id="_reaktive_systeme"><h2>Reaktive Systeme</h2></section><section id="_reactive_manifesto"><h2>Reactive Manifesto</h2><div class="paragraph"><p>Reaktive Systeme müssen stets</p></div>
<div class="ulist"><ul><li><p>antwortbereit (responsive) &#8594; 100% Online, garantierte Antwortzeiten</p></li><li><p>widerstandsfähig (resilient) &#8594; fehlertolerant</p></li><li><p>elastisch (elastic) &#8594; skalierbar</p></li><li><p>und nachrichtenorientiert (message driven) &#8594; asynchron, nicht blockierend</p></li></ul></div>
<div class="paragraph"><p>sein.</p></div>
<div class="paragraph"><p>&#8594; <a href="https://www.reactivemanifesto.org/de" class="bare">https://www.reactivemanifesto.org/de</a></p></div></section><section id="_qualitäten_reaktiver_systeme"><h2>Qualitäten reaktiver Systeme</h2><div class="paragraph"><p><span class="image"><img src="images/reactive-traits.svg" alt="reactive traits"></span></p></div></section><section id="_nicht_verwechseln_reaktive_websites"><h2>Nicht verwechseln: Reaktive Websites</h2><div class="paragraph"><p>Der Begriff <em>reactive</em> wird oft statt <em>responsive</em> für Weboberflächen verwendet.</p></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p><strong>Responsive Websites</strong></p></div>
<div class="ulist"><ul><li><p>passen ihr Layout speziell auf den Gerätetyp an und</p></li><li><p>liefern auf jede Benutzeraktion unmittelbares Feedback.</p></li></ul></div></section></section>
<section id="_umsetzung_reaktiver_systeme_in_java"><h2>Umsetzung reaktiver Systeme in Java</h2><div class="paragraph heading"><p>Mittel zur Umsetzung:</p></div>
<div class="ulist"><ul><li><p>Verwendung von nicht-blockierenden APIs (<code>java.nio</code> oder nativ)</p></li><li><p>Zustandslose Serverprozesse</p></li><li><p>Reactive Streams (Backpressure)</p></li><li><p>Asynchrone Verarbeitung</p></li></ul></div></section>
<section><section id="_reactive_streams"><h2>Reactive Streams</h2><div class="quoteblock"><blockquote><div class="paragraph"><p>Reactive Streams is an initiative to provide a standard for
asynchronous stream processing with non-blocking back pressure.</p></div></blockquote><div class="attribution">&#8212; <a href="http://www.reactive-streams.org" class="bare">http://www.reactive-streams.org</a></div></div></section><section id="_implementierungen_für_die_jvm"><h2>Implementierungen für die JVM:</h2><div class="ulist"><ul><li><p>Akka Streams</p></li><li><p>RxJava</p></li><li><p>Vert.x</p></li><li><p>Reactor (Spring)</p></li></ul></div></section><section id="_bausteine"><h2>Bausteine</h2><div class="imageblock" style=""><img src="images/ReactiveStreams.svg" alt="ReactiveStreams" width="1200" height="350"></div>
<div class="paragraph"><p>Die Reactive Streams Interfaces entsprechen exakt dem <code>java.util.concurrent.Flow</code>
Interface, das es seit Java 9 gibt.</p></div>
<div class="paragraph"><p><a href="https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/util/concurrent/Flow.html">&#8594; Javadocs</a></p></div></section><section id="_protokoll"><h2>Protokoll</h2><div class="imageblock" style="text-align: center"><img src="images/Protokoll.svg" alt="Protokoll" width="1000" height="720"></div></section><section id="_reaktive_datentypen"><h2>Reaktive Datentypen</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:25%"><col style="width:25%"><col style="width:25%"><col style="width:25%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Anzahl</th><th class="tableblock halign-left valign-top">Klassisch</th><th class="tableblock halign-left valign-top">Java 8</th><th class="tableblock halign-left valign-top">Reactor</th></tr><tbody><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">0..1</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">einzelnes Objekt</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Optional</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Mono&lt;T&gt;</p></td></tr><tr><th class="tableblock halign-left valign-top"><p class="tableblock header">0..*</p></th><td class="tableblock halign-left valign-top"><p class="tableblock">Collection</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Stream</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Flux&lt;T&gt;</p></td></tr></table>
<div class="paragraph"><p><code>Flux</code> und <code>Mono</code> implementieren beide das <code>Publisher</code> Interface</p></div></section></section>
<section id="_synchrone_vs_reaktive_programmierung"><h2>Synchrone vs. reaktive Programmierung</h2><div class="imageblock" style="text-align: center"><img src="images/sync-vs-reactive.svg" alt="sync vs reactive" height="800"></div></section>
<section><section id="_flux_mono_api"><h2>Flux &amp; Mono API</h2><div class="paragraph heading"><p>Mono erzeugen &#8230;&#8203;</p></div><pre class="CodeRay listingblock"><code class="java language-java">Mono.empty();
Mono.just(<span class="string"><span class="delimiter">&quot;</span><span class="content">blub</span><span class="delimiter">&quot;</span></span>);
Mono.justOrEmpty(mayBeNull);
Mono.justOrEmpty(someOptional);
Mono.fromCallable(<span class="local-variable">this</span>::toString);
Mono.error(<span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>));
Mono.delay(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">3</span>));</code></pre></section><section id="_flux_erzeugen"><h2>Flux erzeugen &#8230;&#8203;</h2><pre class="CodeRay listingblock"><code class="java language-java">Flux.empty();
Flux.just(<span class="integer">1</span>, <span class="integer">2</span> ,<span class="integer">3</span>);
Flux.range(<span class="integer">1</span>, <span class="integer">3</span>);
Flux.fromIterable(<span class="predefined-type">Arrays</span>.asList(<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>));
Flux.fromStream(IntStream.range(<span class="integer">1</span>, <span class="integer">3</span>).boxed());

Flux.error(<span class="keyword">new</span> <span class="exception">RuntimeException</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">sample</span><span class="delimiter">&quot;</span></span>));
Flux.interval(<span class="predefined-type">Duration</span>.ofSeconds(<span class="integer">3</span>));</code></pre></section><section id="_operatoren"><h2>Operatoren &#8230;&#8203;</h2><pre class="CodeRay listingblock"><code class="java language-java">mono.log();
mono.subscribe(<span class="predefined-type">System</span>.out::println);
mono.block();</code></pre>
<div class="admonitionblock warning teacherBox"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Jeder Operator erzeugt ein neues Objekt!</td></tr></table></div></section><section id="_callbacks"><h2>Callbacks &#8230;&#8203;</h2><pre class="CodeRay listingblock"><code class="java language-java">flux.doOnRequest(n -&gt; <span class="predefined-type">System</span>.out.println(n + <span class="string"><span class="delimiter">&quot;</span><span class="content">requested.</span><span class="delimiter">&quot;</span></span>));
flux.doOnNext(x -&gt; <span class="predefined-type">System</span>.out.print(<span class="string"><span class="delimiter">&quot;</span><span class="content">next: </span><span class="delimiter">&quot;</span></span> + x));
flux.doOnComplete(() -&gt; <span class="predefined-type">System</span>.out.println(<span class="string"><span class="delimiter">&quot;</span><span class="content">complete</span><span class="delimiter">&quot;</span></span>));
flux.doOnError(th -&gt; th.printStackTrace());</code></pre></section><section id="_konverter"><h2>Konverter &#8230;&#8203;</h2><pre class="CodeRay listingblock"><code class="java language-java">mono.map(x -&gt; x * <span class="integer">2</span>);
mono.filter(x -&gt; x &gt; <span class="integer">3</span>);
mono.flatMap(x -&gt; Mono.justOrEmpty(x * <span class="integer">2</span>));
mono.flux();</code></pre></section><section id="_kombinatoren"><h2>Kombinatoren &#8230;&#8203;</h2><pre class="CodeRay listingblock"><code class="java language-java">mono1.mergeWith(mono2);
mono1.zipWith(mono2);</code></pre></section><section id="_countdownlatch_verwenden"><h2>CountDownLatch verwenden &#8230;&#8203;</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">CountDownLatch</span> countDownLatch = <span class="keyword">new</span> <span class="predefined-type">CountDownLatch</span>(<span class="integer">1</span>);
Mono&lt;<span class="predefined-type">Long</span>&gt; delay = Mono.delay(<span class="predefined-type">Duration</span>.ofMillis(<span class="integer">500</span>));
delay.doOnTerminate(countDownLatch::countDown).subscribe();
countDownLatch.await();</code></pre></section><section id="_dokumentation"><h2>Dokumentation</h2><div class="ulist"><ul><li><p><a href="https://projectreactor.io/">&#8594; Project Reactor Website</a></p></li><li><p><a href="https://projectreactor.io/docs/core/release/reference/">&#8594; Project Reactor Referenzdokumentation</a></p><div class="ulist"><ul><li><p><a href="https://projectreactor.io/docs/core/release/reference/#core-features">&#8594; Abschnitt 4: Reactor Core Features</a></p></li></ul></div></li><li><p><a href="https://projectreactor.io/docs/core/release/api/index.html?reactor/core/publisher/Flux.html">&#8594; Javadocs zu Flux</a></p></li><li><p><a href="https://projectreactor.io/docs/core/release/api/index.html?reactor/core/publisher/Mono.html">&#8594; Javadocs zu Mono</a></p></li></ul></div></section></section>
<section id="_aufgabe_1_flux_und_mono_kennenlernen"><h2>Aufgabe 1: Flux und Mono kennenlernen</h2><div class="olist arabic"><ol class="arabic"><li><p>In der Klasse <code>reactor.basics.MonoTests</code> finden Sie ein Grundgerüst zu einem <em>Learningtest</em> zu <code>Mono</code>.
Bearbeiten Sie die darin mit <em>TODO</em> markierten Aufgaben.</p></li><li><p>Bearbeiten Sie die entsprechenden Aufgaben in <code>reactor.basics.FluxTests</code>.</p></li></ol></div></section>
<section><section id="_wozu_reaktive_progammierung"><h2>Wozu reaktive Progammierung?</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Synchron</th><th class="tableblock halign-left valign-top">Reaktiv</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Viele Threads</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Wenige Threads</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Viele gebundene Ressourcen</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Resourcesharing (gemeinsame Ressourcen)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Synchron (blockierend)</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Asynchron (nicht blockierend)</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Stacktraces</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Schwer nachvollziehbare Abläufe</p></td></tr></table></section><section id="_ergo"><h2>Ergo:</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th class="tableblock halign-left valign-top">Synchron</th><th class="tableblock halign-left valign-top">Reaktiv</th></tr><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">Einfach</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Kompliziert</p></td></tr></table>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Reaktive Programmierung nur verwenden, wenn es wirklich Vorteile bringt.</td></tr></table></div></section></section>
<section><section id="_nichtblockierendes_io"><h2>Nichtblockierendes IO</h2><div class="paragraph heading"><p>Nichtblockierendes IO mit Java</p></div><div class="ulist"><ul><li><p>Bei Java NIO nur mit Sockets möglich</p></li><li><p>Meistens über native Implementierungen (z. B. hat Netty betriebsystemespezifische
Implementierung des <code>netty-transport</code> Moduls</p></li><li><p>Reaktive Datenbanktreiber bisher nur für einige NoSQL Datenbanken verfügbar</p></li><li><p>Gute Unterstützung für Messaging Systeme (Kafka, RabbitMQ, ActiveMQ)</p></li></ul></div></section><section id="_synchrones_lesen"><h2>Synchrones Lesen</h2><div class="imageblock" style="text-align: center"><img src="images/read-sync.svg" alt="read sync" width="800" height="780"></div></section><section id="_asynchrones_lesen"><h2>Asynchrones Lesen</h2><div class="imageblock" style="text-align: center"><img src="images/read-async.svg" alt="read async" width="800" height="720"></div></section><section id="_nio_selector"><h2>NIO Selector</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">ServerSocketChannel</span> server = <span class="predefined-type">ServerSocketChannel</span>.open();
server.socket().bind(<span class="keyword">new</span> <span class="predefined-type">InetSocketAddress</span>(SERVER_PORT));
server.configureBlocking(<span class="predefined-constant">false</span>); <i class="conum" data-value="1"></i><b>(1)</b>
server.register(selector, <span class="predefined-type">SelectionKey</span>.OP_ACCEPT); <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Lese- und Schreibzugriffe sind nicht blockierend</td></tr><tr><td><i class="conum" data-value="2"></i><b>2</b></td><td><code>Channel</code> beim <code>Selector</code> registrieren</td></tr></table></div></section><section id="_nio_selector_verwenden"><h2>NIO Selector verwenden</h2><pre class="CodeRay listingblock"><code class="java language-java"><span class="type">int</span> count = selector.select(); <i class="conum" data-value="1"></i><b>(1)</b>
<span class="predefined-type">Set</span>&lt;<span class="predefined-type">SelectionKey</span>&gt; selectedKeys = selector.selectedKeys();

<span class="predefined-type">Iterator</span>&lt;<span class="predefined-type">SelectionKey</span>&gt; iter = selectedKeys.iterator();
<span class="keyword">while</span> (iter.hasNext()) {
    <span class="predefined-type">SelectionKey</span> selectedKey = iter.next();
    <span class="keyword">if</span> (selectedKey.isAcceptable()) {
        handleNewClientConnection(selectedKey);
    } <span class="keyword">else</span> <span class="keyword">if</span> (selectedKey.isReadable()) {
        handleDataReceivedFormClient(selectedKey);
    }
    iter.remove();
}</code></pre>
<div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b></td><td>Warten bis auf irgendeinem <code>Channel</code> etwas anliegt</td></tr></table></div></section></section>
<section><section id="_reactive_streams_verwenden"><h2>Reactive Streams verwenden</h2><div class="paragraph heading"><p>IO mit Reactive Streams</p></div><div class="title">org.springframework.data.repository.reactive.ReactiveCrudRepository<br></div><pre class="CodeRay listingblock"><code class="java language-java">&lt;S <span class="directive">extends</span> T&gt; Mono&lt;S&gt; save(S entity);
&lt;S <span class="directive">extends</span> T&gt; Flux&lt;S&gt; saveAll(<span class="predefined-type">Iterable</span>&lt;S&gt; entities);
&lt;S <span class="directive">extends</span> T&gt; Flux&lt;S&gt; saveAll(Publisher&lt;S&gt; entityStream);
Mono&lt;T&gt; findById(ID id);
Mono&lt;T&gt; findById(Publisher&lt;ID&gt; id);
Mono&lt;<span class="predefined-type">Boolean</span>&gt; existsById(ID id);
Mono&lt;<span class="predefined-type">Boolean</span>&gt; existsById(Publisher&lt;ID&gt; id);
Flux&lt;T&gt; findAll();
Flux&lt;T&gt; findAllById(<span class="predefined-type">Iterable</span>&lt;ID&gt; ids);
Flux&lt;T&gt; findAllById(Publisher&lt;ID&gt; idStream);
Mono&lt;<span class="predefined-type">Long</span>&gt; count();
Mono&lt;<span class="predefined-type">Void</span>&gt; deleteById(ID id);
Mono&lt;<span class="predefined-type">Void</span>&gt; deleteById(Publisher&lt;ID&gt; id);
Mono&lt;<span class="predefined-type">Void</span>&gt; delete(T entity);
Mono&lt;<span class="predefined-type">Void</span>&gt; deleteAll(<span class="predefined-type">Iterable</span>&lt;? <span class="directive">extends</span> T&gt; entities);
Mono&lt;<span class="predefined-type">Void</span>&gt; deleteAll(Publisher&lt;? <span class="directive">extends</span> T&gt; entityStream);
Mono&lt;<span class="predefined-type">Void</span>&gt; deleteAll();</code></pre><div class="paragraph"><p>Verwendet nur Flux und Mono&#8230;&#8203;<br>
(Basisklasse für Zugriff auf NoSQL Datenbanken)</p></div><div class="paragraph"><p><a href="https://docs.spring.io/spring-data/commons/docs/2.2.6.RELEASE/api/org/springframework/data/repository/reactive/ReactiveCrudRepository.html">&#8594; Javadocs</a></p></div></section><section id="_eigene_publisher"><h2>Eigene Publisher</h2><div class="quoteblock"><blockquote><div class="paragraph"><p><a href="https://github.com/reactor/reactor-core/issues/482#issuecomment-287006634">
&#8594; Rule number 1 of the Reactor club: don&#8217;t write your own Publisher.
Even though the interface is simple, the set of rules about interactions
between all these reactive streams interface is not.</a></p></div></blockquote><div class="attribution">&#8212; Simon Baslé (Pivotal, Project Reactor)</div></div>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock important teacherBox"><table><tr><td class="icon"><i class="fa fa-exclamation-circle" title="Important"></i></td><td class="content">Eigene Publisher immer über Flux (create, push oder generate) erzeugen!</td></tr></table></div>
<div class="paragraph"><p>Siehe auch:</p></div>
<div class="ulist"><ul><li><p><a href="https://medium.com/@olehdokuka/mastering-own-reactive-streams-implementation-part-1-publisher-e8eaf928a78c">&#8594; Oleh Dokuka: Mastering own Reactive-Streams implementation</a></p></li><li><p><a href="https://www.packtpub.com/application-development/reactive-programming-spring-50">&#8594; Buch: Hands-On Reactive Programming in Spring 5</a></p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Quellennachweise für Grafiken:</p></div>
<div class="ulist"><ul><li><p><a href="https://pixabay.com/de/kaffee-kaffeemaschine-tasse-getr%C3%A4nk-880561/" class="bare">https://pixabay.com/de/kaffee-kaffeemaschine-tasse-getr%C3%A4nk-880561/</a></p></li><li><p><a href="https://images-na.ssl-images-amazon.com/images/I/51DWIpIIeaL" class="bare">https://images-na.ssl-images-amazon.com/images/I/51DWIpIIeaL</a>.<em>SY355</em>.jpg</p></li><li><p><a href="https://www.amazon.de/Jura-Impressa-Kaffeevollautomat-freistehend-Kaffeebohnen/dp/B00I8MYD5U" class="bare">https://www.amazon.de/Jura-Impressa-Kaffeevollautomat-freistehend-Kaffeebohnen/dp/B00I8MYD5U</a></p></li></ul></div></aside></section></section>
<section><section id="_aufgabe_2_webflux_und_brücken_zur_synchronen_welt_2_teile"><h2>Aufgabe 2: WebFlux und Brücken zur synchronen Welt (2 Teile)</h2><div class="olist arabic"><ol class="arabic"><li><p>Die <code>reactor.server.ReactorApplication</code> besteht im Moment aus einem REST-Controller,
mit einem <code>/hello</code> Handler und einer statischen <code>index.html</code>. Machen Sie sich mit
der Implementierung vertraut und führen Sie die Anwendung einmal aus.</p><div class="paragraph"><p>Zu dem Server gibt es eine passende Clientanwendung <code>reactor.client.HelloApiClient</code>.
Machen Sie sich auch mit deren Implementierung und Verwendung vertraut.</p></div></li><li><p>Solange nicht alle Teile eines Systems reaktiv sind, ist es notwendig synchrone,
blockierende Methodenaufrufe zu verwenden. Die Methode <code>slowSynchronousGreeting()</code>
simuliert so einen Methodenaufruf. Implementieren Sie analog zu dem <code>/hello</code> Handler
einen <code>/slow</code> Handler, der diese Methode für den Rückgabewert verwendet. Testen
Sie Ihre Implementierung mit <code>slow.html</code>. Was beobachten Sie?</p></li></ol></div><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Nutzen Sie <a href="https://projectreactor.io/docs/core/release/reference/#faq">&#8594; Appendix B: FAQ der Referenzdokumentation</a>!</td></tr></table></div></section><section id="_teil_2_datenströme"><h2>Teil 2: Datenströme</h2><div class="olist arabic"><ol class="arabic" start="3"><li><p>Implementieren Sie einen Handler <code>/countdown/{start}</code>, der im Sekundentakt von
<em>start</em> bis 0 herunterzählt und die jeweilige Zahl über einen Flux ausgibt. Zum
Testen können Sie die <code>countdown.html</code> verwenden.</p></li><li><p>Implementieren Sie analog zum <code>HelloApiClient</code> einen korrespondierenden
<code>CountDownApiClient</code>.</p></li><li><p>Eventhandler sind ein beliebtes Mittel um die Brücke zur synchronen Welt zu schlagen.
Der <code>ClockService</code> bietet die Möglichkeit, einen <code>ClockEventListener</code> zu registrieren,
der jede Sekunde ein <code>ClockEvent</code> mit der aktuellen Uhrzeit erhält. Implementieren Sie
einen <code>/clock</code> Handler, der fortlaufend (als <code>Flux</code>) die Uhrzeit ausgibt. Zum Testen
können Sie die <code>clock.html</code> verwenden.</p><div class="admonitionblock tip teacherBox"><table><tr><td class="icon"><i class="fa fa-lightbulb-o" title="Tip"></i></td><td class="content">Beachten Sie:
<a href="https://projectreactor.io/docs/core/release/reference/#producing.create">
&#8594; Referenzdokumentation: 4.4.2. Asynchronous &amp; multi-threaded: create</a></td></tr></table></div></li><li><p>Implementieren Sie einen <code>ClockApiClient</code>, der 10mal die Uhrzeit ausgibt und sich
danach beendet. Verwenden Sie dafür einen eigenen <code>BaseSubscriber</code>, der die <code>Subscription</code>
nach 10 ClockEvents cancelled.</p></li></ol></div></section></section>
<section id="_zusammenfassung_tag_5"><h2>Zusammenfassung Tag 5</h2><div class="ulist"><ul><li><p>Spring Security:</p><div class="ulist"><ul><li><p>Filter-Chain bei Webanwendungen</p></li><li><p>Zugriff auf Principal über SecurityContextHolder</p></li><li><p>Autorisierung über @PreAuthorize oder entsprechenden WebSecurityConfigurerAdapter</p></li><li><p>Login per OAuth2</p></li></ul></div></li><li><p>Reactor und WebFlux:</p><div class="ulist"><ul><li><p>Reactive Manifesto</p></li><li><p>Verwendung von Flux und Mono</p></li><li><p>Grundlagen der reaktiven Programmierung</p></li></ul></div></li></ul></div></section>
<section id="_abschluss"><h2>Abschluss</h2><div class="openblock heading"><div class="content"><div class="paragraph"><p>Fragen&#8230;&#8203;</p></div>
<div class="paragraph"><p>Anregungen&#8230;&#8203;</p></div>
<div class="paragraph"><p>Meinung&#8230;&#8203;</p></div>
<div class="paragraph"><p>Feedback&#8230;&#8203;</p></div></div></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section></div></div><script src="reveal.js-3.9.2/lib/js/head.min.js"></script><script src="reveal.js-3.9.2/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: true,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'anderscore',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1728,
  height: 972,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.9.2/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/title-footer/title-footer.js', async: true, callback: function()
          {title_footer.initialize('Spring', 'Jan Lühr', 'anderScore GmbH • Frankenwerft 35 • 50667 Köln');}},
      { src: 'reveal.js-3.9.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js-3.9.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js-3.9.2/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>