<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Lektion 5 - Testentwicklung mit Spring</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js-3.9.2/css/reveal.css" rel="stylesheet"><link href="reveal.js-3.9.2/plugin/title-footer/title-footer.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js-3.9.2/css/theme/anderscore.css" id="theme"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.3.0/css/font-awesome.min.css"><style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid currentColor;opacity:.35;padding:0 .5em 0 0}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style><link href="reveal.js-3.9.2/lib/css/zenburn.css" rel="stylesheet"><script>document.write( '<link rel="stylesheet" href="reveal.js-3.9.2/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script><script>document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>')</script></head><body><div class="reveal"><div class="slides"><section id="_lektion_5_testentwicklung_mit_spring" data-state="no-title-footer"><h2>Lektion 5 - Testentwicklung mit Spring</h2><div class="paragraph center"><p>Wie könnte Sie Spring beim Testen unterstützen?</p></div></section>
<section id="_testentwicklung_mit_spring"><h2>Testentwicklung mit Spring</h2><div class="paragraph heading"><p>Bibliotheken und Frameworks für Testentwicklung mit Spring:</p></div>
<div class="ulist"><ul><li><p>JUnit 4/5</p></li><li><p>AssertJ</p></li><li><p>Spring Test</p></li><li><p>Mockito</p></li></ul></div></section>
<section id="_junit5"><h2>JUnit5</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>testCompile 'org.junit.jupiter:junit-jupiter-api:5.6.0'</pre></div></div>
<div class="paragraph"><p>Beispiel:</p></div>
<div class="title">JUnit5Test.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">package</span> <span class="namespace">testing.fragments</span>;

<span class="keyword">import</span> <span class="include">org.junit.jupiter.api.Test</span>;

<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.junit.jupiter.api.Assertions.assertEquals</span>;

<span class="directive">public</span> <span class="type">class</span> <span class="class">JUnit5Test</span> {

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testOnePlusOne() {
        assertEquals(<span class="integer">2</span>, <span class="integer">1</span> + <span class="integer">1</span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">strange arithmetic</span><span class="delimiter">&quot;</span></span>);
    }
}</code></pre></section>
<section id="_assertj"><h2>AssertJ</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>testCompile 'org.assertj:assertj-core:3.15.0'</pre></div></div>
<div class="paragraph"><p>Verwendeter Import:</p></div>
<div class="literalblock"><div class="content"><pre>import static org.assertj.core.api.Assertions.assertThat;</pre></div></div>
<div class="paragraph"><p>Beispiel:</p></div>
<div class="literalblock"><div class="content"><pre>assertThat(1 + 1).as("adding").isEqualTo(2);</pre></div></div></section>
<section><section id="_spring_test"><h2>Spring Test</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div><div class="literalblock"><div class="content"><pre>testCompile 'org.springframework:spring-test:5.3.6'</pre></div></div><div class="paragraph"><p><br></p></div><div class="paragraph"><p>Enthält die Packages:</p></div><div class="ulist"><ul><li><p><code>org.springframework.mock</code></p></li><li><p><code>org.springframework.test</code></p></li></ul></div></section><section id="_package_org_springframework_test"><h2>Package <code>org.springframework.test</code>:</h2><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:33.3333%"><col style="width:66.6667%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><p class="tableblock">AopTestUtils</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">AOP-Utilities zum Zugriff auf Objekt hinter einem Proxy</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">AssertionErrors</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assertions unabhängig von JUnit</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JsonExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assertions zum Vergleich von JSON-Strings</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">JsonPathExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Prüfung von JSON-Inhalten mittels JSON-Path Ausdrücken</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">XmlExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Assertions zum Vergleich von XML-Inhalten oder XML-Eigenschaften</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">XpathExpectationsHelper</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Prüfung von XML-Inhalten mittels XPath-Ausdrücken</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">MetaAnnotationUtils</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Zugriff Annotationen hinter Metaannotationen</p></td></tr><tr><td class="tableblock halign-left valign-top"><p class="tableblock">ReflectionTestUtils</p></td><td class="tableblock halign-left valign-top"><p class="tableblock">Zugriff auf private Variablen/Methoden</p></td></tr></table></section><section id="_zugriff_auf_private_variablen"><h2>Zugriff auf private Variablen</h2><div class="ulist"><ul><li><p>Beans haben private Variablen, die nur per DI befüllt werden.</p></li><li><p>Getter und Setter sind in der Regel nicht vorhanden.</p></li><li><p>Für Unittests müssen diese befüllt werden.</p></li></ul></div>
<div class="paragraph"><p>Man kann mit Java-Bordmitteln per Reflection auf private
Variablen zugreifen:</p></div>
<div class="title">AccessingPrivateFieldTest.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="predefined-type">Field</span> breedTimeField = FishStrategy.class.getDeclaredField(<span class="string"><span class="delimiter">&quot;</span><span class="content">breedTime</span><span class="delimiter">&quot;</span></span>);
breedTimeField.setAccessible(<span class="predefined-constant">true</span>);
breedTimeField.set(fishStrategy, <span class="integer">99</span>);</code></pre>
<div class="paragraph"><p>Die <code>ReflectionTestUtils</code> bietet diverse <code>getField</code> und <code>setField</code> Methoden zum
Zugriff auf private Variablen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java">ReflectionTestUtils.setField(someObject, <span class="string"><span class="delimiter">&quot;</span><span class="content">fieldname</span><span class="delimiter">&quot;</span></span>, newValue);
<span class="predefined-type">Object</span> value = ReflectionTestUtils.getField(someObject, <span class="string"><span class="delimiter">&quot;</span><span class="content">fieldName</span><span class="delimiter">&quot;</span></span>);</code></pre></section></section>
<section id="_aufgabe_1_reflection_für_tests_einsetzen"><h2>Aufgabe 1: Reflection für Tests einsetzen</h2><div class="paragraph"><p>Bearbeiten Sie die Aufgaben in <code>SpringUnitTests</code>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Unit Test ausführen (positives und negatives Ergebnis prüfen)</p></li><li><p>Zugriff auf private Variable per Reflection</p></li><li><p>Verwendung von <code>ReflectionTestUtils</code></p></li></ol></div></section>
<section><section id="_mocking"><h2>Mocking</h2><div class="paragraph"><p>Was versteht man unter Mocking? Wofür ist das gut?</p></div><div class="ulist"><ul><li class="fragment"><p>Mocking dient dazu,<br>
Objekte durch Platzhalter zu ersetzen,<br>
die ein bestimmtes Verhalten zeigen</p></li></ul></div></section><section id="_verwendung_von_mockito"><h2>Verwendung von Mockito</h2><div class="paragraph"><p>Notwendige Abhängigkeit:</p></div>
<div class="literalblock"><div class="content"><pre>testCompile 'org.mockito:mockito-core:3.3.0'</pre></div></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Verwendung:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="keyword">import</span> <span class="include">static</span> <span class="include">org.mockito.Mockito</span>.*; <span class="comment">// Importiert statische Methoden der Klasse Mockito</span>

Torus mockTorus = mock(Torus.class); <span class="comment">// Erzeugt Mock-Objekt, das Torus implementiert</span>
when(mockTorus.getWidth()).thenReturn(<span class="integer">300</span>); <span class="comment">// Gib 300 zurück, wenn getWidth()</span>
                                            <span class="comment">// aufgerufen wird</span>

verify(mockTorus).setFishAt(<span class="integer">10</span>, <span class="integer">20</span>, <span class="predefined-constant">null</span>); <span class="comment">// Prüfe, ob setFishAt(10, 20, null)</span>
                                           <span class="comment">// aufgerufen wurde</span></code></pre></section><section id="_spring_klassen_für_mocking"><h2>Spring Klassen für Mocking</h2><div class="paragraph"><p>Spring stellt einige Klassen bereit, die als Mockobjekte in Tests
verwendet werden können.<br>
Diese befinden sich alle in den Subpackages
von <code>org.springframework.mock</code>.<br>
Sie dienen dem Mocking von:</p></div>
<div class="ulist"><ul><li><p>Environment (<code>MockEnvironment</code>)</p></li><li><p>PropertySource (<code>MockPropertySource</code>)</p></li><li><p>JNDI</p></li><li><p>HTTP-Kommunikation (u. a. Servlet-API)</p></li></ul></div></section></section>
<section id="_aufgabe_3_mocking"><h2>Aufgabe 3: Mocking</h2><div class="paragraph"><p>Bearbeiten Sie die Aufgabe im <code>FishStrategyTest</code>:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Prüfen, ob das Verschieben eines Fisches auf dem Torus prinzipiell
korrekt erfolgt</p></li></ol></div>
<div class="paragraph"><p><br></p></div>
<div class="paragraph"><p>Falls Sie noch Zeit haben, können Sie folgendes probieren:</p></div>
<div class="olist arabic"><ol class="arabic"><li><p>Verschieben testen, wenn Nachbarzelle bereits belegt ist</p></li><li><p>Vermehrung eines Fisches testen</p></li></ol></div></section>
<section id="_mocking_2"><h2>Mocking</h2><div class="paragraph heading"><p>Warnung vor dem Mock!</p></div>
<div class="imageblock" style="float: right"><img src="images/dog.jpg" alt="dog"></div>
<div class="paragraph"><p>Mocking ist</p></div>
<div class="ulist"><ul><li><p>aufwendig</p></li><li><p>pflegeintensiv (bei Schnittstellenänderungen)</p></li><li><p>fehleranfällig (Schnittstellenverhalten falsch simuliert)</p></li></ul></div>
<div class="paragraph"><p>&#8658; Es kommt eben immer auf die richtige Dosis an</p></div></section>
<section><section id="_integrationstests"><h2>Integrationstests</h2><div class="paragraph heading"><p>Motivation</p></div><div class="ulist"><ul><li><p>Integrationstests prüfen das Zusammenspiel mehrerer Klassen.</p></li><li><p>Spring-Anwendungen benötigen in der Regel einen speziellen
Test-ApplicationContext.</p></li><li><p>Das Testframework von Spring dient dazu, diesen bereitzustellen.</p></li></ul></div></section><section id="_verwendung_mit_junit_4"><h2>Verwendung mit JUnit 4</h2><div class="title">SpringJUnit4Test.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@RunWith</span>(SpringRunner.class)
<span class="annotation">@ContextConfiguration</span>(classes = WatorConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringJUnit4Test</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Torus torus;

    <span class="annotation">@Test</span>
    <span class="directive">public</span> <span class="type">void</span> testInjectionWorks() {
        assertThat(torus).isNotNull();
    }
}</code></pre>
<div class="paragraph"><p>Statt <code>SpringRunner</code> kann auch <code>SpringJUnit4ClassRunner</code> verwendet werden.</p></div></section><section id="_verwendung_mit_junit_5"><h2>Verwendung mit JUnit 5</h2><div class="title">SpringJUnit5Test.java</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringJUnitConfig</span>(WatorConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringJUnit5Test</span> {

    <span class="annotation">@Inject</span>
    <span class="directive">private</span> Torus torus;

    <span class="annotation">@Test</span>
    <span class="type">void</span> testInjectionWorks() {
        assertThat(torus).isNotNull();
    }
}</code></pre></section><section id="_springjunitconfig"><h2>@SpringJUnitConfig</h2><div class="paragraph"><p>Die Annotation <code>SpringJUnitConfig</code> ist eine <em>Meta-Annotation</em>:</p></div>
<div class="title">org.springframework.test.context.junit.jupiter.SpringJUnitConfig</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ExtendWith</span>(SpringExtension.class)
<span class="annotation">@ContextConfiguration</span>
<span class="annotation">@Documented</span>
<span class="annotation">@Inherited</span>
<span class="annotation">@Retention</span>(<span class="predefined-type">RetentionPolicy</span>.RUNTIME)
<span class="annotation">@Target</span>(<span class="predefined-type">ElementType</span>.TYPE)
<span class="directive">public</span> <span class="annotation">@interface</span> SpringJUnitConfig {</code></pre></section><section id="_meta_annotationen"><h2>Meta-Annotationen</h2><div class="paragraph"><p>Sowohl fast alle JUnit Jupiter Annotationen als auch fast alle Spring Annotionen können<br>
für <strong>Meta-Annotationen</strong> verwendet werden.<br>
D.h. man kann eigene Annotionen aus diesen Meta-Annotionen zusammensetzen.</p></div>
<div class="paragraph"><p><strong><code>@SpringJUnitConfig</code></strong> ist so eine zusammengesetzte Annotation</p></div>
<div class="paragraph"><p>Man könnte den SpringJUnit5Test auch so implementieren:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ExtendWith</span>(SpringExtension.class)
<span class="annotation">@ContextConfiguration</span>(classes=WatorConfig.class)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SpringJUnit5Test</span> {
    <span class="comment">// ...</span>
}</code></pre></section><section id="_springextension"><h2>SpringExtension</h2><div class="paragraph"><p>JUnit 5 Extensions implementieren entsprechende Lifecyle-Interfaces:</p></div>
<div class="title">org.springframework.test.context.junit.jupiter.SpringExtension</div><pre class="CodeRay listingblock"><code class="java language-java"><span class="directive">public</span> <span class="type">class</span> <span class="class">SpringExtension</span> <span class="directive">implements</span> BeforeAllCallback, AfterAllCallback, <span class="comment">// ...</span>
{
    <span class="comment">// ...</span>
    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> beforeAll(ExtensionContext context) <span class="directive">throws</span> <span class="exception">Exception</span> {
        getTestContextManager(context).beforeTestClass();
    }
    <span class="comment">// ...</span>
}</code></pre></section><section id="_test_context_via_xml_config"><h2>Test-Context via XML-Config</h2><div class="paragraph"><p><code>ApplicationContext</code> aus dem Wurzelvereichnis des <em>classpath</em> laden:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(locations={<span class="string"><span class="delimiter">&quot;</span><span class="content">/app-config.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>})</code></pre>
<div class="paragraph"><p>Alternativen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">/app-config.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>})
<span class="annotation">@ContextConfiguration</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@ContextConfiguration</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">test-config.xml</span><span class="delimiter">&quot;</span></span>)
<span class="annotation">@SpringJUnitConfig</span>(locations={<span class="string"><span class="delimiter">&quot;</span><span class="content">/app-config.xml</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-config.xml</span><span class="delimiter">&quot;</span></span>})</code></pre></section><section id="_test_context_via_java_config"><h2>Test-Context via Java-Config</h2><div class="paragraph"><p><code>ApplicationContext</code> über Java-Config erstellen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(classes = {AppConfig.class, TestConfig.class})</code></pre>
<div class="paragraph"><p>Alternativen:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(classes = TestConfig.class)
<span class="annotation">@SpringJUnitConfig</span>(classes = {TestConfig.class})
<span class="annotation">@SpringJUnitConfig</span>({TestConfig.class})</code></pre>
<div class="paragraph"><p><br></p></div>
<div class="admonitionblock note teacherBox"><table><tr><td class="icon"><i class="fa fa-info-circle" title="Note"></i></td><td class="content">Bei <code>@ContextConfiguration</code> ist <em>locations</em> der Default,
bei <code>@SpringJUnitConfig</code> dagegen <em>classes</em>.</td></tr></table></div></section><section id="_test_context_defaults"><h2>Test-Context Defaults</h2><div class="paragraph"><p>Eine <code>@ContextConfiguration</code> oder <code>@SpringJUnitConfig</code> ohne Parameter
in einer Testklasse mit dem Namen <em>MyTest</em> entspricht:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@ContextConfiguration</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">MyTest-config.xml</span><span class="delimiter">&quot;</span></span>)</code></pre>
<div class="paragraph"><p>Wenn es diese XML-Datei nicht gibt, wird nach einer mit <code>@Configuration</code> annotierten
<em>static</em> Innerclass gesucht:</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringJUnitConfig</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyTest</span> {

    <span class="annotation">@Configuration</span>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {
        <span class="comment">// ...</span>
    }
    <span class="comment">// ...</span>
}</code></pre></section><section id="_innerclass_mit_annotationen"><h2>Innerclass mit Annotationen</h2><div class="paragraph"><p>Diese Innerclass kann selbst wiederum mit Annotationen versehen werden.</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@SpringJUnitConfig</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">MyTest</span> {

    <span class="annotation">@Configuration</span>
    <span class="annotation">@Import</span>(SampleConfig.class)
    <span class="annotation">@ComponentScan</span>
    <span class="directive">static</span> <span class="type">class</span> <span class="class">Config</span> {
        <span class="comment">// ...</span>
    }
    <span class="comment">// ...</span>
}</code></pre></section></section>
<section><section id="_test_konfiguration"><h2>Test Konfiguration</h2><div class="paragraph"><p>Tests kann man konfigurieren mit:</p></div><div class="ulist"><ul><li><p><code>@TestPropertySource</code></p></li><li><p><code>@ActiveProfiles</code></p></li><li><p><code>@EnabledIf</code>, <code>@DisabledIdf</code> (nur JUnit 5)</p></li></ul></div></section><section id="_testpropertysource"><h2>TestPropertySource</h2><div class="paragraph"><p>Beispiele (Testklassen-Annotation):</p></div>
<div class="literalblock"><div class="content"><pre>@TestPropertySource("classpath:/test.properties")
@TestPropertySource("/test.properties")
@TestPropertySource("file:${user.home}/test.properties")
@TestPropertySource(properties = { "timezone = GMT", "port: 4242" })</pre></div></div></section><section id="_profile_für_test_aktivieren"><h2>Profile für Test aktivieren</h2><div class="paragraph"><p>Beispiele (Testklassen-Annotation):</p></div>
<div class="literalblock"><div class="content"><pre>@ActiveProfiles("dev")
@ActiveProfiles({"dev", "integration"})</pre></div></div></section><section id="_bedingte_testausführung_nur_junit_5"><h2>Bedingte Testausführung (nur JUnit 5)</h2><div class="paragraph"><p>Beispiele (anwendbar auf Testmethoden und Testklassen):</p></div>
<div class="literalblock"><div class="content"><pre>@EnabledIf("#{systemProperties['os.name'].toLowerCase().contains('mac')}")
@DisabledIf("${smoke.tests.disabled}")
@EnabledIf("true")</pre></div></div></section></section>
<section id="_kontext_test"><h2>Kontext-Test</h2><div class="ulist"><ul><li><p>Ein Kontext-Test prüft, ob der <code>ApplicationContext</code> geladen werden kann.</p></li><li><p>Der <code>ApplicationContext</code> sollte möglichst der produktiven Umgebung entsprechen.</p></li><li><p>So ein Test ist hilfreich bei der Fehlersuche.</p></li></ul></div></section>
<section id="_aufgabe_3_konfigurations_und_kontext_test"><h2>Aufgabe 3: Konfigurations- und Kontext-Test</h2><div class="olist arabic"><ol class="arabic"><li><p>Bearbeiten Sie die Aufgaben im <code>ConfigurationTest</code></p><div class="olist loweralpha"><ol class="loweralpha" type="a"><li><p>Properties in eine Properties-Datei auslagern</p></li><li><p>Profil 'dev' aktivieren</p></li></ol></div></li><li><p>Ändern Sie den <code>WatorApplicationContextTest</code> so, dass er die XML-basierte Konfiguration testet.</p></li></ol></div></section>
<section><section id="_spring_test_features"><h2>Spring-Test Features</h2><div class="paragraph heading"><p>Context-Cache</p></div><div class="paragraph"><p>Da es sehr Zeitintensiv sein kann, den ApplicationContext aufzubauen, verwendet Spring
einen Context-Cache.</p></div><div class="paragraph"><p>Die eindeutige Kombination von Konfigurationsparametern wird verwendet, um einen Schlüssel
zu generieren, unter dem der Kontext gecached wird. Diese sind
<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testcontext-ctx-management-caching">u.a.</a>:</p></div><div class="ulist"><ul><li><p>locations (from @ContextConfiguration)</p></li><li><p>classes (from @ContextConfiguration)</p></li><li><p>activeProfiles (from @ActiveProfiles)</p></li><li><p>propertySourceLocations (from @TestPropertySource)</p></li><li><p>propertySourceProperties (from @TestPropertySource)</p></li></ul></div><div class="admonitionblock warning teacherBox"><table><tr><td class="icon"><i class="fa fa-warning" title="Warning"></i></td><td class="content">Es können Seiteneffekte auftreten, wenn eine VM mehrere Tests auf einmal ausführt,
z.B. beim Jenkins Build</td></tr></table></div></section><section id="_context_cache_beeinflussen"><h2>Context-Cache beeinflussen</h2><div class="ulist"><ul><li><p>Context-Cache wird in einer <em>static</em> Variablen gespeichert, also je VM.</p></li><li><p>Die Größe kann über die System-Property <code>spring.test.context.cache.maxSize</code>
festgelegt werden, Standard ist 32.</p></li><li><p>Über <code>@DirtiesContext</code> kann man erzwingen, dass der Context für einen
Test verworfen wird.</p></li></ul></div></section><section id="_spring_test_lifecycle_callbacks"><h2>Spring Test-Lifecycle Callbacks</h2><div class="ulist"><ul><li><p><code>@TestExecutionListeners</code> registriert einen <code>TestExecutionListener</code>,
dessen Callbacks in verschiedenen Phasen der Testausführung aufgerufen werden.</p></li><li><p>Einige <code>TestExecutionListener</code> registriert Spring standardmäßig,
z.B. den <code>DirtiesContextTestExecutionListener</code> zur Behandlung von <code>@DirtiesContext</code>.</p></li></ul></div>
<div class="paragraph"><p><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/testing.html#testcontext-tel-config">
&#8594; Reference: TestExecutionListener configuration</a></p></div></section><section id="_testen_von_webapplikationen"><h2>Testen von Webapplikationen</h2><div class="paragraph"><p>Folgende Annotationen laden einen <code>WebApplicationContext</code> statt einem <code>ApplicationContext</code>:</p></div>
<div class="ulist"><ul><li><p>@WebAppConfiguration</p></li><li><p>@SpringJUnitWebConfig (nur JUnit 5)</p></li></ul></div></section><section id="_test_sql_skripte_ausführen"><h2>Test SQL-Skripte ausführen</h2><div class="paragraph"><p>Beispiel (anwendbar auf Testmethoden und Testklassen):</p></div>
<pre class="CodeRay listingblock"><code class="java language-java"><span class="annotation">@Sql</span>({<span class="string"><span class="delimiter">&quot;</span><span class="content">/test-schema.sql</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/test-user-data.sql</span><span class="delimiter">&quot;</span></span>})</code></pre></section><section id="_transaktionsteuerung_beim_test"><h2>Transaktionsteuerung beim Test</h2><div class="ulist"><ul><li><p>Mit <code>@Commit</code> und <code>@Rollback</code> kann man das Transaktionsverhalten eines Tests steuern.</p></li><li><p>Sie sind anwendbar auf eine Testklasse oder eine einzelne Methode.</p></li><li><p>Standardmäßig rollt das Testframework jede Transaktion zurück.</p></li><li><p>Mit <code>@BeforeTransaction</code> oder <code>@AfterTransaction</code> kann man Callback-Methoden definieren,
um sich in die Transaktionsverarbeitung einzuklinken.</p></li></ul></div></section><section id="_überschreiben_von_bean_definitionen"><h2>Überschreiben von Bean-Definitionen</h2><div class="paragraph"><p>Die Annotation <strong><code>@Primary</code></strong> ist keine Test-Annotation, aber Sie ist besonders
für Tests nützlich, um mit einer Testkonfiguration eine vorhandene Bean zu
ersetzen.</p></div></section></section>
<section id="_learning_tests"><h2>Learning-Tests</h2><div class="ulist"><ul><li><p>Bevor man eine neue API verwendet, sollte man immer mit Learning-Tests prüfen,
ob diese sich so verhält, wie man das erwartet.</p></li><li><p>Bei späteren API-Updates decken diese Tests frühzeitig Unterschiede auf.</p></li></ul></div></section>
<section id="_aufgabe_4_mit_learning_tests_spezialfälle_im_spring_framework_ergründen"><h2>Aufgabe 4: Mit Learning Tests Spezialfälle im Spring-Framework ergründen</h2><div class="paragraph"><p>Ergründen Sie mit Learning-Tests das Verhalten der Annotationen <code>@Primary</code>, <code>@Qualifier</code>
und <code>@Nullable</code> und beantworten Sie die folgenen Fragen:</p></div>
<div class="ulist"><ul><li><p>Was passiert, wenn eine Bean nicht eindeutig über den Typ zugeordnet werden kann?
Welche Möglichkeiten haben Sie, einer Bean den Vorzug zu geben?</p></li><li><p>Was passiert, wenn keine entsprechende Bean vorhanden ist?</p></li><li><p>Was ist der Unterschied zwischen <code>@Bean(name="bla")</code>, <code>@Qualifier("bla")</code> und <code>@Named("bla")</code>?</p></li><li><p>Was bewirkt <code>@Scope("prototype")</code>? Wofür könnte das gut sein?</p></li></ul></div>
<div class="paragraph"><p>Verwenden Sie <code>LearningTest</code> im Package <code>testing.learning</code> als Vorlage.</p></div></section>
<section id="_testentwicklung_mit_spring_2"><h2>Testentwicklung mit Spring</h2><div class="paragraph heading"><p>Fragen?</p></div>
<div class="paragraph"><p><a href="lesson06-tx.html">&#8594; Weiter zu Persistenz &amp; Transaktionen</a></p></div>
<div class="paragraph"><p><a href="agenda.html">Inhalt</a></p></div></section></div></div><script src="reveal.js-3.9.2/lib/js/head.min.js"></script><script src="reveal.js-3.9.2/js/reveal.js"></script><script>// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: true,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: true,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, black, league, night, serif, simple, sky, solarized, white)
  // NOTE setting the theme in the config no longer works in reveal.js 3.x
  //theme: Reveal.getQueryHash().theme || 'anderscore',
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1728,
  height: 972,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js-3.9.2/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/title-footer/title-footer.js', async: true, callback: function()
          {title_footer.initialize('Spring', 'Jan Lühr', 'anderScore GmbH • Frankenwerft 35 • 50667 Köln');}},
      { src: 'reveal.js-3.9.2/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js-3.9.2/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js-3.9.2/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js-3.9.2/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>